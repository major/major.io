<!doctype html><html lang=en-us><head><meta http-equiv=x-clacks-overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://major.io/favicon.ico><title>Create a local PyPi repository using only mod_rewrite | Major Hayden's Blog ðŸ¤ </title><meta name=title content="Create a local PyPi repository using only mod_rewrite"><meta name=description content="Regular users of Python&rsquo;s package tools like pip or easy_install are probably familiar with the PyPi repository. It&rsquo;s a one-stop-shop to learn more about available Python packages and get them installed on your server.
However, certain folks may find the need to host a local PyPi repository for their own packages. You may need it to store Python code which you don&rsquo;t plan to release publicly or you may need to add proprietary patches to upstream Python packages."><meta name=keywords content="apache,command line,mod_rewrite,python,sysadmin,"><meta property="og:title" content="Create a local PyPi repository using only mod_rewrite"><meta property="og:description" content="Regular users of Python&rsquo;s package tools like pip or easy_install are probably familiar with the PyPi repository. It&rsquo;s a one-stop-shop to learn more about available Python packages and get them installed on your server.
However, certain folks may find the need to host a local PyPi repository for their own packages. You may need it to store Python code which you don&rsquo;t plan to release publicly or you may need to add proprietary patches to upstream Python packages."><meta property="og:type" content="article"><meta property="og:url" content="https://major.io/2012/01/31/create-a-local-pypi-repository-using-only-mod_rewrite/"><meta property="og:image" content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2012-02-01T04:02:49+00:00"><meta property="article:modified_time" content="2012-02-01T04:02:49+00:00"><meta property="og:site_name" content="Major Hayden's Blog ðŸ¤ "><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta name=twitter:title content="Create a local PyPi repository using only mod_rewrite"><meta name=twitter:description content="Regular users of Python&rsquo;s package tools like pip or easy_install are probably familiar with the PyPi repository. It&rsquo;s a one-stop-shop to learn more about available Python packages and get them installed on your server.
However, certain folks may find the need to host a local PyPi repository for their own packages. You may need it to store Python code which you don&rsquo;t plan to release publicly or you may need to add proprietary patches to upstream Python packages."><meta name=twitter:site content="@mhayden"><meta itemprop=name content="Create a local PyPi repository using only mod_rewrite"><meta itemprop=description content="Regular users of Python&rsquo;s package tools like pip or easy_install are probably familiar with the PyPi repository. It&rsquo;s a one-stop-shop to learn more about available Python packages and get them installed on your server.
However, certain folks may find the need to host a local PyPi repository for their own packages. You may need it to store Python code which you don&rsquo;t plan to release publicly or you may need to add proprietary patches to upstream Python packages."><meta itemprop=datePublished content="2012-02-01T04:02:49+00:00"><meta itemprop=dateModified content="2012-02-01T04:02:49+00:00"><meta itemprop=wordCount content="474"><meta itemprop=image content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta itemprop=keywords content="apache,command line,mod_rewrite,python,sysadmin,"><meta name=referrer content="no-referrer-when-downgrade"><style>body{font-family:Verdana,sans-serif;margin:auto;padding:20px;max-width:820px;text-align:left;background-color:#fff;word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:#444}h1,h2,h3,h4,h5,h6,strong,b{color:#222}a{color:#3273dc}.title{text-decoration:none;border:0}.title span{font-weight:400}nav a{margin-right:10px}textarea{width:100%;font-size:16px}input{font-size:16px}content{line-height:1.6}table{width:100%}img{max-width:100%}code{padding:2px 5px;background-color:#f2f2f2}pre code{color:#222;display:block;padding:20px;white-space:pre-wrap;font-size:14px}div.highlight code{background-color:unset;color:initial}blockquote{border-left:1px solid #999;color:#222;padding-left:20px;font-style:italic}footer{padding:25px;text-align:center}.helptext{color:#777;font-size:small}.errorlist{color:#eba613;font-size:small}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:#8b6fcb}@media(prefers-color-scheme:dark){body{background-color:#333;color:#ddd}h1,h2,h3,h4,h5,h6,strong,b{color:#eee}a{color:#8cc2dd}code{background-color:#777}pre code{color:#ddd}blockquote{color:#ccc}textarea,input{background-color:#252525;color:#ddd}.helptext{color:#aaa}}</style></head><body><header><a href=../../../../ class=title><h2>Major Hayden's Blog ðŸ¤ </h2></a><nav><a href=../../../../>Home</a>
<a href=../../../../ham-radio-faq>Ham Radio</a>
<a href=../../../../icanhazip-com-faq>icanhazip FAQ</a>
<a href=../../../../posts>Posts</a></nav></header><main><h1>Create a local PyPi repository using only mod_rewrite</h1><i><time datetime=2012-02-01 pubdate>2012-02-01</time></i>
<content><p>Regular users of Python&rsquo;s package tools like <a href=http://pypi.python.org/pypi/pip>pip</a> or <a href=http://pypi.python.org/pypi/setuptools>easy_install</a> are probably familiar with the <a href=http://pypi.python.org/pypi>PyPi</a> repository. It&rsquo;s a one-stop-shop to learn more about available Python packages and get them installed on your server.</p><p>However, certain folks may find the need to host a local PyPi repository for their own packages. You may need it to store Python code which you don&rsquo;t plan to release publicly or you may need to add proprietary patches to upstream Python packages. Regardless of the reason to have it, a local PyPi repository is relatively easy to configure.</p><p>You&rsquo;ll need to start with a base directory for your PyPi repository. For this example, I chose <code>/var/pypi</code>. The directory structure should look something like this:</p><pre><code>/var/pypi/simple/[package_name]/[package_tarball]
</code></pre><p>For a package like <code>pip</code>, you&rsquo;d make a structure like this:</p><pre><code>/var/pypi/simple/pip/pip-1.0.2.tar.gz
</code></pre><p>Once you have at least one package stored locally, it&rsquo;s time to configure apache. Here&rsquo;s a snippet from the virtual host I configured:</p><pre><code>DocumentRoot /var/pypi/
ServerName pypi.example.com

Options +Indexes

RewriteEngine On
RewriteRule ^/robots.txt - [L]
RewriteRule ^/icons/.* - [L]
RewriteRule ^/index\..* - [L]

RewriteCond /var/pypi/$1 !-f
RewriteCond /var/pypi/$1 !-d
RewriteRule ^/(.*)/?$ http://pypi.python.org/$1 [R,L]
</code></pre><p>The last set of rewrite directives check to see if the request refers to an existing file or directory under your document root. If it does, your server will reply with a directory listing or with the actual file to download. If the directory or file doesn&rsquo;t exist, apache will send the client a redirection to the main PyPi site.</p><p>Reload your apache configuration to bring in your new changes. Let&rsquo;s try to download the <code>pip</code> tarball from our local server in the example I mentioned above:</p><pre><code>$ curl -I http://pypi.example.com/simple/pip/
HTTP/1.1 200 OK

$ curl -I http://pypi.example.com/simple/pip/pip-1.0.2.tar.gz
HTTP/1.1 200 OK
</code></pre><p>I&rsquo;ve obviously snipped a bit of the response above, but you can see that apache is responding with 200&rsquo;s since it has the directories and files that I was trying to retrieve via curl. Let&rsquo;s try to get something we don&rsquo;t have locally, like <code>kombu</code>:</p><pre><code>$ curl -I http://pypi.example.com/simple/kombu/
HTTP/1.1 302 Found
Location: http://pypi.python.org/simple/kombu/
</code></pre><p>Our local PyPi repository doesn&rsquo;t have <code>kombu</code> so it will refer our Python tools over to the official PyPi repository to get the listing of available package versions for <code>kombu</code>.</p><p>Now we need to tell <code>pip</code> to use our local repository. Edit <code>~/.pip/pip.conf</code> and add:</p><div class=highlight><pre style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=color:#859900>[global]</span>
<span style=color:#268bd2>index-url</span> = <span style=color:#2aa198>http://pypi.example.com/simple/</span>
</code></pre></div><p>If you&rsquo;d rather use <code>easy_install</code>, edit <code>~/.pydistutils.cfg</code> and add:</p><div class=highlight><pre style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=color:#859900>[easy_install]</span>
<span style=color:#268bd2>index_url</span> = <span style=color:#2aa198>http://pypi.example.com/simple/</span>
</code></pre></div><p>Once your tools are configured, try installing a package you have locally and try to install one that you know you won&rsquo;t have locally. You can add <code>-v</code> to <code>pip install</code> to watch it retrieve different URL&rsquo;s to get the packages it needs. If you spot any peculiar behavior or unexpected redirections, double-check your mod_rewrite rules in your apache configuration and check the spelling of your directories under your document root.</p></content><p><a href=https://major.io/tags/apache/>#apache</a>
<a href=https://major.io/tags/command-line/>#command line</a>
<a href=https://major.io/tags/mod_rewrite/>#mod_rewrite</a>
<a href=https://major.io/tags/python/>#python</a>
<a href=https://major.io/tags/sysadmin/>#sysadmin</a></p></main><footer><hr>CC-BY-SA 4.0 &#187;
Made with <a href=https://gohugo.io/>Hugo</a> &#187;
Theme based on <a href=https://github.com/janraasch/hugo-bearblog/>Hugo Ê•â€¢á´¥â€¢Ê” Bear</a><br></footer></body></html>