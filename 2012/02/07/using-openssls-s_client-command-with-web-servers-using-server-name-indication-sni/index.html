<!doctype html><html lang=en-us><head><meta http-equiv=x-clacks-overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://major.io/favicon.ico><title>Using OpenSSLâ€™s s_client command with web servers using Server Name Indication (SNI) | Major Hayden's Blog ðŸ¤ </title><meta name=title content="Using OpenSSLâ€™s s_client command with web servers using Server Name Indication (SNI)"><meta name=description content="One of the handiest tools in the OpenSSL toolbox is s_client. You can quickly view lots of details about the SSL certificates installed on a particular server and diagnose problems. For example, use this command to look at Google&rsquo;s SSL certificates:
openssl s_client -connect encrypted.google.com:443 You&rsquo;ll see the chain of certificates back to the original certificate authority where Google bought its certificate at the top, a copy of their SSL certificate in plain text in the middle, and a bunch of session-related information at the bottom."><meta name=keywords content="apache,command line,networking,security,ssl,sysadmin,web,"><meta property="og:title" content="Using OpenSSLâ€™s s_client command with web servers using Server Name Indication (SNI)"><meta property="og:description" content="One of the handiest tools in the OpenSSL toolbox is s_client. You can quickly view lots of details about the SSL certificates installed on a particular server and diagnose problems. For example, use this command to look at Google&rsquo;s SSL certificates:
openssl s_client -connect encrypted.google.com:443 You&rsquo;ll see the chain of certificates back to the original certificate authority where Google bought its certificate at the top, a copy of their SSL certificate in plain text in the middle, and a bunch of session-related information at the bottom."><meta property="og:type" content="article"><meta property="og:url" content="https://major.io/2012/02/07/using-openssls-s_client-command-with-web-servers-using-server-name-indication-sni/"><meta property="og:image" content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2012-02-07T14:07:41+00:00"><meta property="article:modified_time" content="2012-02-07T14:07:41+00:00"><meta property="og:site_name" content="Major Hayden's Blog ðŸ¤ "><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta name=twitter:title content="Using OpenSSLâ€™s s_client command with web servers using Server Name Indication (SNI)"><meta name=twitter:description content="One of the handiest tools in the OpenSSL toolbox is s_client. You can quickly view lots of details about the SSL certificates installed on a particular server and diagnose problems. For example, use this command to look at Google&rsquo;s SSL certificates:
openssl s_client -connect encrypted.google.com:443 You&rsquo;ll see the chain of certificates back to the original certificate authority where Google bought its certificate at the top, a copy of their SSL certificate in plain text in the middle, and a bunch of session-related information at the bottom."><meta name=twitter:site content="@mhayden"><meta itemprop=name content="Using OpenSSLâ€™s s_client command with web servers using Server Name Indication (SNI)"><meta itemprop=description content="One of the handiest tools in the OpenSSL toolbox is s_client. You can quickly view lots of details about the SSL certificates installed on a particular server and diagnose problems. For example, use this command to look at Google&rsquo;s SSL certificates:
openssl s_client -connect encrypted.google.com:443 You&rsquo;ll see the chain of certificates back to the original certificate authority where Google bought its certificate at the top, a copy of their SSL certificate in plain text in the middle, and a bunch of session-related information at the bottom."><meta itemprop=datePublished content="2012-02-07T14:07:41+00:00"><meta itemprop=dateModified content="2012-02-07T14:07:41+00:00"><meta itemprop=wordCount content="396"><meta itemprop=image content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta itemprop=keywords content="apache,command line,networking,security,ssl,sysadmin,web,"><meta name=referrer content="no-referrer-when-downgrade"><style>body{font-family:Verdana,sans-serif;margin:auto;padding:20px;max-width:820px;text-align:left;background-color:#fff;word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:#444}h1,h2,h3,h4,h5,h6,strong,b{color:#222}a{color:#3273dc}.title{text-decoration:none;border:0}.title span{font-weight:400}nav a{margin-right:10px}textarea{width:100%;font-size:16px}input{font-size:16px}content{line-height:1.6}table{width:100%}img{max-width:100%}code{padding:2px 5px;background-color:#f2f2f2}pre code{color:#222;display:block;padding:20px;white-space:pre-wrap;font-size:14px}div.highlight code{background-color:unset;color:initial}blockquote{border-left:1px solid #999;color:#222;padding-left:20px;font-style:italic}footer{padding:25px;text-align:center}.helptext{color:#777;font-size:small}.errorlist{color:#eba613;font-size:small}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:#8b6fcb}@media(prefers-color-scheme:dark){body{background-color:#333;color:#ddd}h1,h2,h3,h4,h5,h6,strong,b{color:#eee}a{color:#8cc2dd}code{background-color:#777}pre code{color:#ddd}blockquote{color:#ccc}textarea,input{background-color:#252525;color:#ddd}.helptext{color:#aaa}}</style></head><body><header><a href=../../../../ class=title><h2>Major Hayden's Blog ðŸ¤ </h2></a><nav><a href=../../../../>Home</a>
<a href=../../../../ham-radio-faq>Ham Radio</a>
<a href=../../../../icanhazip-com-faq>icanhazip FAQ</a>
<a href=../../../../posts>Posts</a></nav></header><main><h1>Using OpenSSLâ€™s s_client command with web servers using Server Name Indication (SNI)</h1><i><time datetime=2012-02-07 pubdate>2012-02-07</time></i>
<content><p>One of the handiest tools in the OpenSSL toolbox is <code>s_client</code>. You can quickly view lots of details about the SSL certificates installed on a particular server and diagnose problems. For example, use this command to look at Google&rsquo;s SSL certificates:</p><pre><code>openssl s_client -connect encrypted.google.com:443
</code></pre><p>You&rsquo;ll see the chain of certificates back to the original certificate authority where Google bought its certificate at the top, a copy of their SSL certificate in plain text in the middle, and a bunch of session-related information at the bottom.</p><p>This works really well when a site has one SSL certificate installed per IP address (this used to be a hard requirement). With <a href=http://en.wikipedia.org/wiki/Server_Name_Indication>Server Name Indication</a> (SNI), a web server can have multiple SSL certificates installed on the same IP address. SNI-capable browsers will specify the hostname of the server they&rsquo;re trying to reach during the initial handshake process. This allows the web server to determine the correct SSL certificate to use for the connection.</p><p>If you try to connect to rackerhacker.com with <code>s_client</code>, you&rsquo;ll find that you receive the default SSL certificate installed on my server and not the one for this site:</p><pre><code>$ openssl s_client -connect rackerhacker.com:443
Certificate chain
 0 s:/C=US/ST=Texas/L=San Antonio/O=MHTX Enterprises/CN=*.mhtx.net
   i:/C=US/O=SecureTrust Corporation/CN=SecureTrust CA
 1 s:/C=US/O=SecureTrust Corporation/CN=SecureTrust CA
   i:/C=US/O=Entrust.net/OU=www.entrust.net/CPS incorp. by ref. (limits liab.)/OU=(c) 1999 Entrust.net Limited/CN=Entrust.net Secure Server Certification Authority
</code></pre><p>Add on the <code>-servername</code> argument and <code>s_client</code> will do the additional SNI negotiation step for you:</p><pre><code>$ openssl s_client -connect rackerhacker.com:443 -servername rackerhacker.com
Certificate chain
 0 s:/OU=Domain Control Validated/OU=PositiveSSL/CN=rackerhacker.com
   i:/C=GB/ST=Greater Manchester/L=Salford/O=Comodo CA Limited/CN=PositiveSSL CA
 1 s:/C=GB/ST=Greater Manchester/L=Salford/O=Comodo CA Limited/CN=PositiveSSL CA
   i:/C=US/ST=UT/L=Salt Lake City/O=The USERTRUST Network/OU=http://www.usertrust.com/CN=UTN-USERFirst-Hardware
 2 s:/C=US/ST=UT/L=Salt Lake City/O=The USERTRUST Network/OU=http://www.usertrust.com/CN=UTN-USERFirst-Hardware
   i:/C=SE/O=AddTrust AB/OU=AddTrust External TTP Network/CN=AddTrust External CA Root
 3 s:/C=SE/O=AddTrust AB/OU=AddTrust External TTP Network/CN=AddTrust External CA Root
   i:/C=SE/O=AddTrust AB/OU=AddTrust External TTP Network/CN=AddTrust External CA Root
</code></pre><p>You may be asking yourself this question:</p><blockquote><p>Why doesn&rsquo;t the web server just use the <code>Host:</code> header that my browser sends already to figure out which SSL certificate to use?</p></blockquote><p>Keep in mind that the SSL negotiation must occur <strong>prior</strong> to sending the HTTP request through to the remote server. That means that the browser and the server have to do the certificate exchange earlier in the process and the browser wouldn&rsquo;t get the opportunity to specify which site it&rsquo;s trying to reach. SNI fixes that by allowing a <code>Host:</code> header type of exchange during the SSL negotiation process.</p></content><p><a href=https://major.io/tags/apache/>#apache</a>
<a href=https://major.io/tags/command-line/>#command line</a>
<a href=https://major.io/tags/networking/>#networking</a>
<a href=https://major.io/tags/security/>#security</a>
<a href=https://major.io/tags/ssl/>#ssl</a>
<a href=https://major.io/tags/sysadmin/>#sysadmin</a>
<a href=https://major.io/tags/web/>#web</a></p></main><footer><hr>CC-BY-SA 4.0 &#187;
Made with <a href=https://gohugo.io/>Hugo</a> &#187;
Theme based on <a href=https://github.com/janraasch/hugo-bearblog/>Hugo Ê•â€¢á´¥â€¢Ê” Bear</a><br></footer></body></html>