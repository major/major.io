<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="Major Hayden"><meta name=description content="I&amp;rsquo;ll be the first one to admit that Kerberos drives me a little insane. It&amp;rsquo;s a requirement for two of the exams in Red Hat&amp;rsquo;s RHCA certification track and I&amp;rsquo;ve been forced to learn it. It provides some pretty nice security features for large server environments. You get central single sign ons, encrypted authentication, and bidirectional validation. However, getting it configured can be a real pain due to some rather archaic commands and shells."><meta name=keywords content=",command line,fedora,kerberos,linux,network,networking,red hat,rhca,security,ssh"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://major.io/2012/02/02/kerberos-for-haters/><title>Kerberos for haters :: Major Hayden ðŸ¤  â€” Words of wisdom from a social nerd</title><link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css rel=stylesheet type=text/css><link rel=stylesheet href=../../../../main.89fa80e2143f71bd5c96a7c94e531dec3276a367e22f87e74a76026ab64680bf.css><link rel=apple-touch-icon sizes=180x180 href=../../../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../../../favicon-16x16.png><link rel=manifest href=../../../../site.webmanifest><link rel=mask-icon href=../../../../safari-pinned-tab.svg color=#252627><link rel="shortcut icon" href=../../../../favicon.ico><meta name=msapplication-TileColor content="#252627"><meta name=theme-color content="#252627"><meta itemprop=name content="Kerberos for haters"><meta itemprop=description content="I&rsquo;ll be the first one to admit that Kerberos drives me a little insane. It&rsquo;s a requirement for two of the exams in Red Hat&rsquo;s RHCA certification track and I&rsquo;ve been forced to learn it. It provides some pretty nice security features for large server environments. You get central single sign ons, encrypted authentication, and bidirectional validation. However, getting it configured can be a real pain due to some rather archaic commands and shells."><meta itemprop=datePublished content="2012-02-03T04:29:32+00:00"><meta itemprop=dateModified content="2012-02-03T04:29:32+00:00"><meta itemprop=wordCount content="686"><meta itemprop=image content="https://major.io"><meta itemprop=keywords content="command line,fedora,kerberos,linux,network,networking,red hat,rhca,security,ssh,"><meta property="article:section" content="Blog Posts"><meta property="article:published_time" content="2012-02-03 04:29:32 +0000 UTC"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Kerberos for haters :: Major Hayden ðŸ¤ "><meta name=twitter:description content><meta name=twitter:site content="https://major.io"><meta name=twitter:creator content="Major Hayden"><meta name=twitter:image content><style type=text/css>html{letter-spacing:unset}</style></head><body class=dark-theme><div class=container><header class=header><span class=header__inner><a href=../../../../ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>$ echo major.io</span>
<span class=logo__cursor style=visibility:hidden></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=../../../../ham-radio-faq>hamradio</a></li><li><a href=../../../../icanhazip-com-faq>icanhazip</a></li><li><a href=../../../../posts/>posts</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41C32.4934 41 41 32.4934 41 22 41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href=https://major.io/2012/02/02/kerberos-for-haters/>Kerberos for haters</a></h2><div class=post-content><p>I&rsquo;ll be the first one to admit that Kerberos drives me a little insane. It&rsquo;s a requirement for two of the exams in <a href=http://www.redhat.com/training/certifications/rhca/>Red Hat&rsquo;s RHCA certification track</a> and I&rsquo;ve been forced to learn it. It provides some pretty nice security features for large server environments. You get central single sign ons, encrypted authentication, and bidirectional validation. However, getting it configured can be a real pain due to some rather archaic commands and shells.</p><p>Here&rsquo;s Kerberos in a nutshell within a two-server environment: One server is a Kerberos key distribution center (KDC) and the other is a Kerberos client. The KDC has the list of users and their passwords. Consider a situation where a user tries to ssh into the Kerberos client:</p><ul><li>sshd calls to pam to authenticate the user</li><li>pam calls to the KDC for a ticket granting ticket (TGT) to see if the user can authenticate</li><li>the KDC replies to the client with a TGT encrypted with the user&rsquo;s password</li><li>pam (on the client) tries to decrypt the TGT with the password that the user provided via ssh</li><li>if pam can decrypt the TGT, it knows the user is providing the right password</li></ul><p>Now that the client has a a TGT for that user, it can ask for tickets to access other network services. What if the user who just logged in wants to access another Kerberized service in the environment?</p><ul><li>client calls the KDC and asks for a ticket to grant access to the other service</li><li>KDC replies with two copies of the ticket:<ul><li>one copy is encrypted with the user&rsquo;s current TGT</li><li>a second copy is encrypted with the password of the network service the user wants to access</li></ul></li><li>the client can decrypt the ticket which was encrypted with the current TGT since it has the TGT already</li><li>client makes an authenticator by taking the decrypted ticket and encrypting it with a timestamp</li><li>client passes the authenticator and the second copy of the ticket it received from the KDC</li><li>the other network service decrypts the second copy of the ticket and verifies the password</li><li>the other network service uses the decrypted ticket to decrypt the authenticator it received from the client</li><li>if the timestamp looks good, the other network service allows the user access</li></ul><p>Okay, that&rsquo;s confusing. Let&rsquo;s take it one step further. Enabling pre-authentication requires that clients send a request containing a timestamp encrypted with the user&rsquo;s password prior to asking for a TGT. Without this requirement, an attacker can ask for a TGT one time and then brute force the TGT offline. Pre-authentication forces the client to send a timestamped request encrypted with the user&rsquo;s password back to the KDC before they can ask for a TGT. This means the attacker is forced to try different passwords when encrypting the timestamp in the hopes that they&rsquo;ll get a TGT to work with eventually. One would hope that you have something configured on the KDC to set off an alarm for multiple failed pre-authentication attempts.</p><p>Oh, but we can totally kick it up another notch. What if an attacker is able to give a bad password to a client but they&rsquo;re also able to impersonate the KDC? They could reply to the TGT request (as the KDC) with a TGT encrypted with whichever password they choose and get access to the client system. Enabling mutual authentication stops this attack since it forces the client to ask the KDC for the client&rsquo;s own host principal password (this password is set when the client is configured to talk to the KDC). The attacker shouldn&rsquo;t have any clue what that password is and the attack will be thwarted.</p><p>By this point, you&rsquo;re either saying &ldquo;Oh man, I don&rsquo;t ever want to do this.&rdquo; or &ldquo;How do I set up Kerberos?&rdquo;. Stay tuned if you&rsquo;re in the second group. I&rsquo;ll have a dead simple (or as close to dead simple as one can get with Kerberos) how-to on the blog shortly.</p><p>In the meantime, here are a few links for extra Kerberos bedtime reading:</p><ul><li><a href=http://en.wikipedia.org/wiki/Kerberos_(protocol)>Kerberos on Wikipedia</a></li><li><a href=http://www.kerberos.org/software/whykerberos.pdf>MIT&rsquo;s &ldquo;Why Kerberos&rdquo;</a> [PDF]</li><li><a href=http://learn-networking.com/network-security/how-kerberos-authentication-works>How Kerberos Authentication Works</a></li></ul></div></article><hr><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://major.io/tags/command-line/>command line</a></span>
<span class=tag><a href=https://major.io/tags/fedora/>fedora</a></span>
<span class=tag><a href=https://major.io/tags/kerberos/>kerberos</a></span>
<span class=tag><a href=https://major.io/tags/linux/>linux</a></span>
<span class=tag><a href=https://major.io/tags/network/>network</a></span>
<span class=tag><a href=https://major.io/tags/networking/>networking</a></span>
<span class=tag><a href=https://major.io/tags/red-hat/>red hat</a></span>
<span class=tag><a href=https://major.io/tags/rhca/>rhca</a></span>
<span class=tag><a href=https://major.io/tags/security/>security</a></span>
<span class=tag><a href=https://major.io/tags/ssh/>ssh</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-folder meta-icon"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg><span class=tag><a href=https://major.io/categories/blog-posts/>Blog Posts</a></span></p></div></main></div><footer class=footer><div class=footer__inner><div class=footer__content><span>&copy; 2021</span>
<span><a href=https://major.io>Major Hayden</a></span>
<span><a href=https://creativecommons.org/licenses/by-sa/2.0/ target=_blank rel=noopener>CC BY-SA 2.0</a></span><span><a href=https://major.io/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></span></div></div><div class=footer__inner><div class=footer__content><span>Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>Made with &#10084; by <a href=https://github.com/rhazdon>Djordje Atlialp</a></span></div></div></footer></div><script type=text/javascript src=../../../../bundle.min.9dd6c4fd1eb55000d257db1269676cdb26bfcc9ab1b1dc8885a54f94b97fa86e6d72e435907d76f8662e0f65472e78ab8ad69c36624d8d4a96c04c42e029d957.js integrity="sha512-ndbE/R61UADSV9sSaWds2ya/zJqxsdyIhaVPlLl/qG5tcuQ1kH12+GYuD2VHLniritacNmJNjUqWwExC4CnZVw=="></script></body></html>