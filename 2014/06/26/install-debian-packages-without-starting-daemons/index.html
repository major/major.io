<!doctype html><html lang=en-us><head><meta http-equiv=x-clacks-overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://major.io/favicon.ico><title>Install Debian packages without starting daemons | Major Hayden's Blog ü§†</title><meta name=title content="Install Debian packages without starting daemons"><meta name=description content="My work at Rackspace has involved working with a bunch of Debian chroots lately. One problem I had was that daemons tried to start in the chroot as soon as I installed them. That created errors and made my ansible output look terrible.
If you&rsquo;d like to prevent daemons from starting after installing a package, just toss a few lines into /usr/sbin/policy-rc.d:
cat > /usr/sbin/policy-rc.d << EOF #!/bin/sh echo &#34;All runlevel operations denied by policy&#34; >&2 exit 101 EOF Now, install any packages that you need and the daemons will remain stopped until you start them (or reboot the server)."><meta name=keywords content="centos,debian,fedora,red hat,yum,"><meta property="og:title" content="Install Debian packages without starting daemons"><meta property="og:description" content="My work at Rackspace has involved working with a bunch of Debian chroots lately. One problem I had was that daemons tried to start in the chroot as soon as I installed them. That created errors and made my ansible output look terrible.
If you&rsquo;d like to prevent daemons from starting after installing a package, just toss a few lines into /usr/sbin/policy-rc.d:
cat > /usr/sbin/policy-rc.d << EOF #!/bin/sh echo &#34;All runlevel operations denied by policy&#34; >&2 exit 101 EOF Now, install any packages that you need and the daemons will remain stopped until you start them (or reboot the server)."><meta property="og:type" content="article"><meta property="og:url" content="https://major.io/2014/06/26/install-debian-packages-without-starting-daemons/"><meta property="og:image" content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2014-06-26T20:39:44+00:00"><meta property="article:modified_time" content="2014-06-26T20:39:44+00:00"><meta property="og:site_name" content="Major Hayden's Blog ü§†"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta name=twitter:title content="Install Debian packages without starting daemons"><meta name=twitter:description content="My work at Rackspace has involved working with a bunch of Debian chroots lately. One problem I had was that daemons tried to start in the chroot as soon as I installed them. That created errors and made my ansible output look terrible.
If you&rsquo;d like to prevent daemons from starting after installing a package, just toss a few lines into /usr/sbin/policy-rc.d:
cat > /usr/sbin/policy-rc.d << EOF #!/bin/sh echo &#34;All runlevel operations denied by policy&#34; >&2 exit 101 EOF Now, install any packages that you need and the daemons will remain stopped until you start them (or reboot the server)."><meta name=twitter:site content="@mhayden"><meta itemprop=name content="Install Debian packages without starting daemons"><meta itemprop=description content="My work at Rackspace has involved working with a bunch of Debian chroots lately. One problem I had was that daemons tried to start in the chroot as soon as I installed them. That created errors and made my ansible output look terrible.
If you&rsquo;d like to prevent daemons from starting after installing a package, just toss a few lines into /usr/sbin/policy-rc.d:
cat > /usr/sbin/policy-rc.d << EOF #!/bin/sh echo &#34;All runlevel operations denied by policy&#34; >&2 exit 101 EOF Now, install any packages that you need and the daemons will remain stopped until you start them (or reboot the server)."><meta itemprop=datePublished content="2014-06-26T20:39:44+00:00"><meta itemprop=dateModified content="2014-06-26T20:39:44+00:00"><meta itemprop=wordCount content="379"><meta itemprop=image content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta itemprop=keywords content="centos,debian,fedora,red hat,yum,"><meta name=referrer content="no-referrer-when-downgrade"><style>body{font-family:Verdana,sans-serif;margin:auto;padding:20px;max-width:820px;text-align:left;background-color:#fff;word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:#444}h1,h2,h3,h4,h5,h6,strong,b{color:#222}a{color:#3273dc}.title{text-decoration:none;border:0}.title span{font-weight:400}nav a{margin-right:10px}textarea{width:100%;font-size:16px}input{font-size:16px}content{line-height:1.6}table{width:100%}img{max-width:100%}code{padding:2px 5px;background-color:#f2f2f2}pre code{color:#222;display:block;padding:20px;white-space:pre-wrap;font-size:14px}div.highlight code{background-color:unset;color:initial}blockquote{border-left:1px solid #999;color:#222;padding-left:20px;font-style:italic}footer{padding:25px;text-align:center}.helptext{color:#777;font-size:small}.errorlist{color:#eba613;font-size:small}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:#8b6fcb}@media(prefers-color-scheme:dark){body{background-color:#333;color:#ddd}h1,h2,h3,h4,h5,h6,strong,b{color:#eee}a{color:#8cc2dd}code{background-color:#777}pre code{color:#ddd}blockquote{color:#ccc}textarea,input{background-color:#252525;color:#ddd}.helptext{color:#aaa}}</style></head><body><header><a href=../../../../ class=title><h2>Major Hayden's Blog ü§†</h2></a><nav><a href=../../../../>Home</a>
<a href=../../../../ham-radio-faq>Ham Radio</a>
<a href=../../../../icanhazip-com-faq>icanhazip FAQ</a>
<a href=../../../../posts>Posts</a></nav></header><main><h1>Install Debian packages without starting daemons</h1><i><time datetime=2014-06-26 pubdate>2014-06-26</time></i>
<content><p>My work at Rackspace has involved working with a bunch of Debian chroots lately. One problem I had was that daemons tried to start in the chroot as soon as I installed them. That created errors and made my ansible output look terrible.</p><p>If you&rsquo;d like to prevent daemons from starting after installing a package, just toss a few lines into <em>/usr/sbin/policy-rc.d</em>:</p><div class=highlight><pre style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>cat &gt; /usr/sbin/policy-rc.d <span style=color:#2aa198>&lt;&lt; EOF
</span><span style=color:#2aa198>#!/bin/sh
</span><span style=color:#2aa198>echo &#34;All runlevel operations denied by policy&#34; &gt;&amp;2
</span><span style=color:#2aa198>exit 101
</span><span style=color:#2aa198>EOF</span>
</code></pre></div><p>Now, install any packages that you need and the daemons will remain stopped until you start them (or reboot the server). Be sure to remove the policy file you added once you&rsquo;re done installing your packages.</p><hr><p>This seems like a good opportunity to get on a soapbox about automatically starting daemons. ;)</p><p>I still have a very difficult time understanding why Debian-based distributions start daemons as soon as the package is installed. Having an option to enable this might be useful for some situations, but this <strong>shouldn&rsquo;t be the default</strong>.</p><p>You end up with situations like the one in this <a href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=723080">puppet bug report</a>. The daemon shouldn&rsquo;t start until you&rsquo;re ready to configure it and use it. However, the logic is that the daemon is so horribly un-configured that it shouldn&rsquo;t hurt anything if starts immediately. So why start the daemon at all?</p><p>When I run the command <em>apt-get install</em> or <em>yum install</em>, I expect that packages will be installed to disk and nothing more. Even the <a href=https://en.wiktionary.org/wiki/install>definition of the English word &ldquo;install&rdquo;</a> talks about ‚Äúpreparing‚Äù something for use, not actually using it:</p><blockquote><p>To connect, set up or prepare something for use</p></blockquote><p><strong>If I install an electrical switch at home, I don&rsquo;t install it in the ON position with my circuit breaker in the ON position.</strong> I install it with everything off, verify my work, ensure that it fits in place, and then I apply power. The installation and actual <strong>use</strong> of the new switch are two completely separate activities with additional work required in between.</p><p>I strongly urge the Debian community to consider switching to a mechanism where daemons don&rsquo;t start until the users configure them properly and are ready to use them. This makes configuration management much easier, improves security, and provides consistency with almost every other Linux distribution.</p></content><p><a href=https://major.io/tags/centos/>#centos</a>
<a href=https://major.io/tags/debian/>#debian</a>
<a href=https://major.io/tags/fedora/>#fedora</a>
<a href=https://major.io/tags/red-hat/>#red hat</a>
<a href=https://major.io/tags/yum/>#yum</a></p></main><footer><script async src=https://media.ethicalads.io/media/client/ethicalads.min.js></script><div data-ea-publisher=major-io data-ea-type=text></div><hr>CC-BY-SA 4.0 &#187;
Made with <a href=https://gohugo.io/>Hugo</a> &#187;
Theme based on <a href=https://github.com/janraasch/hugo-bearblog/>Hugo  ï‚Ä¢·¥•‚Ä¢ î Bear</a><br></footer></body></html>