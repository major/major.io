<!doctype html><html lang=en-us><head><meta http-equiv=x-clacks-overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://major.io/favicon.ico><title>Docker, trusted builds, and Fedora 20 | Major Hayden's Blog ðŸ¤ </title><meta name=title content="Docker, trusted builds, and Fedora 20"><meta name=description content="Docker is a hot topic in the Linux world at the moment and I decided to try out the new trusted build process. Long story short, you put your Dockerfile along with any additional content into your GitHub repository, link your GitHub account with Docker, and then fire off a build. The Docker index labels it as &ldquo;trusted&rdquo; since it was build from source files in your repository.
I set off to build a Dockerfile to provision a container that would run all of the icanhazip services."><meta name=keywords content="containers,docker,fedora,icanhazip,linux,lxc,virtualization,web,"><meta property="og:title" content="Docker, trusted builds, and Fedora 20"><meta property="og:description" content="Docker is a hot topic in the Linux world at the moment and I decided to try out the new trusted build process. Long story short, you put your Dockerfile along with any additional content into your GitHub repository, link your GitHub account with Docker, and then fire off a build. The Docker index labels it as &ldquo;trusted&rdquo; since it was build from source files in your repository.
I set off to build a Dockerfile to provision a container that would run all of the icanhazip services."><meta property="og:type" content="article"><meta property="og:url" content="https://major.io/2014/03/26/docker-trusted-builds-and-fedora-20/"><meta property="og:image" content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2014-03-26T05:17:58+00:00"><meta property="article:modified_time" content="2020-02-12T16:36:14-06:00"><meta property="og:site_name" content="Major Hayden's Blog ðŸ¤ "><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta name=twitter:title content="Docker, trusted builds, and Fedora 20"><meta name=twitter:description content="Docker is a hot topic in the Linux world at the moment and I decided to try out the new trusted build process. Long story short, you put your Dockerfile along with any additional content into your GitHub repository, link your GitHub account with Docker, and then fire off a build. The Docker index labels it as &ldquo;trusted&rdquo; since it was build from source files in your repository.
I set off to build a Dockerfile to provision a container that would run all of the icanhazip services."><meta name=twitter:site content="@mhayden"><meta itemprop=name content="Docker, trusted builds, and Fedora 20"><meta itemprop=description content="Docker is a hot topic in the Linux world at the moment and I decided to try out the new trusted build process. Long story short, you put your Dockerfile along with any additional content into your GitHub repository, link your GitHub account with Docker, and then fire off a build. The Docker index labels it as &ldquo;trusted&rdquo; since it was build from source files in your repository.
I set off to build a Dockerfile to provision a container that would run all of the icanhazip services."><meta itemprop=datePublished content="2014-03-26T05:17:58+00:00"><meta itemprop=dateModified content="2020-02-12T16:36:14-06:00"><meta itemprop=wordCount content="417"><meta itemprop=image content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta itemprop=keywords content="containers,docker,fedora,icanhazip,linux,lxc,virtualization,web,"><meta name=referrer content="no-referrer-when-downgrade"><style>body{font-family:Verdana,sans-serif;margin:auto;padding:20px;max-width:820px;text-align:left;background-color:#fff;word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:#444}h1,h2,h3,h4,h5,h6,strong,b{color:#222}a{color:#3273dc}.title{text-decoration:none;border:0}.title span{font-weight:400}nav a{margin-right:10px}textarea{width:100%;font-size:16px}input{font-size:16px}content{line-height:1.6}table{width:100%}img{max-width:100%}code{padding:2px 5px;background-color:#f2f2f2}pre code{color:#222;display:block;padding:20px;white-space:pre-wrap;font-size:14px}div.highlight code{background-color:unset;color:initial}blockquote{border-left:1px solid #999;color:#222;padding-left:20px;font-style:italic}footer{padding:25px;text-align:center}.helptext{color:#777;font-size:small}.errorlist{color:#eba613;font-size:small}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:#8b6fcb}@media(prefers-color-scheme:dark){body{background-color:#333;color:#ddd}h1,h2,h3,h4,h5,h6,strong,b{color:#eee}a{color:#8cc2dd}code{background-color:#777}pre code{color:#ddd}blockquote{color:#ccc}textarea,input{background-color:#252525;color:#ddd}.helptext{color:#aaa}}</style></head><body><header><a href=../../../../ class=title><h2>Major Hayden's Blog ðŸ¤ </h2></a><nav><a href=../../../../>Home</a>
<a href=../../../../ham-radio-faq>Ham Radio</a>
<a href=../../../../icanhazip-com-faq>icanhazip FAQ</a>
<a href=../../../../posts>Posts</a></nav><script async src=https://media.ethicalads.io/media/client/ethicalads.min.js></script><div class="adaptive raised" data-ea-publisher=major-io data-ea-type=text></div></header><main><h1>Docker, trusted builds, and Fedora 20</h1><i><time datetime=2014-03-26 pubdate>2014-03-26</time></i>
<content><p><a href=../../../../wp-content/uploads/2014/03/docker-whale.png></a></p><p><a href=../../../../wp-content/uploads/2012/01/fedorainfinity.png></a>Docker is a hot topic in the Linux world at the moment and I decided to try out the new <a href=http://blog.docker.io/2013/11/introducing-trusted-builds/>trusted build process</a>. Long story short, you put your Dockerfile along with any additional content into your GitHub repository, link your GitHub account with Docker, and then fire off a build. The Docker index labels it as &ldquo;trusted&rdquo; since it was build from source files in your repository.</p><p>I set off to build a Dockerfile to provision a container that would run all of the <a href=../../../../icanhazip-com-faq/>icanhazip</a> services. Getting httpd running was a little tricky, but I soon had a <a href=https://github.com/major/icanhaz/blob/master/docker/Dockerfile>working Dockerfile</a> that built and ran successfully on Fedora 20.</p><p>The trusted build process kicked off without much fuss and I found myself waiting for a couple of hours for my job to start. I was sad to see an error after waiting so long:</p><pre><code>Installing : httpd-2.4.7-3.fc20.x86_64
error: unpacking of archive failed on file /usr/sbin/suexec: cpio: cap_set_file
</code></pre><p>Well, that&rsquo;s weird. It turns out that <code>cap_set_file</code> is part of libcap that sets filesystem capabilities based on the POSIX.1e standards. You can read up on capabilities in the <a href=https://www.kernel.org/pub/linux/libs/security/linux-privs/kernel-2.2/capfaq-0.2.txt>Linux kernel capabilities FAQ</a>. <em>(Special thanks to Andrew Clayton getting me pointed in the right direction there.)</em></p><p><a href=http://fedoraproject.org/wiki/User:Goldmann>Marek Goldmann</a> ran into this problem back in September 2013 and opened a <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1012952">bug report</a>. Marek <a href="https://bugzilla.redhat.com/attachment.cgi?id=804061&action=diff">proposed a change</a> to the Docker codebase that would remove setfcap from the list of banned capabilities in the LXC template used by docker. Another workaround would be to use the <code>-privileged</code> option to perform a build in privileged mode (available in docker 0.6+).</p><p>Both of those workarounds are unavailable when doing trusted builds with docker&rsquo;s index. Sigh.</p><p>I fired off an email to Docker&rsquo;s support staff and received a quick reply:</p><blockquote><p>Major,</p><p>We are aware of this issue, and we are currently working on a fix, and we hope to have something we can start testing this week. I&rsquo;m not sure when we will be able to roll out the fix, but we are hoping soon. Until then, there isn&rsquo;t anything you can do to work around it. Sorry for the inconvenience.</p><p>If anything changes, we will be sure to let you know.</p><p>Ken</p></blockquote><p>It wasn&rsquo;t the answer I wanted but it&rsquo;s good to know that the issue is being worked. In the meantime, I&rsquo;ll push an untrusted build of the icanhazip Docker container up to the index for everyone to enjoy.</p><p>Stay tuned for updates.</p><p><em><strong>UPDATED 2014-08-08:</strong> Per Thomas' comment below, this has been <a href=https://github.com/docker/docker/pull/5930>fixed upstream</a>.</em></p></content><p><a href=https://major.io/tags/containers/>#containers</a>
<a href=https://major.io/tags/docker/>#docker</a>
<a href=https://major.io/tags/fedora/>#fedora</a>
<a href=https://major.io/tags/icanhazip/>#icanhazip</a>
<a href=https://major.io/tags/linux/>#linux</a>
<a href=https://major.io/tags/lxc/>#lxc</a>
<a href=https://major.io/tags/virtualization/>#virtualization</a>
<a href=https://major.io/tags/web/>#web</a></p></main><footer><hr>CC-BY-SA 4.0 &#187;
Made with <a href=https://gohugo.io/>Hugo</a> &#187;
Theme based on <a href=https://github.com/janraasch/hugo-bearblog/>Hugo Ê•â€¢á´¥â€¢Ê” Bear</a> &#187;
<a href=https://github.com/major/major.io/commit/84372fb2198913a5e498b8d32ffc77fb813f0a48>84372fb2</a></footer></body></html>