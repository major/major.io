<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="Major Hayden"><meta name=description content="Docker is a hot topic in the Linux world at the moment and I decided to try out the new trusted build process. Long story short, you put your Dockerfile along with any additional content into your GitHub repository, link your GitHub account with Docker, and then fire off a build. The Docker index labels it as &amp;ldquo;trusted&amp;rdquo; since it was build from source files in your repository.
I set off to build a Dockerfile to provision a container that would run all of the icanhazip services."><meta name=keywords content=",containers,docker,fedora,icanhazip,linux,lxc,virtualization,web"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://major.io/2014/03/26/docker-trusted-builds-and-fedora-20/><title>Docker, trusted builds, and Fedora 20 :: Major Hayden ðŸ¤  â€” Words of wisdom from a social nerd</title><link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css rel=stylesheet type=text/css><link rel=stylesheet href=../../../../main.min.5dcefbf8102eb536dd3e2de53ffebfa58599ab2435c241a0db81728a5e015f2e.css><link rel=apple-touch-icon sizes=180x180 href=../../../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../../../favicon-16x16.png><link rel=manifest href=../../../../site.webmanifest><link rel=mask-icon href=../../../../safari-pinned-tab.svg color=#252627><link rel="shortcut icon" href=../../../../favicon.ico><meta name=msapplication-TileColor content="#252627"><meta name=theme-color content="#252627"><meta itemprop=name content="Docker, trusted builds, and Fedora 20"><meta itemprop=description content="Docker is a hot topic in the Linux world at the moment and I decided to try out the new trusted build process. Long story short, you put your Dockerfile along with any additional content into your GitHub repository, link your GitHub account with Docker, and then fire off a build. The Docker index labels it as &ldquo;trusted&rdquo; since it was build from source files in your repository.
I set off to build a Dockerfile to provision a container that would run all of the icanhazip services."><meta itemprop=datePublished content="2014-03-26T05:17:58+00:00"><meta itemprop=dateModified content="2014-03-26T05:17:58+00:00"><meta itemprop=wordCount content="417"><meta itemprop=image content="https://major.io"><meta itemprop=keywords content="containers,docker,fedora,icanhazip,linux,lxc,virtualization,web,"><meta property="article:section" content="Blog Posts"><meta property="article:published_time" content="2014-03-26 05:17:58 +0000 UTC"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Docker, trusted builds, and Fedora 20 :: Major Hayden ðŸ¤ "><meta name=twitter:description content><meta name=twitter:site content="https://major.io"><meta name=twitter:creator content="Major Hayden"><meta name=twitter:image content><style type=text/css>html{letter-spacing:unset}</style></head><body class=dark-theme><div class=container><header class=header><span class=header__inner><a href=../../../../ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>$ echo major.io</span>
<span class=logo__cursor style=visibility:hidden></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=https://major.io/ham-radio-faq>hamradio</a></li><li><a href=https://major.io/icanhazip-com-faq>icanhazip</a></li><li><a href=https://major.io/posts/>posts</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41C32.4934 41 41 32.4934 41 22 41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href=https://major.io/2014/03/26/docker-trusted-builds-and-fedora-20/>Docker, trusted builds, and Fedora 20</a></h2><div class=post-content><p><a href=../../../../wp-content/uploads/2014/03/docker-whale.png></a></p><p><a href=../../../../wp-content/uploads/2012/01/fedorainfinity.png></a>Docker is a hot topic in the Linux world at the moment and I decided to try out the new <a href=http://blog.docker.io/2013/11/introducing-trusted-builds/>trusted build process</a>. Long story short, you put your Dockerfile along with any additional content into your GitHub repository, link your GitHub account with Docker, and then fire off a build. The Docker index labels it as &ldquo;trusted&rdquo; since it was build from source files in your repository.</p><p>I set off to build a Dockerfile to provision a container that would run all of the <a href=../../../../icanhazip-com-faq/>icanhazip</a> services. Getting httpd running was a little tricky, but I soon had a <a href=https://github.com/major/icanhaz/blob/master/docker/Dockerfile>working Dockerfile</a> that built and ran successfully on Fedora 20.</p><p>The trusted build process kicked off without much fuss and I found myself waiting for a couple of hours for my job to start. I was sad to see an error after waiting so long:</p><pre><code>Installing : httpd-2.4.7-3.fc20.x86_64
error: unpacking of archive failed on file /usr/sbin/suexec: cpio: cap_set_file
</code></pre><p>Well, that&rsquo;s weird. It turns out that <code>cap_set_file</code> is part of libcap that sets filesystem capabilities based on the POSIX.1e standards. You can read up on capabilities in the <a href=https://www.kernel.org/pub/linux/libs/security/linux-privs/kernel-2.2/capfaq-0.2.txt>Linux kernel capabilities FAQ</a>. <em>(Special thanks to Andrew Clayton getting me pointed in the right direction there.)</em></p><p><a href=http://fedoraproject.org/wiki/User:Goldmann>Marek Goldmann</a> ran into this problem back in September 2013 and opened a <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1012952">bug report</a>. Marek <a href="https://bugzilla.redhat.com/attachment.cgi?id=804061&action=diff">proposed a change</a> to the Docker codebase that would remove setfcap from the list of banned capabilities in the LXC template used by docker. Another workaround would be to use the <code>-privileged</code> option to perform a build in privileged mode (available in docker 0.6+).</p><p>Both of those workarounds are unavailable when doing trusted builds with docker&rsquo;s index. Sigh.</p><p>I fired off an email to Docker&rsquo;s support staff and received a quick reply:</p><blockquote><p>Major,</p><p>We are aware of this issue, and we are currently working on a fix, and we hope to have something we can start testing this week. I&rsquo;m not sure when we will be able to roll out the fix, but we are hoping soon. Until then, there isn&rsquo;t anything you can do to work around it. Sorry for the inconvenience.</p><p>If anything changes, we will be sure to let you know.</p><p>Ken</p></blockquote><p>It wasn&rsquo;t the answer I wanted but it&rsquo;s good to know that the issue is being worked. In the meantime, I&rsquo;ll push an untrusted build of the icanhazip Docker container up to the index for everyone to enjoy.</p><p>Stay tuned for updates.</p><p><em><strong>UPDATED 2014-08-08:</strong> Per Thomas' comment below, this has been <a href=https://github.com/docker/docker/pull/5930>fixed upstream</a>.</em></p></div></article><hr><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://major.io/tags/containers>containers</a></span><span class=tag><a href=https://major.io/tags/docker>docker</a></span><span class=tag><a href=https://major.io/tags/fedora>fedora</a></span><span class=tag><a href=https://major.io/tags/icanhazip>icanhazip</a></span><span class=tag><a href=https://major.io/tags/linux>linux</a></span><span class=tag><a href=https://major.io/tags/lxc>lxc</a></span><span class=tag><a href=https://major.io/tags/virtualization>virtualization</a></span><span class=tag><a href=https://major.io/tags/web>web</a></span></p></div></main></div><footer class=footer><div class=footer__inner><div class=footer__content><span>&copy; 2021</span>
<span><a href=https://major.io>Major Hayden</a></span>
<span><a href=https://creativecommons.org/licenses/by-sa/2.0/ target=_blank rel=noopener>CC BY-SA 2.0</a></span>
<span><a href=https://major.io/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></span></div></div><div class=footer__inner><div class=footer__content><span>Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>Made with &#10084; by <a href=https://github.com/rhazdon>rhazdon</a></span></div></div></footer></div><script type=text/javascript src=../../../../bundle.min.2d5469329143160ae2456a69c3c76dc2d0a3b212b46afe291a51bd68650ed6f8697e001dab54f1c272c77ce08092a8c55e5bb4314e0ee334aab4b927ec896638.js integrity="sha512-LVRpMpFDFgriRWppw8dtwtCjshK0av4pGlG9aGUO1vhpfgAdq1TxwnLHfOCAkqjFXlu0MU4O4zSqtLkn7IlmOA=="></script></body></html>