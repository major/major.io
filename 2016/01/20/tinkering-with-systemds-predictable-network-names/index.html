<!doctype html><html lang=en-us><head><meta http-equiv=x-clacks-overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://major.io/favicon.ico><title>Tinkering with systemdâ€™s predictable network names | Major Hayden's Blog ðŸ¤ </title><meta name=title content="Tinkering with systemdâ€™s predictable network names"><meta name=description content="I&rsquo;ve talked about predictable network names (and seemingly unpredictable ones) on the blog before, but some readers asked me how they could alter the network naming to fit a particular situation. Oddly enough, my Supermicro 5028D-T4NT has a problem with predictable names and it&rsquo;s a great example to use here.
The problem There&rsquo;s plenty of detail in my post about the Supermicro 5028D-T4NT, but the basic gist is that something within the firmware is causing the all of the network cards in the server to show up as onboard."><meta name=keywords content="command line,fedora,hardware,networking,supermicro,systemd,systemd-networkd,udev,"><meta property="og:title" content="Tinkering with systemdâ€™s predictable network names"><meta property="og:description" content="I&rsquo;ve talked about predictable network names (and seemingly unpredictable ones) on the blog before, but some readers asked me how they could alter the network naming to fit a particular situation. Oddly enough, my Supermicro 5028D-T4NT has a problem with predictable names and it&rsquo;s a great example to use here.
The problem There&rsquo;s plenty of detail in my post about the Supermicro 5028D-T4NT, but the basic gist is that something within the firmware is causing the all of the network cards in the server to show up as onboard."><meta property="og:type" content="article"><meta property="og:url" content="https://major.io/2016/01/20/tinkering-with-systemds-predictable-network-names/"><meta property="og:image" content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2016-01-20T19:46:52+00:00"><meta property="article:modified_time" content="2016-01-20T19:46:52+00:00"><meta property="og:site_name" content="Major Hayden's Blog ðŸ¤ "><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta name=twitter:title content="Tinkering with systemdâ€™s predictable network names"><meta name=twitter:description content="I&rsquo;ve talked about predictable network names (and seemingly unpredictable ones) on the blog before, but some readers asked me how they could alter the network naming to fit a particular situation. Oddly enough, my Supermicro 5028D-T4NT has a problem with predictable names and it&rsquo;s a great example to use here.
The problem There&rsquo;s plenty of detail in my post about the Supermicro 5028D-T4NT, but the basic gist is that something within the firmware is causing the all of the network cards in the server to show up as onboard."><meta name=twitter:site content="@mhayden"><meta itemprop=name content="Tinkering with systemdâ€™s predictable network names"><meta itemprop=description content="I&rsquo;ve talked about predictable network names (and seemingly unpredictable ones) on the blog before, but some readers asked me how they could alter the network naming to fit a particular situation. Oddly enough, my Supermicro 5028D-T4NT has a problem with predictable names and it&rsquo;s a great example to use here.
The problem There&rsquo;s plenty of detail in my post about the Supermicro 5028D-T4NT, but the basic gist is that something within the firmware is causing the all of the network cards in the server to show up as onboard."><meta itemprop=datePublished content="2016-01-20T19:46:52+00:00"><meta itemprop=dateModified content="2016-01-20T19:46:52+00:00"><meta itemprop=wordCount content="549"><meta itemprop=image content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta itemprop=keywords content="command line,fedora,hardware,networking,supermicro,systemd,systemd-networkd,udev,"><meta name=referrer content="no-referrer-when-downgrade"><style>body{font-family:Verdana,sans-serif;margin:auto;padding:20px;max-width:820px;text-align:left;background-color:#fff;word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:#444}h1,h2,h3,h4,h5,h6,strong,b{color:#222}a{color:#3273dc}.title{text-decoration:none;border:0}.title span{font-weight:400}nav a{margin-right:10px}textarea{width:100%;font-size:16px}input{font-size:16px}content{line-height:1.6}table{width:100%}img{max-width:100%}code{padding:2px 5px;background-color:#f2f2f2}pre code{color:#222;display:block;padding:20px;white-space:pre-wrap;font-size:14px}div.highlight code{background-color:unset;color:initial}blockquote{border-left:1px solid #999;color:#222;padding-left:20px;font-style:italic}footer{padding:25px;text-align:center}.helptext{color:#777;font-size:small}.errorlist{color:#eba613;font-size:small}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:#8b6fcb}@media(prefers-color-scheme:dark){body{background-color:#333;color:#ddd}h1,h2,h3,h4,h5,h6,strong,b{color:#eee}a{color:#8cc2dd}code{background-color:#777}pre code{color:#ddd}blockquote{color:#ccc}textarea,input{background-color:#252525;color:#ddd}.helptext{color:#aaa}}</style></head><body><header><a href=../../../../ class=title><h2>Major Hayden's Blog ðŸ¤ </h2></a><nav><a href=../../../../>Home</a>
<a href=../../../../ham-radio-faq>Ham Radio</a>
<a href=../../../../icanhazip-com-faq>icanhazip FAQ</a>
<a href=../../../../posts>Posts</a></nav></header><main><h1>Tinkering with systemdâ€™s predictable network names</h1><i><time datetime=2016-01-20 pubdate>2016-01-20</time></i>
<content><p></p><p>I&rsquo;ve talked about <a href=../../../../2015/08/21/understanding-systemds-predictable-network-device-names/>predictable network names</a> (and <a href=https://major.io/2014/08/06/unexpected-predictable-network-naming-systemd/>seemingly unpredictable ones</a>) on the blog before, but some readers asked me how they could alter the network naming to fit a particular situation. Oddly enough, my <a href=../../../../2015/09/28/first-thoughts-linux-on-the-supermicro-5028d-t4nt/>Supermicro 5028D-T4NT</a> has a problem with predictable names and it&rsquo;s a great example to use here.</p><h2 id=the-problem>The problem</h2><p>There&rsquo;s plenty of detail in my post about <a href=../../../../2015/09/28/first-thoughts-linux-on-the-supermicro-5028d-t4nt/>the Supermicro 5028D-T4NT</a>, but the basic gist is that something within the firmware is causing the all of the network cards in the server to show up as onboard. The server has two 1Gb network interfaces which show up as <code>eno1</code> and <code>eno2</code>, which makes sense. It also has two 10Gb network interfaces that systemd tries to name <code>eno1</code> and <code>eno2</code> as well. That&rsquo;s obviously not going to work, so they get renamed to <code>eth0</code> and <code>eth1</code>.</p><p>You can see what udev thinks in this output:</p><pre><code>P: /devices/pci0000:00/0000:00:02.2/0000:03:00.0/net/eth0
E: DEVPATH=/devices/pci0000:00/0000:00:02.2/0000:03:00.0/net/eth0
E: ID_BUS=pci
E: ID_MODEL_FROM_DATABASE=Ethernet Connection X552/X557-AT 10GBASE-T
E: ID_MODEL_ID=0x15ad
E: ID_NET_DRIVER=ixgbe
E: ID_NET_LINK_FILE=/usr/lib/systemd/network/99-default.link
E: ID_NET_NAME=eno1
E: ID_NET_NAME_MAC=enx0cc47a7591c8
E: ID_NET_NAME_ONBOARD=eno1
E: ID_NET_NAME_PATH=enp3s0f0
E: ID_OUI_FROM_DATABASE=Super Micro Computer, Inc.
E: ID_PATH=pci-0000:03:00.0
E: ID_PATH_TAG=pci-0000_03_00_0
E: ID_PCI_CLASS_FROM_DATABASE=Network controller
E: ID_PCI_SUBCLASS_FROM_DATABASE=Ethernet controller
E: ID_VENDOR_FROM_DATABASE=Intel Corporation
E: ID_VENDOR_ID=0x8086
E: IFINDEX=4
E: INTERFACE=eth0
E: SUBSYSTEM=net
E: SYSTEMD_ALIAS=/sys/subsystem/net/devices/eno1
E: TAGS=:systemd:
E: USEC_INITIALIZED=7449982
</code></pre><p>The <code>ID_NET_NAME_ONBOARD</code> takes precedence, but the <code>eno1</code> name is already in use at this point since udev has chosen names for the onboard 1Gb network interfaces already. Instead of falling back to <code>ID_NET_NAME_PATH</code>, it falls back to plain old <code>eth0</code>. This is confusing and less than ideal.</p><p>After a discussion in a <a href=https://github.com/systemd/systemd/issues/1390>Github issue</a>, it seems that the firmware is to blame. Don&rsquo;t worry - we still have some tricks we can do with systemd-networkd.</p><h2 id=workaround>Workaround</h2><p>Another handy systemd-networkd feature is a <a href=http://www.freedesktop.org/software/systemd/man/systemd.link.html>link</a> file. These files allow you to apply some network configurations to various interfaces. You can manage multiple interfaces with a single file with wildcards in the <code>[Match]</code> section.</p><p>In my case, I want to find any network interfaces that use the <code>ixgbe</code> driver (my 10Gb network interfaces) and apply a configuration change only to those interfaces. My goal is to get the system to name the interfaces using <code>ID_NET_NAME_PATH</code>, which would cause them to appear as <code>enp3s0f0</code> and <code>enp3s0f1</code>.</p><p>Let&rsquo;s create a link file to handle our quirky hardware:</p><pre><code># /etc/systemd/network/10gb-quirks.link
[Match]
Driver=ixgbe

[Link]
NamePolicy=path
</code></pre><p>This file tells systemd to find any devices using the <code>ixgbe</code> driver and force them to use their PCI device path for the naming. After a reboot, the interfaces look like this:</p><pre><code># networkctl  |grep ether
  2 eno1             ether              degraded    configured
  4 eno2             ether              off         unmanaged
  9 enp3s0f0         ether              off         unmanaged
 10 enp3s0f1         ether              off         unmanaged
</code></pre><p>Awesome! They&rsquo;re now named based on their PCI path and that should remain true even through future upgrades. There are plenty of other tricks that you can do with <a href=http://www.freedesktop.org/software/systemd/man/systemd.link.html>link</a> files, including completely custom naming for any interface.</p><h2 id=caveats>Caveats</h2><p>As Sylvain noted in the comments below, systemd-networkd provides a default <code>99-default.link</code> file that specifies how links should be handled. If you make a link file that sorts after that file, such as <code>ixgbe-quirks.link</code>, it won&rsquo;t take effect. Be sure that your link file comes first by starting it off with a number less than 99. This is why my <code>10gb-quirks.link</code> file works in my example above.</p><p><em>Photo Credit: <a href=https://www.flickr.com/photos/7819308@N05/461574071/>realblades</a> via <a href=http://compfight.com>Compfight</a> <a href=https://creativecommons.org/licenses/by-sa/2.0/>cc</a></em></p></content><p><a href=https://major.io/tags/command-line/>#command line</a>
<a href=https://major.io/tags/fedora/>#fedora</a>
<a href=https://major.io/tags/hardware/>#hardware</a>
<a href=https://major.io/tags/networking/>#networking</a>
<a href=https://major.io/tags/supermicro/>#supermicro</a>
<a href=https://major.io/tags/systemd/>#systemd</a>
<a href=https://major.io/tags/systemd-networkd/>#systemd-networkd</a>
<a href=https://major.io/tags/udev/>#udev</a></p></main><footer><script async src=https://media.ethicalads.io/media/client/ethicalads.min.js></script><div data-ea-publisher=major-io data-ea-type=text></div><hr>CC-BY-SA 4.0 &#187;
Made with <a href=https://gohugo.io/>Hugo</a> &#187;
Theme based on <a href=https://github.com/janraasch/hugo-bearblog/>Hugo Ê•â€¢á´¥â€¢Ê” Bear</a><br></footer></body></html>