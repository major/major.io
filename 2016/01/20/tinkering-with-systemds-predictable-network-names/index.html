<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="Major Hayden"><meta name=description content="I&amp;rsquo;ve talked about predictable network names (and seemingly unpredictable ones) on the blog before, but some readers asked me how they could alter the network naming to fit a particular situation. Oddly enough, my Supermicro 5028D-T4NT has a problem with predictable names and it&amp;rsquo;s a great example to use here.
The problem There&amp;rsquo;s plenty of detail in my post about the Supermicro 5028D-T4NT, but the basic gist is that something within the firmware is causing the all of the network cards in the server to show up as onboard."><meta name=keywords content=",command line,fedora,hardware,networking,supermicro,systemd,systemd-networkd,udev"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://major.io/2016/01/20/tinkering-with-systemds-predictable-network-names/><title>Tinkering with systemdâ€™s predictable network names :: Major Hayden ðŸ¤  â€” Words of wisdom from a social nerd</title><link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css rel=stylesheet type=text/css><link rel=stylesheet href=../../../../main.89fa80e2143f71bd5c96a7c94e531dec3276a367e22f87e74a76026ab64680bf.css><link rel=apple-touch-icon sizes=180x180 href=../../../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../../../favicon-16x16.png><link rel=manifest href=../../../../site.webmanifest><link rel=mask-icon href=../../../../safari-pinned-tab.svg color=#252627><link rel="shortcut icon" href=../../../../favicon.ico><meta name=msapplication-TileColor content="#252627"><meta name=theme-color content="#252627"><meta itemprop=name content="Tinkering with systemdâ€™s predictable network names"><meta itemprop=description content="I&rsquo;ve talked about predictable network names (and seemingly unpredictable ones) on the blog before, but some readers asked me how they could alter the network naming to fit a particular situation. Oddly enough, my Supermicro 5028D-T4NT has a problem with predictable names and it&rsquo;s a great example to use here.
The problem There&rsquo;s plenty of detail in my post about the Supermicro 5028D-T4NT, but the basic gist is that something within the firmware is causing the all of the network cards in the server to show up as onboard."><meta itemprop=datePublished content="2016-01-20T19:46:52+00:00"><meta itemprop=dateModified content="2016-01-20T19:46:52+00:00"><meta itemprop=wordCount content="549"><meta itemprop=image content="https://major.io"><meta itemprop=keywords content="command line,fedora,hardware,networking,supermicro,systemd,systemd-networkd,udev,"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://major.io"><meta name=twitter:title content="Tinkering with systemdâ€™s predictable network names"><meta name=twitter:description content="I&rsquo;ve talked about predictable network names (and seemingly unpredictable ones) on the blog before, but some readers asked me how they could alter the network naming to fit a particular situation. Oddly enough, my Supermicro 5028D-T4NT has a problem with predictable names and it&rsquo;s a great example to use here.
The problem There&rsquo;s plenty of detail in my post about the Supermicro 5028D-T4NT, but the basic gist is that something within the firmware is causing the all of the network cards in the server to show up as onboard."><meta name=twitter:site content="@mhayden"><meta property="article:section" content="Blog Posts"><meta property="article:published_time" content="2016-01-20 19:46:52 +0000 UTC"><style type=text/css>html{letter-spacing:unset}</style></head><body><div class=container><header class=header><span class=header__inner><a href=../../../../ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>$ echo major.io</span>
<span class=logo__cursor style=visibility:hidden></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=../../../../ham-radio-faq>hamradio</a></li><li><a href=../../../../icanhazip-com-faq>icanhazip</a></li><li><a href=../../../../posts/>posts</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href=https://major.io/2016/01/20/tinkering-with-systemds-predictable-network-names/>Tinkering with systemdâ€™s predictable network names</a></h2><div class=post-content><p></p><p>I&rsquo;ve talked about <a href=../../../../2015/08/21/understanding-systemds-predictable-network-device-names/>predictable network names</a> (and <a href=https://major.io/2014/08/06/unexpected-predictable-network-naming-systemd/>seemingly unpredictable ones</a>) on the blog before, but some readers asked me how they could alter the network naming to fit a particular situation. Oddly enough, my <a href=../../../../2015/09/28/first-thoughts-linux-on-the-supermicro-5028d-t4nt/>Supermicro 5028D-T4NT</a> has a problem with predictable names and it&rsquo;s a great example to use here.</p><h2 id=the-problem>The problem</h2><p>There&rsquo;s plenty of detail in my post about <a href=../../../../2015/09/28/first-thoughts-linux-on-the-supermicro-5028d-t4nt/>the Supermicro 5028D-T4NT</a>, but the basic gist is that something within the firmware is causing the all of the network cards in the server to show up as onboard. The server has two 1Gb network interfaces which show up as <code>eno1</code> and <code>eno2</code>, which makes sense. It also has two 10Gb network interfaces that systemd tries to name <code>eno1</code> and <code>eno2</code> as well. That&rsquo;s obviously not going to work, so they get renamed to <code>eth0</code> and <code>eth1</code>.</p><p>You can see what udev thinks in this output:</p><pre><code>P: /devices/pci0000:00/0000:00:02.2/0000:03:00.0/net/eth0
E: DEVPATH=/devices/pci0000:00/0000:00:02.2/0000:03:00.0/net/eth0
E: ID_BUS=pci
E: ID_MODEL_FROM_DATABASE=Ethernet Connection X552/X557-AT 10GBASE-T
E: ID_MODEL_ID=0x15ad
E: ID_NET_DRIVER=ixgbe
E: ID_NET_LINK_FILE=/usr/lib/systemd/network/99-default.link
E: ID_NET_NAME=eno1
E: ID_NET_NAME_MAC=enx0cc47a7591c8
E: ID_NET_NAME_ONBOARD=eno1
E: ID_NET_NAME_PATH=enp3s0f0
E: ID_OUI_FROM_DATABASE=Super Micro Computer, Inc.
E: ID_PATH=pci-0000:03:00.0
E: ID_PATH_TAG=pci-0000_03_00_0
E: ID_PCI_CLASS_FROM_DATABASE=Network controller
E: ID_PCI_SUBCLASS_FROM_DATABASE=Ethernet controller
E: ID_VENDOR_FROM_DATABASE=Intel Corporation
E: ID_VENDOR_ID=0x8086
E: IFINDEX=4
E: INTERFACE=eth0
E: SUBSYSTEM=net
E: SYSTEMD_ALIAS=/sys/subsystem/net/devices/eno1
E: TAGS=:systemd:
E: USEC_INITIALIZED=7449982
</code></pre><p>The <code>ID_NET_NAME_ONBOARD</code> takes precedence, but the <code>eno1</code> name is already in use at this point since udev has chosen names for the onboard 1Gb network interfaces already. Instead of falling back to <code>ID_NET_NAME_PATH</code>, it falls back to plain old <code>eth0</code>. This is confusing and less than ideal.</p><p>After a discussion in a <a href=https://github.com/systemd/systemd/issues/1390>Github issue</a>, it seems that the firmware is to blame. Don&rsquo;t worry - we still have some tricks we can do with systemd-networkd.</p><h2 id=workaround>Workaround</h2><p>Another handy systemd-networkd feature is a <a href=http://www.freedesktop.org/software/systemd/man/systemd.link.html>link</a> file. These files allow you to apply some network configurations to various interfaces. You can manage multiple interfaces with a single file with wildcards in the <code>[Match]</code> section.</p><p>In my case, I want to find any network interfaces that use the <code>ixgbe</code> driver (my 10Gb network interfaces) and apply a configuration change only to those interfaces. My goal is to get the system to name the interfaces using <code>ID_NET_NAME_PATH</code>, which would cause them to appear as <code>enp3s0f0</code> and <code>enp3s0f1</code>.</p><p>Let&rsquo;s create a link file to handle our quirky hardware:</p><pre><code># /etc/systemd/network/10gb-quirks.link
[Match]
Driver=ixgbe

[Link]
NamePolicy=path
</code></pre><p>This file tells systemd to find any devices using the <code>ixgbe</code> driver and force them to use their PCI device path for the naming. After a reboot, the interfaces look like this:</p><pre><code># networkctl  |grep ether
  2 eno1             ether              degraded    configured
  4 eno2             ether              off         unmanaged
  9 enp3s0f0         ether              off         unmanaged
 10 enp3s0f1         ether              off         unmanaged
</code></pre><p>Awesome! They&rsquo;re now named based on their PCI path and that should remain true even through future upgrades. There are plenty of other tricks that you can do with <a href=http://www.freedesktop.org/software/systemd/man/systemd.link.html>link</a> files, including completely custom naming for any interface.</p><h2 id=caveats>Caveats</h2><p>As Sylvain noted in the comments below, systemd-networkd provides a default <code>99-default.link</code> file that specifies how links should be handled. If you make a link file that sorts after that file, such as <code>ixgbe-quirks.link</code>, it won&rsquo;t take effect. Be sure that your link file comes first by starting it off with a number less than 99. This is why my <code>10gb-quirks.link</code> file works in my example above.</p><p><em>Photo Credit: <a href=https://www.flickr.com/photos/7819308@N05/461574071/>realblades</a> via <a href=http://compfight.com>Compfight</a> <a href=https://creativecommons.org/licenses/by-sa/2.0/>cc</a></em></p></div></article><hr><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://major.io/tags/command-line/>command line</a></span>
<span class=tag><a href=https://major.io/tags/fedora/>fedora</a></span>
<span class=tag><a href=https://major.io/tags/hardware/>hardware</a></span>
<span class=tag><a href=https://major.io/tags/networking/>networking</a></span>
<span class=tag><a href=https://major.io/tags/supermicro/>supermicro</a></span>
<span class=tag><a href=https://major.io/tags/systemd/>systemd</a></span>
<span class=tag><a href=https://major.io/tags/systemd-networkd/>systemd-networkd</a></span>
<span class=tag><a href=https://major.io/tags/udev/>udev</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-folder meta-icon"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg><span class=tag><a href=https://major.io/categories/blog-posts/>Blog Posts</a></span></p></div></main></div><footer class=footer><div class=footer__inner><div class=footer__content><span>&copy; 2021</span>
<span><a href=https://major.io>Major Hayden</a></span>
<span><a href=https://creativecommons.org/licenses/by-sa/2.0/ target=_blank rel=noopener>CC BY-SA 2.0</a></span><span><a href=https://major.io/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></span></div></div><div class=footer__inner><div class=footer__content><span>Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>Made with &#10084; by <a href=https://github.com/rhazdon>Djordje Atlialp</a></span></div></div></footer></div><script type=text/javascript src=../../../../bundle.min.e9f93b80e78a22e6f04cbb5f73e0f9c4ba60ff73a2a0ef85965c688f93dd1f2722a282e30e485603e4c65b1b346720e35f213435ec5556e196a97a68d097c80f.js integrity="sha512-6fk7gOeKIubwTLtfc+D5xLpg/3OioO+Fllxoj5PdHyciooLjDkhWA+TGWxs0ZyDjXyE0NexVVuGWqXpo0JfIDw=="></script></body></html>