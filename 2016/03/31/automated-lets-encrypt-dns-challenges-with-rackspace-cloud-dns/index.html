<!doctype html><html lang=en-us><head><meta http-equiv=x-clacks-overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://major.io/favicon.ico><title>Automated Letâ€™s Encrypt DNS challenges with Rackspace Cloud DNS | Major Hayden's Blog ðŸ¤ </title><meta name=title content="Automated Letâ€™s Encrypt DNS challenges with Rackspace Cloud DNS"><meta name=description content="Let&rsquo;s Encrypt has taken the world by storm by providing free SSL certificates that can be renewed via automated methods. They have issued over 1.4 million certificates since launch in the fall of 2015.
If you are not familiar with how Let&rsquo;s Encrypt operates, here is an extremely simple explanation:
 Create a private key Make a request for a new certificate Complete the challenge process You have a certificate!  That is highly simplified, but there is plenty of detail available on how the whole system works."><meta name=keywords content="ansible,bash,development,dns,networking,python,security,ssl,web,"><meta property="og:title" content="Automated Letâ€™s Encrypt DNS challenges with Rackspace Cloud DNS"><meta property="og:description" content="Let&rsquo;s Encrypt has taken the world by storm by providing free SSL certificates that can be renewed via automated methods. They have issued over 1.4 million certificates since launch in the fall of 2015.
If you are not familiar with how Let&rsquo;s Encrypt operates, here is an extremely simple explanation:
 Create a private key Make a request for a new certificate Complete the challenge process You have a certificate!  That is highly simplified, but there is plenty of detail available on how the whole system works."><meta property="og:type" content="article"><meta property="og:url" content="https://major.io/2016/03/31/automated-lets-encrypt-dns-challenges-with-rackspace-cloud-dns/"><meta property="og:image" content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2016-03-31T19:39:50+00:00"><meta property="article:modified_time" content="2016-03-31T19:39:50+00:00"><meta property="og:site_name" content="Major Hayden's Blog ðŸ¤ "><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta name=twitter:title content="Automated Letâ€™s Encrypt DNS challenges with Rackspace Cloud DNS"><meta name=twitter:description content="Let&rsquo;s Encrypt has taken the world by storm by providing free SSL certificates that can be renewed via automated methods. They have issued over 1.4 million certificates since launch in the fall of 2015.
If you are not familiar with how Let&rsquo;s Encrypt operates, here is an extremely simple explanation:
 Create a private key Make a request for a new certificate Complete the challenge process You have a certificate!  That is highly simplified, but there is plenty of detail available on how the whole system works."><meta name=twitter:site content="@mhayden"><meta itemprop=name content="Automated Letâ€™s Encrypt DNS challenges with Rackspace Cloud DNS"><meta itemprop=description content="Let&rsquo;s Encrypt has taken the world by storm by providing free SSL certificates that can be renewed via automated methods. They have issued over 1.4 million certificates since launch in the fall of 2015.
If you are not familiar with how Let&rsquo;s Encrypt operates, here is an extremely simple explanation:
 Create a private key Make a request for a new certificate Complete the challenge process You have a certificate!  That is highly simplified, but there is plenty of detail available on how the whole system works."><meta itemprop=datePublished content="2016-03-31T19:39:50+00:00"><meta itemprop=dateModified content="2016-03-31T19:39:50+00:00"><meta itemprop=wordCount content="693"><meta itemprop=image content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta itemprop=keywords content="ansible,bash,development,dns,networking,python,security,ssl,web,"><meta name=referrer content="no-referrer-when-downgrade"><style>body{font-family:Verdana,sans-serif;margin:auto;padding:20px;max-width:820px;text-align:left;background-color:#fff;word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:#444}h1,h2,h3,h4,h5,h6,strong,b{color:#222}a{color:#3273dc}.title{text-decoration:none;border:0}.title span{font-weight:400}nav a{margin-right:10px}textarea{width:100%;font-size:16px}input{font-size:16px}content{line-height:1.6}table{width:100%}img{max-width:100%}code{padding:2px 5px;background-color:#f2f2f2}pre code{color:#222;display:block;padding:20px;white-space:pre-wrap;font-size:14px}div.highlight code{background-color:unset;color:initial}blockquote{border-left:1px solid #999;color:#222;padding-left:20px;font-style:italic}footer{padding:25px;text-align:center}.helptext{color:#777;font-size:small}.errorlist{color:#eba613;font-size:small}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:#8b6fcb}@media(prefers-color-scheme:dark){body{background-color:#333;color:#ddd}h1,h2,h3,h4,h5,h6,strong,b{color:#eee}a{color:#8cc2dd}code{background-color:#777}pre code{color:#ddd}blockquote{color:#ccc}textarea,input{background-color:#252525;color:#ddd}.helptext{color:#aaa}}</style></head><body><header><a href=../../../../ class=title><h2>Major Hayden's Blog ðŸ¤ </h2></a><nav><a href=../../../../>Home</a>
<a href=../../../../ham-radio-faq>Ham Radio</a>
<a href=../../../../icanhazip-com-faq>icanhazip FAQ</a>
<a href=../../../../posts>Posts</a></nav></header><main><h1>Automated Letâ€™s Encrypt DNS challenges with Rackspace Cloud DNS</h1><i><time datetime=2016-03-31 pubdate>2016-03-31</time></i>
<content><p><img src=../../../../wp-content/uploads/2016/03/25476786513_393afd0d2f_b-e1459452983901.jpg alt=gears_photo></p><p><a href=https://letsencrypt.org/>Let&rsquo;s Encrypt</a> has taken the world by storm by providing free SSL certificates that can be renewed via automated methods. They have issued <a href=https://letsencrypt.org/stats/>over 1.4 million certificates</a> since launch in the fall of 2015.</p><p>If you are not familiar with how Let&rsquo;s Encrypt operates, here is an <em>extremely</em> simple explanation:</p><ol><li>Create a private key</li><li>Make a request for a new certificate</li><li>Complete the challenge process</li><li>You have a certificate!</li></ol><p>That is highly simplified, but there is <a href=https://letsencrypt.org/how-it-works/>plenty of detail available</a> on how the whole system works.</p><p>One of the most popular challenge methods is HTTP. That involves getting a challenge string from Let&rsquo;s Encrypt, placing the string at a known URL on your domain, and then waiting for verification of the challenge. The process is quick and Let&rsquo;s Encrypt <a href=https://letsencrypt.org/getting-started/>provides tools</a> that automate much of the process for you.</p><h2 id=a-challenger-appears>A challenger appears</h2><p>A DNS challenge is available in addition to the HTTP challenge. As you might imagine, this involves creating a DNS record with a string provided by Let&rsquo;s Encrypt. Once the DNS record is in place, it is verified and certificates are issued. The process goes something like this:</p><ol><li>Request a new certificate</li><li>Get a challenge string</li><li>Add a DNS TXT record on your domain with the challenge string as the data</li><li>Wait for DNS records to appear on your DNS server</li><li>Let&rsquo;s Encrypt checks for the DNS record</li><li>Clean up the DNS record</li><li>Get a certificate</li></ol><p>Wrapping automation around this method is often easier than using the HTTP method since it does not require any changes on web servers. If someone has 500 web servers but they change their DNS records through a single API with a DNS provider, it quickly becomes apparent that adding a single DNS record is much easier.</p><p>In addition, the HTTP challenge method creates problems for websites which are not entirely publicly accessible yet. A stealth startup or a pre-release site could acquire a certificate without needing to allow any access into the webserver. This is also helpful for sites which will never be public facing, such as those on intranets.</p><h2 id=automating-the-process>Automating the process</h2><p>After some research, I stumbled upon a project in GitHub called <a href=https://github.com/lukas2511/letsencrypt.sh>letsencrypt.sh</a>. The project consists of a bash script that makes all the necessary requests to Let&rsquo;s Encrypt&rsquo;s API for requesting and obtaining SSL certificates. However, DNS records are tricky since they are usually managed via an API or other non-trivial methods.</p><p>The project provides a hook feature which allows anyone to write a script that receives data and does the necessary DNS adjustments to complete the challenge process. I wrote a hook that interfaces with <a href=https://www.rackspace.com/en-us/cloud/dns>Rackspace&rsquo;s Cloud DNS API</a> and handles the creation of DNS records:</p><ul><li><a href=https://github.com/major/letsencrypt-rackspace-hook>GitHub: letsencrypt-rackspace-hook</a></li></ul><p>All of the installation and configuration instructions are in the <a href=https://github.com/major/letsencrypt-rackspace-hook/blob/master/README.rst>main README file</a> within the repository. You can begin issuing certificates with DNS challenges in a few minutes.</p><p>The hook works like this:</p><ol><li>letsencrypt.sh hands off the domain name and a challenge string to the hook</li><li>The hook adds a DNS record to Rackspace&rsquo;s DNS servers via the API</li><li>The hook keeps checking to see if the DNS record is publicly accessible</li><li>Once the DNS record appears, control is handed back to letsencrypt.sh</li><li>letsencrypt.sh tells Let&rsquo;s Encrypt to verify the challenge</li><li>Let&rsquo;s Encrypt verifies the challenge</li><li>The hook cleans up the DNS record and displays the paths to the new certificates and keys.</li></ol><p>From there, you can configure your configuration management software to push out the new certificate and keys to your production servers. Let&rsquo;s Encrypt certificates are currently limited to a 90-day duration, so be sure to configure this automation via a cron job. At the very least, set a calendar reminder for yourself a week or two in advance of the expiration.</p><p>Keep in mind that Let&rsquo;s Encrypt and Rackspace&rsquo;s DNS service are completely free. Free is a good thing.</p><p>Let me know what you think of the script! Feel free to make pull requests or issues if you find bugs. I am still working on some automated testing for the script and I hope to have that available in the next week or two.</p><p><em>Photo Credit: <a href=https://www.flickr.com/photos/137399762@N06/25476786513/>Aphernai</a> via <a href=http://compfight.com>Compfight</a> <a href=https://creativecommons.org/licenses/by-nc-sa/2.0/>cc</a></em></p></content><p><a href=https://major.io/tags/ansible/>#ansible</a>
<a href=https://major.io/tags/bash/>#bash</a>
<a href=https://major.io/tags/development/>#development</a>
<a href=https://major.io/tags/dns/>#dns</a>
<a href=https://major.io/tags/networking/>#networking</a>
<a href=https://major.io/tags/python/>#python</a>
<a href=https://major.io/tags/security/>#security</a>
<a href=https://major.io/tags/ssl/>#ssl</a>
<a href=https://major.io/tags/web/>#web</a></p></main><footer><hr>CC-BY-SA 4.0 &#187;
Made with <a href=https://gohugo.io/>Hugo</a> &#187;
Theme based on <a href=https://github.com/janraasch/hugo-bearblog/>Hugo Ê•â€¢á´¥â€¢Ê” Bear</a><br></footer></body></html>