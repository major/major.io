<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="Major Hayden"><meta name=description content="Let&amp;rsquo;s Encrypt has taken the world by storm by providing free SSL certificates that can be renewed via automated methods. They have issued over 1.4 million certificates since launch in the fall of 2015.
If you are not familiar with how Let&amp;rsquo;s Encrypt operates, here is an extremely simple explanation:
 Create a private key Make a request for a new certificate Complete the challenge process You have a certificate!  That is highly simplified, but there is plenty of detail available on how the whole system works."><meta name=keywords content=",ansible,bash,development,dns,networking,python,security,ssl,web"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://major.io/2016/03/31/automated-lets-encrypt-dns-challenges-with-rackspace-cloud-dns/><title>Automated Letâ€™s Encrypt DNS challenges with Rackspace Cloud DNS :: Major Hayden ðŸ¤  â€” Words of wisdom from a social nerd</title><link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css rel=stylesheet type=text/css><link rel=stylesheet href=../../../../main.89fa80e2143f71bd5c96a7c94e531dec3276a367e22f87e74a76026ab64680bf.css><link rel=apple-touch-icon sizes=180x180 href=../../../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../../../favicon-16x16.png><link rel=manifest href=../../../../site.webmanifest><link rel=mask-icon href=../../../../safari-pinned-tab.svg color=#252627><link rel="shortcut icon" href=../../../../favicon.ico><meta name=msapplication-TileColor content="#252627"><meta name=theme-color content="#252627"><meta itemprop=name content="Automated Letâ€™s Encrypt DNS challenges with Rackspace Cloud DNS"><meta itemprop=description content="Let&rsquo;s Encrypt has taken the world by storm by providing free SSL certificates that can be renewed via automated methods. They have issued over 1.4 million certificates since launch in the fall of 2015.
If you are not familiar with how Let&rsquo;s Encrypt operates, here is an extremely simple explanation:
 Create a private key Make a request for a new certificate Complete the challenge process You have a certificate!  That is highly simplified, but there is plenty of detail available on how the whole system works."><meta itemprop=datePublished content="2016-03-31T19:39:50+00:00"><meta itemprop=dateModified content="2016-03-31T19:39:50+00:00"><meta itemprop=wordCount content="693"><meta itemprop=image content="https://major.io"><meta itemprop=keywords content="ansible,bash,development,dns,networking,python,security,ssl,web,"><meta property="article:section" content="Blog Posts"><meta property="article:published_time" content="2016-03-31 19:39:50 +0000 UTC"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Automated Letâ€™s Encrypt DNS challenges with Rackspace Cloud DNS :: Major Hayden ðŸ¤ "><meta name=twitter:description content><meta name=twitter:site content="https://major.io"><meta name=twitter:creator content="Major Hayden"><meta name=twitter:image content><style type=text/css>html{letter-spacing:unset}</style></head><body><div class=container><header class=header><span class=header__inner><a href=../../../../ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>$ echo major.io</span>
<span class=logo__cursor style=visibility:hidden></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=../../../../ham-radio-faq>hamradio</a></li><li><a href=../../../../icanhazip-com-faq>icanhazip</a></li><li><a href=../../../../posts/>posts</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href=https://major.io/2016/03/31/automated-lets-encrypt-dns-challenges-with-rackspace-cloud-dns/>Automated Letâ€™s Encrypt DNS challenges with Rackspace Cloud DNS</a></h2><div class=post-content><p><img src=../../../../wp-content/uploads/2016/03/25476786513_393afd0d2f_b-e1459452983901.jpg alt=gears_photo></p><p><a href=https://letsencrypt.org/>Let&rsquo;s Encrypt</a> has taken the world by storm by providing free SSL certificates that can be renewed via automated methods. They have issued <a href=https://letsencrypt.org/stats/>over 1.4 million certificates</a> since launch in the fall of 2015.</p><p>If you are not familiar with how Let&rsquo;s Encrypt operates, here is an <em>extremely</em> simple explanation:</p><ol><li>Create a private key</li><li>Make a request for a new certificate</li><li>Complete the challenge process</li><li>You have a certificate!</li></ol><p>That is highly simplified, but there is <a href=https://letsencrypt.org/how-it-works/>plenty of detail available</a> on how the whole system works.</p><p>One of the most popular challenge methods is HTTP. That involves getting a challenge string from Let&rsquo;s Encrypt, placing the string at a known URL on your domain, and then waiting for verification of the challenge. The process is quick and Let&rsquo;s Encrypt <a href=https://letsencrypt.org/getting-started/>provides tools</a> that automate much of the process for you.</p><h2 id=a-challenger-appears>A challenger appears</h2><p>A DNS challenge is available in addition to the HTTP challenge. As you might imagine, this involves creating a DNS record with a string provided by Let&rsquo;s Encrypt. Once the DNS record is in place, it is verified and certificates are issued. The process goes something like this:</p><ol><li>Request a new certificate</li><li>Get a challenge string</li><li>Add a DNS TXT record on your domain with the challenge string as the data</li><li>Wait for DNS records to appear on your DNS server</li><li>Let&rsquo;s Encrypt checks for the DNS record</li><li>Clean up the DNS record</li><li>Get a certificate</li></ol><p>Wrapping automation around this method is often easier than using the HTTP method since it does not require any changes on web servers. If someone has 500 web servers but they change their DNS records through a single API with a DNS provider, it quickly becomes apparent that adding a single DNS record is much easier.</p><p>In addition, the HTTP challenge method creates problems for websites which are not entirely publicly accessible yet. A stealth startup or a pre-release site could acquire a certificate without needing to allow any access into the webserver. This is also helpful for sites which will never be public facing, such as those on intranets.</p><h2 id=automating-the-process>Automating the process</h2><p>After some research, I stumbled upon a project in GitHub called <a href=https://github.com/lukas2511/letsencrypt.sh>letsencrypt.sh</a>. The project consists of a bash script that makes all the necessary requests to Let&rsquo;s Encrypt&rsquo;s API for requesting and obtaining SSL certificates. However, DNS records are tricky since they are usually managed via an API or other non-trivial methods.</p><p>The project provides a hook feature which allows anyone to write a script that receives data and does the necessary DNS adjustments to complete the challenge process. I wrote a hook that interfaces with <a href=https://www.rackspace.com/en-us/cloud/dns>Rackspace&rsquo;s Cloud DNS API</a> and handles the creation of DNS records:</p><ul><li><a href=https://github.com/major/letsencrypt-rackspace-hook>GitHub: letsencrypt-rackspace-hook</a></li></ul><p>All of the installation and configuration instructions are in the <a href=https://github.com/major/letsencrypt-rackspace-hook/blob/master/README.rst>main README file</a> within the repository. You can begin issuing certificates with DNS challenges in a few minutes.</p><p>The hook works like this:</p><ol><li>letsencrypt.sh hands off the domain name and a challenge string to the hook</li><li>The hook adds a DNS record to Rackspace&rsquo;s DNS servers via the API</li><li>The hook keeps checking to see if the DNS record is publicly accessible</li><li>Once the DNS record appears, control is handed back to letsencrypt.sh</li><li>letsencrypt.sh tells Let&rsquo;s Encrypt to verify the challenge</li><li>Let&rsquo;s Encrypt verifies the challenge</li><li>The hook cleans up the DNS record and displays the paths to the new certificates and keys.</li></ol><p>From there, you can configure your configuration management software to push out the new certificate and keys to your production servers. Let&rsquo;s Encrypt certificates are currently limited to a 90-day duration, so be sure to configure this automation via a cron job. At the very least, set a calendar reminder for yourself a week or two in advance of the expiration.</p><p>Keep in mind that Let&rsquo;s Encrypt and Rackspace&rsquo;s DNS service are completely free. Free is a good thing.</p><p>Let me know what you think of the script! Feel free to make pull requests or issues if you find bugs. I am still working on some automated testing for the script and I hope to have that available in the next week or two.</p><p><em>Photo Credit: <a href=https://www.flickr.com/photos/137399762@N06/25476786513/>Aphernai</a> via <a href=http://compfight.com>Compfight</a> <a href=https://creativecommons.org/licenses/by-nc-sa/2.0/>cc</a></em></p></div></article><hr><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://major.io/tags/ansible/>ansible</a></span>
<span class=tag><a href=https://major.io/tags/bash/>bash</a></span>
<span class=tag><a href=https://major.io/tags/development/>development</a></span>
<span class=tag><a href=https://major.io/tags/dns/>dns</a></span>
<span class=tag><a href=https://major.io/tags/networking/>networking</a></span>
<span class=tag><a href=https://major.io/tags/python/>python</a></span>
<span class=tag><a href=https://major.io/tags/security/>security</a></span>
<span class=tag><a href=https://major.io/tags/ssl/>ssl</a></span>
<span class=tag><a href=https://major.io/tags/web/>web</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-folder meta-icon"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg><span class=tag><a href=https://major.io/categories/blog-posts/>Blog Posts</a></span></p></div></main></div><footer class=footer><div class=footer__inner><div class=footer__content><span>&copy; 2021</span>
<span><a href=https://major.io>Major Hayden</a></span>
<span><a href=https://creativecommons.org/licenses/by-sa/2.0/ target=_blank rel=noopener>CC BY-SA 2.0</a></span><span><a href=https://major.io/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></span></div></div><div class=footer__inner><div class=footer__content><span>Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>Made with &#10084; by <a href=https://github.com/rhazdon>Djordje Atlialp</a></span></div></div></footer></div><script type=text/javascript src=../../../../bundle.min.e9f93b80e78a22e6f04cbb5f73e0f9c4ba60ff73a2a0ef85965c688f93dd1f2722a282e30e485603e4c65b1b346720e35f213435ec5556e196a97a68d097c80f.js integrity="sha512-6fk7gOeKIubwTLtfc+D5xLpg/3OioO+Fllxoj5PdHyciooLjDkhWA+TGWxs0ZyDjXyE0NexVVuGWqXpo0JfIDw=="></script></body></html>