<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=light data-auto-appearance=false><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><title>Build a custom CentOS Stream 9 cloud image &#183; ðŸ¤  Major Hayden</title><meta name=title content="Build a custom CentOS Stream 9 cloud image &#183; ðŸ¤  Major Hayden"><meta name=description content="A social nerd writing about everything"><link rel=canonical href=https://major.io/posts/2022/build-custom-centos-stream-cloud-image/><link type=text/css rel=stylesheet href=/css/main.bundle.min.55253fde34a251b02bdc3be052caf9044f977a6d44817f370ad781aed774a2a79759827fd0c3255abb87575848a355a0068eb43b2958172f6c237352069d6cea.css integrity="sha512-VSU/3jSiUbAr3DvgUsr5BE+Xem1EgX83CteBrtd0oqeXWYJ/0MMlWruHV1hIo1WgBo60OylYFy9sI3NSBp1s6g=="><script type=text/javascript src=/js/appearance.min.badab316c9287a5a42a843e4eb45da65bb3d194a5a0f5fa4a3e516160e67df0b8c65f4f19a8e146436e29d583699e6cb41d6bbe99e05e1dbaa877763bad9f8e2.js integrity="sha512-utqzFskoelpCqEPk60XaZbs9GUpaD1+ko+UWFg5n3wuMZfTxmo4UZDbinVg2mebLQda76Z4F4duqh3djutn44g=="></script>
<script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.b607eb5ea0f48ef635db6a1c024a35eeff4529157e49461941aac333a158a1f71cae4e530d45ac010598695f823dbe38a63142757e37c2d7b74a309d7296f681.js integrity="sha512-tgfrXqD0jvY122ocAko17v9FKRV+SUYZQarDM6FYofccrk5TDUWsAQWYaV+CPb44pjFCdX43wte3SjCdcpb2gQ==" data-copy=Copy data-copied=Copied></script>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:title" content="Build a custom CentOS Stream 9 cloud image"><meta property="og:description" content="Learn how to customize a CentOS Stream 9 cloud image with the stuff you want and nothing that you don&rsquo;t. ðŸ“¦"><meta property="og:type" content="article"><meta property="og:url" content="https://major.io/posts/2022/build-custom-centos-stream-cloud-image/"><meta property="og:image" content="https://major.io/posts/2022/build-custom-centos-stream-cloud-image/cover.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-05-06T00:00:00+00:00"><meta property="article:modified_time" content="2022-05-06T00:00:00+00:00"><meta property="og:site_name" content="ðŸ¤  Major Hayden"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://major.io/posts/2022/build-custom-centos-stream-cloud-image/cover.jpg"><meta name=twitter:title content="Build a custom CentOS Stream 9 cloud image"><meta name=twitter:description content="Learn how to customize a CentOS Stream 9 cloud image with the stuff you want and nothing that you don&rsquo;t. ðŸ“¦"><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Posts","name":"Build a custom CentOS Stream 9 cloud image","headline":"Build a custom CentOS Stream 9 cloud image","abstract":"Learn how to customize a CentOS Stream 9 cloud image with the stuff you want and nothing that you don\u0026rsquo;t. ðŸ“¦","inLanguage":"en","url":"https:\/\/major.io\/posts\/2022\/build-custom-centos-stream-cloud-image\/","author":{"@type":"Person","name":"Major Hayden"},"copyrightYear":"2022","dateCreated":"2022-05-06T00:00:00\u002b00:00","datePublished":"2022-05-06T00:00:00\u002b00:00","dateModified":"2022-05-06T00:00:00\u002b00:00","keywords":["centos","cloud","epel","imagebuilder","linux"],"mainEntityOfPage":"true","wordCount":"987"}]</script><meta name=author content="Major Hayden"><link href=mailto:major@mhtx.net rel=me><link href=https://github.com/major rel=me><link href=https://gitlab.com/majorhayden rel=me><link href=https://linkedin.com/in/majorhayden rel=me><link href=https://t.me/majorhayden rel=me><link href=https://twitter.com/majorhayden rel=me></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 bg-neutral text-neutral-900 sm:px-14 md:px-24 lg:px-32 dark:bg-neutral-800 dark:text-neutral max-w-7xl"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 dark:bg-neutral-600 focus:translate-y-0" href=#main-content><span class="font-bold ltr:pr-2 rtl:pl-2 text-primary-600 dark:text-primary-400">&darr;</span>Skip to main content</a></div><header class="py-6 font-semibold sm:py-10 text-neutral-900 dark:text-neutral print:hidden"><nav class="flex justify-between"><div><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" rel=me href=/>ðŸ¤  Major Hayden</a></div><ul class="flex flex-col list-none ltr:text-right rtl:text-left sm:flex-row"><li class="mb-1 sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/posts/ title=Posts>Blog</a></li><li class="mb-1 sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/tags/ title=Tags>Tags</a></li><li class="mb-1 sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/w5wut/ title="W5WUT: My amateur radio station">W5WUT</a></li><li class="mb-1 sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/cv/ title="Major's CV">CV</a></li><li class="ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><button id=search-button class="text-base hover:text-primary-600 dark:hover:text-primary-400" title="Search (/)">
<span class="relative inline-block align-text-bottom icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button></li></ul></nav></header><div class="relative flex flex-col grow"><main id=main-content class=grow><article><header class=max-w-prose><ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden"><li class="inline hidden"><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/>ðŸ¤  Major Hayden</a><span class="px-1 text-primary-500">/</span></li><li class=inline><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/>Posts</a><span class="px-1 text-primary-500">/</span></li><li class="inline hidden"><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/2022/build-custom-centos-stream-cloud-image/>Build a custom CentOS Stream 9 cloud image</a><span class="px-1 text-primary-500">/</span></li></ol><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Build a custom CentOS Stream 9 cloud image</h1><div class="mt-8 mb-12 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime="2022-05-06 00:00:00 +0000 UTC">6 May 2022</time><span class="px-2 text-primary-500">&#183;</span><span>987 words</span><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">5 mins</span></div><div class="my-1 text-xs text-neutral-500 dark:text-neutral-400"><a href=/tags/centos/ class="px-1 py-[1px] border rounded-md border-neutral-200 dark:border-neutral-600 hover:border-primary-300 hover:text-primary-700 dark:hover:border-primary-600 dark:hover:text-primary-400">centos</a>
<a href=/tags/cloud/ class="px-1 py-[1px] border rounded-md border-neutral-200 dark:border-neutral-600 hover:border-primary-300 hover:text-primary-700 dark:hover:border-primary-600 dark:hover:text-primary-400">cloud</a>
<a href=/tags/epel/ class="px-1 py-[1px] border rounded-md border-neutral-200 dark:border-neutral-600 hover:border-primary-300 hover:text-primary-700 dark:hover:border-primary-600 dark:hover:text-primary-400">epel</a>
<a href=/tags/imagebuilder/ class="px-1 py-[1px] border rounded-md border-neutral-200 dark:border-neutral-600 hover:border-primary-300 hover:text-primary-700 dark:hover:border-primary-600 dark:hover:text-primary-400">imagebuilder</a>
<a href=/tags/linux/ class="px-1 py-[1px] border rounded-md border-neutral-200 dark:border-neutral-600 hover:border-primary-300 hover:text-primary-700 dark:hover:border-primary-600 dark:hover:text-primary-400">linux</a></div></div></header><section class="flex flex-col max-w-full mt-0 prose lg:flex-row dark:prose-invert"><div class="order-first px-0 lg:max-w-xs ltr:lg:pl-8 rtl:lg:pr-8 lg:order-last"><div class="ltr:pl-5 rtl:pr-5 toc lg:sticky lg:top-10 print:hidden"><details open class="mt-0 overflow-hidden rounded-lg rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5"><summary class="block py-1 text-lg font-semibold cursor-pointer rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 text-neutral-800 dark:text-neutral-100 lg:hidden bg-neutral-100 dark:bg-neutral-700">Table of Contents</summary><div class="py-2 border-dotted ltr:border-l rtl:border-r rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 border-neutral-300 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#why-do-i-need-a-custom-image-anyway>Why do I need a custom image anyway?</a></li><li><a href=#first-steps>First steps</a></li><li><a href=#adding-epel>Adding EPEL</a></li><li><a href=#define-our-image>Define our image</a></li><li><a href=#make-the-image>Make the image</a></li></ul></nav></div></details></div></div><div class="min-w-0 min-h-0 max-w-prose"><figure><img class="my-0 rounded-md" srcset="/posts/2022/build-custom-centos-stream-cloud-image/cover_hua85ed7c9f8272ccaeab4604667a76835_85518_330x0_resize_q75_box.jpg 330w,
/posts/2022/build-custom-centos-stream-cloud-image/cover_hua85ed7c9f8272ccaeab4604667a76835_85518_660x0_resize_q75_box.jpg 660w,
/posts/2022/build-custom-centos-stream-cloud-image/cover_hua85ed7c9f8272ccaeab4604667a76835_85518_1024x0_resize_q75_box.jpg 1024w,
/posts/2022/build-custom-centos-stream-cloud-image/cover_hua85ed7c9f8272ccaeab4604667a76835_85518_1320x0_resize_q75_box.jpg 2x" src=/posts/2022/build-custom-centos-stream-cloud-image/cover_hua85ed7c9f8272ccaeab4604667a76835_85518_660x0_resize_q75_box.jpg alt="Hiker with a backpack in a deep forest with some snow"><figcaption>Photo credit: <a href=https://unsplash.com/photos/RT9c80cycn8>Alina Fedorchenko</a></figcaption></figure><p>This is my <a href=/tags/imagebuilder/>third post</a> about <a href=https://www.osbuild.org/documentation/>Image Builder</a>, so I guess you could say that I enjoy
using it<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>. It&rsquo;s a great way to define a custom cloud image, build it, and
(optionally) ship it to a supported cloud provider.</p><p>This post covers how to build a customized CentOS Stream 9 image along with a custom
repository for additional packages. In this case, that&rsquo;s <a href=https://docs.fedoraproject.org/en-US/epel/>Extra Packages for Enterprise
Linux (EPEL)</a>.</p><h1 id=why-do-i-need-a-custom-image-anyway class="relative group">Why do I need a custom image anyway? <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#why-do-i-need-a-custom-image-anyway aria-label=Anchor>#</a></span></h1><p>Building your own image empowers you to choose which packages you want, which services
run at boot time, and where you deploy your image. Some cloud providers may not have an
image from the Linux distribution you enjoy most, or they might have an image with the
wrong package set.</p><p>Some cloud providers build images with too many packages or too few. Sometimes they add
configuration that doesn&rsquo;t exist in the OS itself. I&rsquo;ve even found some that alter
cloud-init and force you to log in directly as the <code>root</code> user. ðŸ˜±</p><p>I enjoy building my own images so I know exactly what it contains and I know that the
configuration came from the OS itself.</p><h1 id=first-steps class="relative group">First steps <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#first-steps aria-label=Anchor>#</a></span></h1><p>This post uses CentOS Stream 9 as an example. You will need a physical host, virtual
machine, or cloud instance running CentOS Stream 9 first. We start by installing some
packages:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> sudo dnf install osbuild-composer weldr-client
</span></span></code></pre></div><p>What do these packages contain?</p><ul><li><em>osbuild-composer</em> ensures you have <em>osbuild</em>, the low-level image build component,
along with configuration and an osbuild-composer<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> worker that builds the
image.</li><li><em>weldr-client</em> contains the <code>composer-cli</code> command line tool that makes it easy to
interact with <em>osbuild-composer</em></li></ul><p>One nice thing about this stack is that it starts via systemd&rsquo;s <a href=https://0pointer.de/blog/projects/socket-activation.html>socket activation</a> and
it only runs when you query it. Let&rsquo;s start the socket now and ensure it comes up on a
reboot:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> sudo systemctl <span class=nb>enable</span> --now osbuild-composer.socket
</span></span></code></pre></div><p>Verify that the API is responding:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> composer-cli status show
</span></span><span class=line><span class=cl><span class=go>API server status:
</span></span></span><span class=line><span class=cl><span class=go>    Database version:   0
</span></span></span><span class=line><span class=cl><span class=go>    Database supported: true
</span></span></span><span class=line><span class=cl><span class=go>    Schema version:     0
</span></span></span><span class=line><span class=cl><span class=go>    API version:        1
</span></span></span><span class=line><span class=cl><span class=go>    Backend:            osbuild-composer
</span></span></span><span class=line><span class=cl><span class=go>    Build:              NEVRA:osbuild-composer-46-1.el9.x86_64
</span></span></span></code></pre></div><h1 id=adding-epel class="relative group">Adding EPEL <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#adding-epel aria-label=Anchor>#</a></span></h1><p>CentOS Stream 9 has most of the packages I want, but I really love this program called
<a href=https://htop.dev/><code>htop</code></a> that displays resource usage and allows you to introspect certain processes or
namespaces easily. This package is only available in the EPEL repository, so we need to
add that one to our list of enabled repositories for image builds.</p><p><em>osbuild-composer</em> comes with its own set of repositories in the package and does not
use the system&rsquo;s repositories. You can list all the enabled repositories that it
knows about:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>#</span> composer-cli sources list
</span></span><span class=line><span class=cl><span class=go>AppStream
</span></span></span><span class=line><span class=cl><span class=go>BaseOS
</span></span></span><span class=line><span class=cl><span class=go>RT
</span></span></span></code></pre></div><p>If we want to add EPEL, we can dump the configuration from one of these to a file and
edit it:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>#</span> composer-cli sources info AppStream <span class=p>|</span> tee epel.ini
</span></span><span class=line><span class=cl><span class=go>check_gpg = true
</span></span></span><span class=line><span class=cl><span class=go>check_ssl = true
</span></span></span><span class=line><span class=cl><span class=go>id = &#34;AppStream&#34;
</span></span></span><span class=line><span class=cl><span class=go>name = &#34;AppStream&#34;
</span></span></span><span class=line><span class=cl><span class=go>rhsm = false
</span></span></span><span class=line><span class=cl><span class=go>system = true
</span></span></span><span class=line><span class=cl><span class=go>type = &#34;yum-baseurl&#34;
</span></span></span><span class=line><span class=cl><span class=go>url = &#34;https://composes.stream.centos.org/production/latest-CentOS-Stream/compose/AppStream/x86_64/os/&#34;
</span></span></span></code></pre></div><p>After editing the EPEL repository file, it should look like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=na>check_gpg</span> <span class=o>=</span> <span class=s>true</span>
</span></span><span class=line><span class=cl><span class=na>check_ssl</span> <span class=o>=</span> <span class=s>true</span>
</span></span><span class=line><span class=cl><span class=na>id</span> <span class=o>=</span> <span class=s>&#34;EPEL9&#34;</span>
</span></span><span class=line><span class=cl><span class=na>name</span> <span class=o>=</span> <span class=s>&#34;EPEL9&#34;</span>
</span></span><span class=line><span class=cl><span class=na>rhsm</span> <span class=o>=</span> <span class=s>false</span>
</span></span><span class=line><span class=cl><span class=na>system</span> <span class=o>=</span> <span class=s>false</span>
</span></span><span class=line><span class=cl><span class=na>type</span> <span class=o>=</span> <span class=s>&#34;yum-baseurl&#34;</span>
</span></span><span class=line><span class=cl><span class=na>url</span> <span class=o>=</span> <span class=s>&#34;https://mirrors.kernel.org/fedora-epel/9/Everything/x86_64/&#34;</span>
</span></span></code></pre></div><p>You can use any mirror you prefer, but the kernel mirrors are very fast for me from most
locations. Now we need to add this repository:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>#</span> composer-cli sources add epel.ini
</span></span><span class=line><span class=cl><span class=gp>#</span> composer-cli sources list
</span></span><span class=line><span class=cl><span class=go>AppStream
</span></span></span><span class=line><span class=cl><span class=go>BaseOS
</span></span></span><span class=line><span class=cl><span class=go>EPEL9
</span></span></span><span class=line><span class=cl><span class=go>RT
</span></span></span></code></pre></div><p>We now have <code>EPEL9</code> in our list. ðŸŽ‰</p><h1 id=define-our-image class="relative group">Define our image <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#define-our-image aria-label=Anchor>#</a></span></h1><p>All image definitions, or blueprints, are in TOML format. Here&rsquo;s my simple one for this
post:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-toml data-lang=toml><span class=line><span class=cl><span class=c># Save this file as image.toml</span>
</span></span><span class=line><span class=cl><span class=nx>name</span> <span class=p>=</span> <span class=s2>&#34;centos9&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>description</span> <span class=p>=</span> <span class=s2>&#34;Major&#39;s awesome CentOS 9 image&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>version</span> <span class=p>=</span> <span class=s2>&#34;0.0.1&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[[</span><span class=nx>packages</span><span class=p>]]</span>
</span></span><span class=line><span class=cl><span class=nx>name</span> <span class=p>=</span> <span class=s2>&#34;tmux&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[[</span><span class=nx>packages</span><span class=p>]]</span>
</span></span><span class=line><span class=cl><span class=nx>name</span> <span class=p>=</span> <span class=s2>&#34;vim&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># This is the one that comes from EPEL.</span>
</span></span><span class=line><span class=cl><span class=p>[[</span><span class=nx>packages</span><span class=p>]]</span>
</span></span><span class=line><span class=cl><span class=nx>name</span> <span class=p>=</span> <span class=s2>&#34;htop&#34;</span>
</span></span></code></pre></div><p>Now we push our blueprint and solve the dependencies to ensure we added our EPEL
repository properly:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>#</span> composer-cli blueprints push image.toml
</span></span><span class=line><span class=cl><span class=gp>#</span> composer-cli blueprints depsolve centos9
</span></span><span class=line><span class=cl><span class=go>    -- SNIP --
</span></span></span><span class=line><span class=cl><span class=go>    2:vim-filesystem-8.2.2637-16.el9.noarch
</span></span></span><span class=line><span class=cl><span class=go>    which-2.21-27.el9.x86_64
</span></span></span><span class=line><span class=cl><span class=go>    xz-5.2.5-7.el9.x86_64
</span></span></span><span class=line><span class=cl><span class=go>    xz-libs-5.2.5-7.el9.x86_64
</span></span></span><span class=line><span class=cl><span class=go>    zlib-1.2.11-33.el9.x86_64
</span></span></span><span class=line><span class=cl><span class=go>    htop-3.1.2-3.el9.x86_64
</span></span></span></code></pre></div><p>And there&rsquo;s <code>htop</code> at the end of the list! ðŸŽ‰</p><h1 id=make-the-image class="relative group">Make the image <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#make-the-image aria-label=Anchor>#</a></span></h1><p>The fun part has arrived! Let&rsquo;s build an image:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>#</span> composer-cli compose start centos9 ami --size<span class=o>=</span><span class=m>4096</span>
</span></span><span class=line><span class=cl><span class=go>Compose ca57fd64-11ea-41d4-b924-9b8f5bdcaf5e added to the queue
</span></span></span></code></pre></div><p>This command does a few things:</p><ol><li>Starts an image build with our <code>centos9</code> blueprint (from the <code>name</code> section of my
<code>image.toml</code> file)</li><li>Outputs an image type that works well on AWS (Amazon Machine Image, or AMI)</li><li>Limits the image size to 4GB (be sure this is not too large for your preferred
instance size)</li></ol><blockquote><p>ðŸ¤” Note that you do not need to set the size explicitly here, but I do it as a good
measure. When your instance boots, <code>cloud-init</code> runs <code>growpart</code> to expand the storage
to fit the disk size in your cloud instance.</p><p>ðŸ’£ <strong>However</strong>, <code>growpart</code> will not <em>shrink</em> the disk at boot time. If you choose a
size that is larger than the disk space in your cloud instance, you will likely see an
error at provisioning time.</p></blockquote><p>Let&rsquo;s check the status after a few minutes:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>#</span> composer-cli compose status
</span></span><span class=line><span class=cl><span class=go>ca57fd64-11ea-41d4-b924-9b8f5bdcaf5e FINISHED Fri May 6 16:16:08 2022 centos9         0.0.1 ami              4096
</span></span></span></code></pre></div><p>If you want to get a copy of the image and import it yourself into your favorite cloud,
you can do that now:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>#</span> composer-cli compose image ca57fd64-11ea-41d4-b924-9b8f5bdcaf5e
</span></span><span class=line><span class=cl><span class=go>ca57fd64-11ea-41d4-b924-9b8f5bdcaf5e-image.raw
</span></span></span><span class=line><span class=cl><span class=go></span><span class=gp>#</span> ls -alh ca57fd64-11ea-41d4-b924-9b8f5bdcaf5e-image.raw
</span></span><span class=line><span class=cl><span class=go>-rw-------. 1 root root 2.7G May  6 16:20 ca57fd64-11ea-41d4-b924-9b8f5bdcaf5e-image.raw
</span></span></span></code></pre></div><p>You can also let <em>osbuild-composer</em> do this for you! I have one post on this blog about
<a href=/2020/06/19/build-aws-images-with-imagebuilder/>automatically uploading to AWS</a> and another post on the Red Hat blog about <a href=https://www.redhat.com/en/blog/build-rhel-images-azure-image-builder>doing the
same with Azure</a>.</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>I once worked on the team that makes Image Builder happen, so I may be a
little bit biased. Enjoy the post anyway. ðŸ˜‰&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>Most people at Red Hat just call it <em>composer</em>, but I&rsquo;ll use the full
name here to avoid confusion.&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div></section><footer class="pt-8 max-w-prose print:hidden"><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="flex group" href=/posts/2022/basic-auth-with-traefik-on-kubernetes/><span class="mr-3 ltr:inline rtl:hidden text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400">&larr;</span>
<span class="ml-3 ltr:hidden rtl:inline text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400">&rarr;</span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Basic authentication with Traefik on kubernetes</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2022-04-20 00:00:00 +0000 UTC">20 April 2022</time></span></span></a></span>
<span><a class="flex text-right group" href=/posts/2022/sway-reload-causes-firefox-crash/><span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Sway reload causes a Firefox crash</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2022-05-24 00:00:00 +0000 UTC">24 May 2022</time></span></span>
<span class="ml-3 ltr:inline rtl:hidden text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400">&rarr;</span>
<span class="mr-3 ltr:hidden rtl:inline text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400">&larr;</span></a></span></div></div></footer></article><div class="absolute top-[100vh] ltr:right-0 rtl:left-0 w-12 pointer-events-none bottom-0"><a href=#the-top class="w-12 h-12 sticky pointer-events-auto top-[calc(100vh-5.5rem)] bg-neutral/50 dark:bg-neutral-800/50 backdrop-blur rounded-full text-xl flex items-center justify-center text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer class="py-10 print:hidden"><div class="flex items-center justify-between"><div><p class="text-sm text-neutral-500 dark:text-neutral-400">All content licensed <a href=https://creativecommons.org/licenses/by-sa/4.0/>CC-BY-SA</a></p><p class="text-xs text-neutral-500 dark:text-neutral-400">Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://git.io/hugo-congo target=_blank rel="noopener noreferrer">Congo</a></p></div><div class="text-sm cursor-pointer text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400 ltr:mr-14 rtl:ml-14"><button id=appearance-switcher class="w-12 h-12" type=button title="Switch to dark appearance">
<span class="inline dark:hidden"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></span><span class="hidden dark:inline"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></span></button></div></div></footer><div id=search-wrapper class="fixed inset-0 z-50 flex flex-col p-4 sm:p-6 md:p-[10vh] lg:p-[12vh] w-screen h-screen cursor-default bg-neutral-500/50 backdrop-blur-sm dark:bg-neutral-900/50 invisible" data-url=https://major.io/><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg border-neutral-200 top-20 bg-neutral dark:bg-neutral-800 dark:border-neutral-700"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative inline-block align-text-bottom icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-transparent focus:outline-2" placeholder=Search tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400" title="Close (Esc)">
<span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>