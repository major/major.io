<!doctype html><html lang=en-us><head><meta http-equiv=x-clacks-overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://major.io/favicon.ico><title>Use a secret as an environment variable in OpenShift deployments | Major Hayden's Blog ðŸ¤ </title><meta name=title content="Use a secret as an environment variable in OpenShift deployments"><meta name=description content="Environment variables are easy to add to OpenShift deployments, but a more secure way to add these variables is by referencing a secret.
"><meta name=keywords content="openshift,containers,security,"><meta property="og:title" content="Use a secret as an environment variable in OpenShift deployments"><meta property="og:description" content="Environment variables are easy to add to OpenShift deployments, but a more secure way to add these variables is by referencing a secret.
"><meta property="og:type" content="article"><meta property="og:url" content="https://major.io/2018/12/06/use-secret-as-environment-variable-in-openshift-deployments/"><meta property="og:image" content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-12-06T00:00:00+00:00"><meta property="article:modified_time" content="2018-12-06T00:00:00+00:00"><meta property="og:site_name" content="Major Hayden's Blog ðŸ¤ "><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta name=twitter:title content="Use a secret as an environment variable in OpenShift deployments"><meta name=twitter:description content="Environment variables are easy to add to OpenShift deployments, but a more secure way to add these variables is by referencing a secret.
"><meta name=twitter:site content="@mhayden"><meta itemprop=name content="Use a secret as an environment variable in OpenShift deployments"><meta itemprop=description content="Environment variables are easy to add to OpenShift deployments, but a more secure way to add these variables is by referencing a secret.
"><meta itemprop=datePublished content="2018-12-06T00:00:00+00:00"><meta itemprop=dateModified content="2018-12-06T00:00:00+00:00"><meta itemprop=wordCount content="304"><meta itemprop=image content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta itemprop=keywords content="openshift,containers,security,"><meta name=referrer content="no-referrer-when-downgrade"><style>body{font-family:Verdana,sans-serif;margin:auto;padding:20px;max-width:820px;text-align:left;background-color:#fff;word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:#444}h1,h2,h3,h4,h5,h6,strong,b{color:#222}a{color:#3273dc}.title{text-decoration:none;border:0}.title span{font-weight:400}nav a{margin-right:10px}textarea{width:100%;font-size:16px}input{font-size:16px}content{line-height:1.6}table{width:100%}img{max-width:100%}code{padding:2px 5px;background-color:#f2f2f2}pre code{color:#222;display:block;padding:20px;white-space:pre-wrap;font-size:14px}div.highlight code{background-color:unset;color:initial}blockquote{border-left:1px solid #999;color:#222;padding-left:20px;font-style:italic}footer{padding:25px;text-align:center}.helptext{color:#777;font-size:small}.errorlist{color:#eba613;font-size:small}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:#8b6fcb}@media(prefers-color-scheme:dark){body{background-color:#333;color:#ddd}h1,h2,h3,h4,h5,h6,strong,b{color:#eee}a{color:#8cc2dd}code{background-color:#777}pre code{color:#ddd}blockquote{color:#ccc}textarea,input{background-color:#252525;color:#ddd}.helptext{color:#aaa}}</style></head><body><header><a href=../../../../ class=title><h2>Major Hayden's Blog ðŸ¤ </h2></a><nav><a href=../../../../>Home</a>
<a href=../../../../ham-radio-faq>Ham Radio</a>
<a href=../../../../icanhazip-com-faq>icanhazip FAQ</a>
<a href=../../../../posts>Posts</a></nav><script async src=https://media.ethicalads.io/media/client/ethicalads.min.js></script><div class="adaptive raised" data-ea-publisher=major-io data-ea-type=text></div></header><main><h1>Use a secret as an environment variable in OpenShift deployments</h1><i><time datetime=2018-12-06 pubdate>2018-12-06</time></i>
<content><p>OpenShift <a href=https://docs.openshift.com/container-platform/3.9/dev_guide/deployments/how_deployments_work.html>deployments</a> allow you to take a container image and run it within a
cluster. You can easily add extra items to the deployment, such as
environment variables or volumes.</p><p>The best practice for sensitive environment variables is to place them into a
<a href=https://docs.openshift.com/container-platform/3.9/dev_guide/secrets.html>secret object</a> rather than directly in the deployment configuration itself.
Although this keeps the secret data out of the deployment, the environment
variable is still exposed to the running application inside the container.</p><h2 id=creating-a-secret>Creating a secret</h2><p>Let&rsquo;s start with a snippet of a <code>deploymentConfig</code> that has a sensitive
environment variable in plain text:</p><div class=highlight><pre style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=color:#268bd2;font-weight:700>spec</span>:
    <span style=color:#268bd2;font-weight:700>containers</span>:
    - <span style=color:#268bd2;font-weight:700>env</span>:
        - <span style=color:#268bd2;font-weight:700>name</span>: <span style=color:#2aa198>MYAPP_SECRET_TOKEN</span>
          <span style=color:#268bd2;font-weight:700>value</span>: <span style=color:#2aa198>vPWps5E7KO8KPlljaD3eXED3f6jmLsV5mQ</span>
    <span style=color:#268bd2;font-weight:700>image</span>: <span style=color:#2aa198>&#34;fedora:29&#34;</span>
    <span style=color:#268bd2;font-weight:700>name</span>: <span style=color:#2aa198>my_app</span>
</code></pre></div><p>The first step is to create a secret object that contains our sensitive
environment variable:</p><div class=highlight><pre style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=color:#268bd2;font-weight:700>apiVersion</span>: <span style=color:#2aa198>v1</span>
<span style=color:#268bd2;font-weight:700>kind</span>: <span style=color:#2aa198>Secret</span>
<span style=color:#268bd2;font-weight:700>metadata</span>:
  <span style=color:#268bd2;font-weight:700>name</span>: <span style=color:#2aa198>secret-token-for-my-app</span>
<span style=color:#268bd2;font-weight:700>stringData</span>:
  <span style=color:#268bd2;font-weight:700>SECRET_TOKEN</span>: <span style=color:#2aa198>vPWps5E7KO8KPlljaD3eXED3f6jmLsV5mQ</span>
</code></pre></div><p>Save this file as <code>secret-token.yml</code> and deploy it to OpenShift:</p><pre><code>oc apply -f secret-token.yml
</code></pre><p>Query OpenShift to ensure the secret is ready to use:</p><pre><code>$ oc get secret/secret-token-for-my-app
NAME                            TYPE      DATA      AGE
secret-token-for-my-app         Opaque    1         1h
</code></pre><h2 id=using-the-secret>Using the secret</h2><p>We can adjust the deployment configuration to use this new secret:</p><div class=highlight><pre style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=color:#268bd2;font-weight:700>spec</span>:
    <span style=color:#268bd2;font-weight:700>containers</span>:
    - <span style=color:#268bd2;font-weight:700>env</span>:
      - <span style=color:#268bd2;font-weight:700>name</span>: <span style=color:#2aa198>MYAPP_SECRET_TOKEN</span>
        <span style=color:#268bd2;font-weight:700>valueFrom</span>:
          <span style=color:#268bd2;font-weight:700>secretKeyRef</span>:
            <span style=color:#268bd2;font-weight:700>key</span>: <span style=color:#2aa198>SECRET_TOKEN</span>
            <span style=color:#268bd2;font-weight:700>name</span>: <span style=color:#2aa198>secret-token-for-my-app</span>
    <span style=color:#268bd2;font-weight:700>image</span>: <span style=color:#2aa198>&#34;fedora:29&#34;</span>
    <span style=color:#268bd2;font-weight:700>name</span>: <span style=color:#2aa198>my_app</span>
</code></pre></div><p>This configuration tells OpenShift to look inside the secret object called
<code>secret-token-for-my-app</code> for a key matching <code>SECRET_TOKEN</code>. The value will
be passed into the <code>MYAPP_SECRET_TOKEN</code> environment variable and it will be
available to the application running in the container.</p><p><strong>Security note:</strong> If someone has access to change the deployment
configuration object, they could get access to the value of the secret
without having direct access to the secret object itself. It would be trivial
to change the startup command in the container to print all of the
environment variables in the container (using the <code>env</code> command) and view them
in the container logs.</p></content><p><a href=https://major.io/tags/openshift/>#openshift</a>
<a href=https://major.io/tags/containers/>#containers</a>
<a href=https://major.io/tags/security/>#security</a></p></main><footer><hr>CC-BY-SA 4.0 &#187;
Made with <a href=https://gohugo.io/>Hugo</a> &#187;
Theme based on <a href=https://github.com/janraasch/hugo-bearblog/>Hugo Ê•â€¢á´¥â€¢Ê” Bear</a><br></footer></body></html>