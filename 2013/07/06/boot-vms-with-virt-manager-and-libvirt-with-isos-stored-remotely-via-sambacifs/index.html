<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="Major Hayden"><meta name=description content="Pairing virt-manager with KVM makes booting new VM&amp;rsquo;s pretty darned easy. I have a QNAP NAS at home with a bunch of ISO&amp;rsquo;s stored in share available to guests and I wanted to use that with libvirt to boot new VM&amp;rsquo;s. (By the way, if you&amp;rsquo;re looking for an off-the-shelf NAS that is built with solid hardware and pretty reliable software, try one of the QNAP devices. You still get access to many of the usual commands that you would normally find on a Linux box for emergencies."><meta name=keywords content=",command line,fedora,linux,redhat,samba,virtualization"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://major.io/2013/07/06/boot-vms-with-virt-manager-and-libvirt-with-isos-stored-remotely-via-sambacifs/><title>Boot VM‚Äôs with virt-manager and libvirt with ISO‚Äôs stored remotely via samba/cifs :: Major Hayden ü§† ‚Äî Words of wisdom from a social nerd</title><link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css rel=stylesheet type=text/css><link rel=stylesheet href=../../../../main.89fa80e2143f71bd5c96a7c94e531dec3276a367e22f87e74a76026ab64680bf.css><link rel=apple-touch-icon sizes=180x180 href=../../../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../../../favicon-16x16.png><link rel=manifest href=../../../../site.webmanifest><link rel=mask-icon href=../../../../safari-pinned-tab.svg color=#252627><link rel="shortcut icon" href=../../../../favicon.ico><meta name=msapplication-TileColor content="#252627"><meta name=theme-color content="#252627"><meta itemprop=name content="Boot VM‚Äôs with virt-manager and libvirt with ISO‚Äôs stored remotely via samba/cifs"><meta itemprop=description content="Pairing virt-manager with KVM makes booting new VM&rsquo;s pretty darned easy. I have a QNAP NAS at home with a bunch of ISO&rsquo;s stored in share available to guests and I wanted to use that with libvirt to boot new VM&rsquo;s. (By the way, if you&rsquo;re looking for an off-the-shelf NAS that is built with solid hardware and pretty reliable software, try one of the QNAP devices. You still get access to many of the usual commands that you would normally find on a Linux box for emergencies."><meta itemprop=datePublished content="2013-07-07T01:51:10+00:00"><meta itemprop=dateModified content="2013-07-07T01:51:10+00:00"><meta itemprop=wordCount content="357"><meta itemprop=image content="https://major.io"><meta itemprop=keywords content="command line,fedora,linux,redhat,samba,virtualization,"><meta property="article:section" content="Blog Posts"><meta property="article:published_time" content="2013-07-07 01:51:10 +0000 UTC"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Boot VM‚Äôs with virt-manager and libvirt with ISO‚Äôs stored remotely via samba/cifs :: Major Hayden ü§†"><meta name=twitter:description content><meta name=twitter:site content="https://major.io"><meta name=twitter:creator content="Major Hayden"><meta name=twitter:image content><style type=text/css>html{letter-spacing:unset}</style></head><body class=dark-theme><div class=container><header class=header><span class=header__inner><a href=../../../../ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>$ echo major.io</span>
<span class=logo__cursor style=visibility:hidden></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=../../../../ham-radio-faq>hamradio</a></li><li><a href=../../../../icanhazip-com-faq>icanhazip</a></li><li><a href=../../../../posts/>posts</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href=https://major.io/2013/07/06/boot-vms-with-virt-manager-and-libvirt-with-isos-stored-remotely-via-sambacifs/>Boot VM‚Äôs with virt-manager and libvirt with ISO‚Äôs stored remotely via samba/cifs</a></h2><div class=post-content><p><img src=http://major.io/wp-content/uploads/2013/07/qnap.jpg alt=1></p><p>Pairing <a href=http://virt-manager.org/>virt-manager</a> with KVM makes booting new VM&rsquo;s pretty darned easy. I have a <a href="http://www.qnap.com/en/?lang=en&sn=822&c=1655&sc=1656&t=1660&n=6703">QNAP NAS</a> at home with a bunch of ISO&rsquo;s stored in share available to guests and I wanted to use that with libvirt to boot new VM&rsquo;s. (By the way, if you&rsquo;re looking for an off-the-shelf NAS that is built with solid hardware and pretty reliable software, try one of the QNAP devices. You still get access to many of the usual commands that you would normally find on a Linux box for emergencies. More on that in a later post.)</p><p>The first step was creating a mountpoint and configuring the mount in /etc/fstab:</p><pre><code># mkdir /mnt/iso
# grep qemu /etc/passwd
qemu‚ùå107:107:qemu user:/:/sbin/nologin
# echo &quot;//qnap/ISO /mnt/iso cifs    _netdev,guest,uid=107,gid=107,defaults 0 0&quot; &gt;&gt; /etc/fstab
# mount /mnt/iso
</code></pre><p>My QNAP is already in /etc/hosts so I didn&rsquo;t need to specify the IP in the file. Adding <code>_netdev</code> ensures that the network will be up before the mount is made. The <code>guest</code> option ensures that I won&rsquo;t be prompted for credentials and the <code>uid=107,gid=107</code> mounts the share as the qemu user. If you forget this, virt-manager will throw some ugly permissions errors from libvirt.</p><p>From there, I had another permissions error and I suspected that SELinux was preventing libvirt from accessing the files in the share. A quick check of /var/log/messages revealed that I was right:</p><pre><code>Jul  6 16:12:51 nuc1 setroubleshoot: SELinux is preventing /usr/bin/qemu-system-x86_64 from open access on the file /mnt/iso/livecd.iso. For complete SELinux messages. run sealert -l c1c80b2c-b5df-4114-86c7-ffee98274552
</code></pre><p>Here&rsquo;s the output from sealert:</p><pre><code># sealert -l c1c80b2c-b5df-4114-86c7-ffee98274552
SELinux is preventing /usr/bin/qemu-system-x86_64 from open access on the file /mnt/iso/livecd.iso.

*****  Plugin catchall_boolean (89.3 confidence) suggests  *******************

If you want to allow virt to use samba
Then you must tell SELinux about this by enabling the 'virt_use_samba' boolean.
You can read 'None' man page for more details.
Do
setsebool -P virt_use_samba 1
</code></pre><p>The fix is a quick one:</p><pre><code># setsebool -P virt_use_samba 1
</code></pre><p>You should be all set after that. Press ‚ÄúBrowse Local‚Äù in virt-manager when you look for your ISO to boot the virtual machine and navigate over to /mnt/iso for your list of ISO&rsquo;s.</p></div></article><hr><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://major.io/tags/command-line/>command line</a></span>
<span class=tag><a href=https://major.io/tags/fedora/>fedora</a></span>
<span class=tag><a href=https://major.io/tags/linux/>linux</a></span>
<span class=tag><a href=https://major.io/tags/redhat/>redhat</a></span>
<span class=tag><a href=https://major.io/tags/samba/>samba</a></span>
<span class=tag><a href=https://major.io/tags/virtualization/>virtualization</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-folder meta-icon"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg><span class=tag><a href=https://major.io/categories/blog-posts/>Blog Posts</a></span></p></div></main></div><footer class=footer><div class=footer__inner><div class=footer__content><span>&copy; 2021</span>
<span><a href=https://major.io>Major Hayden</a></span>
<span><a href=https://creativecommons.org/licenses/by-sa/2.0/ target=_blank rel=noopener>CC BY-SA 2.0</a></span><span><a href=https://major.io/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></span></div></div><div class=footer__inner><div class=footer__content><span>Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>Made with &#10084; by <a href=https://github.com/rhazdon>Djordje Atlialp</a></span></div></div></footer></div><script type=text/javascript src=../../../../bundle.min.e9f93b80e78a22e6f04cbb5f73e0f9c4ba60ff73a2a0ef85965c688f93dd1f2722a282e30e485603e4c65b1b346720e35f213435ec5556e196a97a68d097c80f.js integrity="sha512-6fk7gOeKIubwTLtfc+D5xLpg/3OioO+Fllxoj5PdHyciooLjDkhWA+TGWxs0ZyDjXyE0NexVVuGWqXpo0JfIDw=="></script></body></html>