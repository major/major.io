<!doctype html><html lang=en-us><head><meta http-equiv=x-clacks-overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://major.io/favicon.ico><title>Boot VM‚Äôs with virt-manager and libvirt with ISO‚Äôs stored remotely via samba/cifs | Major Hayden's Blog ü§†</title><meta name=title content="Boot VM‚Äôs with virt-manager and libvirt with ISO‚Äôs stored remotely via samba/cifs"><meta name=description content="Pairing virt-manager with KVM makes booting new VM&rsquo;s pretty darned easy. I have a QNAP NAS at home with a bunch of ISO&rsquo;s stored in share available to guests and I wanted to use that with libvirt to boot new VM&rsquo;s. (By the way, if you&rsquo;re looking for an off-the-shelf NAS that is built with solid hardware and pretty reliable software, try one of the QNAP devices. You still get access to many of the usual commands that you would normally find on a Linux box for emergencies."><meta name=keywords content="command line,fedora,linux,redhat,samba,virtualization,"><meta property="og:title" content="Boot VM‚Äôs with virt-manager and libvirt with ISO‚Äôs stored remotely via samba/cifs"><meta property="og:description" content="Pairing virt-manager with KVM makes booting new VM&rsquo;s pretty darned easy. I have a QNAP NAS at home with a bunch of ISO&rsquo;s stored in share available to guests and I wanted to use that with libvirt to boot new VM&rsquo;s. (By the way, if you&rsquo;re looking for an off-the-shelf NAS that is built with solid hardware and pretty reliable software, try one of the QNAP devices. You still get access to many of the usual commands that you would normally find on a Linux box for emergencies."><meta property="og:type" content="article"><meta property="og:url" content="https://major.io/2013/07/06/boot-vms-with-virt-manager-and-libvirt-with-isos-stored-remotely-via-sambacifs/"><meta property="og:image" content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2013-07-07T01:51:10+00:00"><meta property="article:modified_time" content="2013-07-07T01:51:10+00:00"><meta property="og:site_name" content="Major Hayden's Blog ü§†"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta name=twitter:title content="Boot VM‚Äôs with virt-manager and libvirt with ISO‚Äôs stored remotely via samba/cifs"><meta name=twitter:description content="Pairing virt-manager with KVM makes booting new VM&rsquo;s pretty darned easy. I have a QNAP NAS at home with a bunch of ISO&rsquo;s stored in share available to guests and I wanted to use that with libvirt to boot new VM&rsquo;s. (By the way, if you&rsquo;re looking for an off-the-shelf NAS that is built with solid hardware and pretty reliable software, try one of the QNAP devices. You still get access to many of the usual commands that you would normally find on a Linux box for emergencies."><meta name=twitter:site content="@mhayden"><meta itemprop=name content="Boot VM‚Äôs with virt-manager and libvirt with ISO‚Äôs stored remotely via samba/cifs"><meta itemprop=description content="Pairing virt-manager with KVM makes booting new VM&rsquo;s pretty darned easy. I have a QNAP NAS at home with a bunch of ISO&rsquo;s stored in share available to guests and I wanted to use that with libvirt to boot new VM&rsquo;s. (By the way, if you&rsquo;re looking for an off-the-shelf NAS that is built with solid hardware and pretty reliable software, try one of the QNAP devices. You still get access to many of the usual commands that you would normally find on a Linux box for emergencies."><meta itemprop=datePublished content="2013-07-07T01:51:10+00:00"><meta itemprop=dateModified content="2013-07-07T01:51:10+00:00"><meta itemprop=wordCount content="357"><meta itemprop=image content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta itemprop=keywords content="command line,fedora,linux,redhat,samba,virtualization,"><meta name=referrer content="no-referrer-when-downgrade"><style>body{font-family:Verdana,sans-serif;margin:auto;padding:20px;max-width:820px;text-align:left;background-color:#fff;word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:#444}h1,h2,h3,h4,h5,h6,strong,b{color:#222}a{color:#3273dc}.title{text-decoration:none;border:0}.title span{font-weight:400}nav a{margin-right:10px}textarea{width:100%;font-size:16px}input{font-size:16px}content{line-height:1.6}table{width:100%}img{max-width:100%}code{padding:2px 5px;background-color:#f2f2f2}pre code{color:#222;display:block;padding:20px;white-space:pre-wrap;font-size:14px}div.highlight code{background-color:unset;color:initial}blockquote{border-left:1px solid #999;color:#222;padding-left:20px;font-style:italic}footer{padding:25px;text-align:center}.helptext{color:#777;font-size:small}.errorlist{color:#eba613;font-size:small}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:#8b6fcb}@media(prefers-color-scheme:dark){body{background-color:#333;color:#ddd}h1,h2,h3,h4,h5,h6,strong,b{color:#eee}a{color:#8cc2dd}code{background-color:#777}pre code{color:#ddd}blockquote{color:#ccc}textarea,input{background-color:#252525;color:#ddd}.helptext{color:#aaa}}</style></head><body><header><a href=../../../../ class=title><h2>Major Hayden's Blog ü§†</h2></a><nav><a href=../../../../>Home</a>
<a href=../../../../ham-radio-faq>Ham Radio</a>
<a href=../../../../icanhazip-com-faq>icanhazip FAQ</a>
<a href=../../../../posts>Posts</a></nav><script async src=https://media.ethicalads.io/media/client/ethicalads.min.js></script><div data-ea-publisher=major-io data-ea-type=text></div></header><main><h1>Boot VM‚Äôs with virt-manager and libvirt with ISO‚Äôs stored remotely via samba/cifs</h1><i><time datetime=2013-07-07 pubdate>2013-07-07</time></i>
<content><p><img src=http://major.io/wp-content/uploads/2013/07/qnap.jpg alt=1></p><p>Pairing <a href=http://virt-manager.org/>virt-manager</a> with KVM makes booting new VM&rsquo;s pretty darned easy. I have a <a href="http://www.qnap.com/en/?lang=en&sn=822&c=1655&sc=1656&t=1660&n=6703">QNAP NAS</a> at home with a bunch of ISO&rsquo;s stored in share available to guests and I wanted to use that with libvirt to boot new VM&rsquo;s. (By the way, if you&rsquo;re looking for an off-the-shelf NAS that is built with solid hardware and pretty reliable software, try one of the QNAP devices. You still get access to many of the usual commands that you would normally find on a Linux box for emergencies. More on that in a later post.)</p><p>The first step was creating a mountpoint and configuring the mount in /etc/fstab:</p><pre><code># mkdir /mnt/iso
# grep qemu /etc/passwd
qemu‚ùå107:107:qemu user:/:/sbin/nologin
# echo &quot;//qnap/ISO /mnt/iso cifs    _netdev,guest,uid=107,gid=107,defaults 0 0&quot; &gt;&gt; /etc/fstab
# mount /mnt/iso
</code></pre><p>My QNAP is already in /etc/hosts so I didn&rsquo;t need to specify the IP in the file. Adding <code>_netdev</code> ensures that the network will be up before the mount is made. The <code>guest</code> option ensures that I won&rsquo;t be prompted for credentials and the <code>uid=107,gid=107</code> mounts the share as the qemu user. If you forget this, virt-manager will throw some ugly permissions errors from libvirt.</p><p>From there, I had another permissions error and I suspected that SELinux was preventing libvirt from accessing the files in the share. A quick check of /var/log/messages revealed that I was right:</p><pre><code>Jul  6 16:12:51 nuc1 setroubleshoot: SELinux is preventing /usr/bin/qemu-system-x86_64 from open access on the file /mnt/iso/livecd.iso. For complete SELinux messages. run sealert -l c1c80b2c-b5df-4114-86c7-ffee98274552
</code></pre><p>Here&rsquo;s the output from sealert:</p><pre><code># sealert -l c1c80b2c-b5df-4114-86c7-ffee98274552
SELinux is preventing /usr/bin/qemu-system-x86_64 from open access on the file /mnt/iso/livecd.iso.

*****  Plugin catchall_boolean (89.3 confidence) suggests  *******************

If you want to allow virt to use samba
Then you must tell SELinux about this by enabling the 'virt_use_samba' boolean.
You can read 'None' man page for more details.
Do
setsebool -P virt_use_samba 1
</code></pre><p>The fix is a quick one:</p><pre><code># setsebool -P virt_use_samba 1
</code></pre><p>You should be all set after that. Press ‚ÄúBrowse Local‚Äù in virt-manager when you look for your ISO to boot the virtual machine and navigate over to /mnt/iso for your list of ISO&rsquo;s.</p></content><p><a href=https://major.io/tags/command-line/>#command line</a>
<a href=https://major.io/tags/fedora/>#fedora</a>
<a href=https://major.io/tags/linux/>#linux</a>
<a href=https://major.io/tags/redhat/>#redhat</a>
<a href=https://major.io/tags/samba/>#samba</a>
<a href=https://major.io/tags/virtualization/>#virtualization</a></p></main><footer><hr>CC-BY-SA 4.0 &#187;
Made with <a href=https://gohugo.io/>Hugo</a> &#187;
Theme based on <a href=https://github.com/janraasch/hugo-bearblog/>Hugo  ï‚Ä¢·¥•‚Ä¢ î Bear</a><br></footer></body></html>