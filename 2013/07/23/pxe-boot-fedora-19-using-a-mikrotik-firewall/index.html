<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="Major Hayden"><meta name=description content="Outside of the RHCA exams, I haven&amp;rsquo;t configured a PXE system for my personal needs. A colleague demoed his PXE setup for me and I was hooked. Once I realized how much time I could save when I&amp;rsquo;m building and tearing down virtual machines, it made complete sense. This post will show you how to configure PXE and tftpd in Mikrotik&amp;rsquo;s RouterOS to boot and install Fedora 19 (as well as provide rescue environments)."><meta name=keywords content=",fedora,mikro,network,pxe,redhat,ssh,sysadmin,virt-manager,virtualization"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://major.io/2013/07/23/pxe-boot-fedora-19-using-a-mikrotik-firewall/><title>PXE boot Fedora 19 using a Mikrotik firewall :: Major Hayden ðŸ¤  â€” Words of wisdom from a social nerd</title><link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css rel=stylesheet type=text/css><link rel=stylesheet href=../../../../main.min.5dcefbf8102eb536dd3e2de53ffebfa58599ab2435c241a0db81728a5e015f2e.css><link rel=apple-touch-icon sizes=180x180 href=../../../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../../../favicon-16x16.png><link rel=manifest href=../../../../site.webmanifest><link rel=mask-icon href=../../../../safari-pinned-tab.svg color=#252627><link rel="shortcut icon" href=../../../../favicon.ico><meta name=msapplication-TileColor content="#252627"><meta name=theme-color content="#252627"><meta itemprop=name content="PXE boot Fedora 19 using a Mikrotik firewall"><meta itemprop=description content="Outside of the RHCA exams, I haven&rsquo;t configured a PXE system for my personal needs. A colleague demoed his PXE setup for me and I was hooked. Once I realized how much time I could save when I&rsquo;m building and tearing down virtual machines, it made complete sense. This post will show you how to configure PXE and tftpd in Mikrotik&rsquo;s RouterOS to boot and install Fedora 19 (as well as provide rescue environments)."><meta itemprop=datePublished content="2013-07-23T21:47:33+00:00"><meta itemprop=dateModified content="2013-07-23T21:47:33+00:00"><meta itemprop=wordCount content="565"><meta itemprop=image content="https://major.io"><meta itemprop=keywords content="fedora,mikro,network,pxe,redhat,ssh,sysadmin,virt-manager,virtualization,"><meta property="article:section" content="Blog Posts"><meta property="article:published_time" content="2013-07-23 21:47:33 +0000 UTC"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="PXE boot Fedora 19 using a Mikrotik firewall :: Major Hayden ðŸ¤ "><meta name=twitter:description content><meta name=twitter:site content="https://major.io"><meta name=twitter:creator content="Major Hayden"><meta name=twitter:image content><style type=text/css>html{letter-spacing:unset}</style></head><body class=dark-theme><div class=container><header class=header><span class=header__inner><a href=../../../../ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>$ echo major.io</span>
<span class=logo__cursor style=visibility:hidden></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=https://major.io/ham-radio-faq>hamradio</a></li><li><a href=https://major.io/icanhazip-com-faq>icanhazip</a></li><li><a href=https://major.io/posts/>posts</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41C32.4934 41 41 32.4934 41 22 41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href=https://major.io/2013/07/23/pxe-boot-fedora-19-using-a-mikrotik-firewall/>PXE boot Fedora 19 using a Mikrotik firewall</a></h2><div class=post-content><p>Outside of the RHCA exams, I haven&rsquo;t configured a <a href=http://en.wikipedia.org/wiki/Preboot_Execution_Environment>PXE</a> system for my personal needs. A colleague demoed his PXE setup for me and I was hooked. Once I realized how much time I could save when I&rsquo;m building and tearing down virtual machines, it made complete sense. This post will show you how to configure PXE and tftpd in <a href="http://major.io/?s=mikrotik">Mikrotik&rsquo;s RouterOS</a> to boot and install Fedora 19 (as well as provide rescue environments).</p><p>The first thing you&rsquo;ll need are a few files from a working Fedora installation. Install the <code>syslinux-tftpboot</code> package and grab the following files:</p><pre><code>/tftpboot/pxelinux.0
/tftpboot/vesamenu.c32
</code></pre><p>You&rsquo;ll also need a <a href=http://mirrors.kernel.org/fedora/releases/19/Fedora/x86_64/os/images/pxeboot/vmlinuz>vmlinuz</a> and <a href=http://mirrors.kernel.org/fedora/releases/19/Fedora/x86_64/os/images/pxeboot/initrd.img>initrd.img</a> file from your favorite Fedora mirror (use the linked text here for F19 x86_64 or look in the <code>os/images/pxeboot</code> directory on the mirror for your architecture).</p><p>When you have your four files, create a directory on the Mikrotik via FTP called <strong>tftp</strong>, and upload those to your Mikrotik. Your directory should look something like this:</p><pre><code> ls tftp/
-rw-rw----   1 root     root       155792 Jul 23 00:01 vesamenu.c32
-rw-rw----   1 root     root      5055896 Jul 22 23:41 vmlinuz
-rw-rw----   1 root     root     32829968 Jul 22 23:42 initrd.img
-rw-rw----   1 root     root        26460 Jul 22 23:37 pxelinux.0
</code></pre><p>Within the <strong>tftp</strong> directory, make a directory called <strong>pxelinux.cfg</strong>. Add a file called <strong>default</strong> inside the pxelinux.cfg directory with these contents:</p><pre><code>default vesamenu.c32
prompt 0
timeout 600

display boot.msg

label linux
  menu label ^Install or upgrade an existing system
  kernel vmlinuz
  append initrd=initrd.img repo=http://mirrors.kernel.org/fedora/releases/19/Fedora/x86_64/os/ ks=http://example.com/kickstart.ks ip=eth0:dhcp
label vesa
  menu label Install system with ^basic video driver
  kernel vmlinuz
  append initrd=initrd.img xdriver=vesa nomodeset
label rescue
  menu label ^Rescue installed system
  menu default
  kernel vmlinuz
  append initrd=initrd.img repo=http://mirrors.kernel.org/fedora/releases/19/Fedora/x86_64/os/ rescue ip=eth0:dhcp
label local
  menu label Boot from ^local drive
  localboot 0xffff
</code></pre><p>Be sure to adjust the <code>ip=</code> <code>and</code> <code>repo=</code> arguments to fit your server. Keep in mind that from Fedora 17 on, you&rsquo;ll need to use the <a href=https://fedoraproject.org/wiki/Dracut/Options#Network>dracut syntax</a> for anaconda boot options. Once that&rsquo;s done, you&rsquo;re ready to configure the Mikrotik firewall, so get logged into the firewall over ssh.</p><p>We need to set some network options for our Mikrotik&rsquo;s DHCP server:</p><pre><code>/ip dhcp-server network
set 0 boot-file-name=pxelinux.0 next-server=192.168.25.1
</code></pre><p>The value for <code>next-server=</code> should be the gateway address for your internal network (the Mikrotik&rsquo;s internal IP).</p><p>Next, we need to configure the tftp server so that it serves up files to our internal network:</p><pre><code>/ip tftp
add ip-addresses=192.168.25.0/24 real-filename=tftp/pxelinux.0 req-filename=pxelinux.0
add ip-addresses=192.168.25.0/24 real-filename=tftp/pxelinux.cfg/default req-filename=pxelinux.cfg/default
add ip-addresses=192.168.25.0/24 real-filename=tftp/vmlinuz req-filename=vmlinuz
add ip-addresses=192.168.25.0/24 real-filename=tftp/vesamenu.c32 req-filename=vesamenu.c32
add ip-addresses=192.168.25.0/24 real-filename=tftp/initrd.img req-filename=initrd.img
</code></pre><p>Now it&rsquo;s time to test it! If you&rsquo;re using a physical machine, double check your BIOS to verify that PXE boot is enabled for your ethernet interface. Most modern chipsets have support for it, but be sure to check that it&rsquo;s enabled. You may have to reboot after enabling it in the BIOS for the ethernet BIOS to be included.</p><p>If you&rsquo;re using a virtual machine, just start up virt-manager and choose <em>Network Boot (PXE)</em> from the installation options:</p><p><img src=../../../../wp-content/uploads/2013/07/virt-manager-pxe.png alt=6></p><p>Once the VM boots, you&rsquo;ll be sent straight to the PXE boot screen:</p><p><img src=../../../../wp-content/uploads/2013/07/pxetest-Virtual-Machine.png alt=7></p><p><strong>TAKE NOTE!</strong> In the pxelinux.cfg/default file, I set rescue mode to boot as the default option. This will prevent a situation where you forget to remove PXE from a system&rsquo;s boot order and accidentally re-kickstart over the live system.</p><p>The installer should now boot up normally and you can install your Fedora system via kickstart or via the anaconda interface.</p></div></article><hr><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://major.io/tags/fedora>fedora</a></span><span class=tag><a href=https://major.io/tags/mikro>mikro</a></span><span class=tag><a href=https://major.io/tags/network>network</a></span><span class=tag><a href=https://major.io/tags/pxe>pxe</a></span><span class=tag><a href=https://major.io/tags/redhat>redhat</a></span><span class=tag><a href=https://major.io/tags/ssh>ssh</a></span><span class=tag><a href=https://major.io/tags/sysadmin>sysadmin</a></span><span class=tag><a href=https://major.io/tags/virt-manager>virt-manager</a></span><span class=tag><a href=https://major.io/tags/virtualization>virtualization</a></span></p></div></main></div><footer class=footer><div class=footer__inner><div class=footer__content><span>&copy; 2021</span>
<span><a href=https://major.io>Major Hayden</a></span>
<span><a href=https://creativecommons.org/licenses/by-sa/2.0/ target=_blank rel=noopener>CC BY-SA 2.0</a></span>
<span><a href=https://major.io/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></span></div></div><div class=footer__inner><div class=footer__content><span>Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>Made with &#10084; by <a href=https://github.com/rhazdon>rhazdon</a></span></div></div></footer></div><script type=text/javascript src=../../../../bundle.min.2d5469329143160ae2456a69c3c76dc2d0a3b212b46afe291a51bd68650ed6f8697e001dab54f1c272c77ce08092a8c55e5bb4314e0ee334aab4b927ec896638.js integrity="sha512-LVRpMpFDFgriRWppw8dtwtCjshK0av4pGlG9aGUO1vhpfgAdq1TxwnLHfOCAkqjFXlu0MU4O4zSqtLkn7IlmOA=="></script></body></html>