<!doctype html><html lang=en-us><head><meta http-equiv=x-clacks-overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://major.io/favicon.ico><title>PXE boot Fedora 19 using a Mikrotik firewall | Major Hayden's Blog ðŸ¤ </title><meta name=title content="PXE boot Fedora 19 using a Mikrotik firewall"><meta name=description content="Outside of the RHCA exams, I haven&rsquo;t configured a PXE system for my personal needs. A colleague demoed his PXE setup for me and I was hooked. Once I realized how much time I could save when I&rsquo;m building and tearing down virtual machines, it made complete sense. This post will show you how to configure PXE and tftpd in Mikrotik&rsquo;s RouterOS to boot and install Fedora 19 (as well as provide rescue environments)."><meta name=keywords content="fedora,mikro,network,pxe,redhat,ssh,sysadmin,virt-manager,virtualization,"><meta property="og:title" content="PXE boot Fedora 19 using a Mikrotik firewall"><meta property="og:description" content="Outside of the RHCA exams, I haven&rsquo;t configured a PXE system for my personal needs. A colleague demoed his PXE setup for me and I was hooked. Once I realized how much time I could save when I&rsquo;m building and tearing down virtual machines, it made complete sense. This post will show you how to configure PXE and tftpd in Mikrotik&rsquo;s RouterOS to boot and install Fedora 19 (as well as provide rescue environments)."><meta property="og:type" content="article"><meta property="og:url" content="https://major.io/2013/07/23/pxe-boot-fedora-19-using-a-mikrotik-firewall/"><meta property="og:image" content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2013-07-23T21:47:33+00:00"><meta property="article:modified_time" content="2020-02-12T16:36:14-06:00"><meta property="og:site_name" content="Major Hayden's Blog ðŸ¤ "><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta name=twitter:title content="PXE boot Fedora 19 using a Mikrotik firewall"><meta name=twitter:description content="Outside of the RHCA exams, I haven&rsquo;t configured a PXE system for my personal needs. A colleague demoed his PXE setup for me and I was hooked. Once I realized how much time I could save when I&rsquo;m building and tearing down virtual machines, it made complete sense. This post will show you how to configure PXE and tftpd in Mikrotik&rsquo;s RouterOS to boot and install Fedora 19 (as well as provide rescue environments)."><meta name=twitter:site content="@mhayden"><meta itemprop=name content="PXE boot Fedora 19 using a Mikrotik firewall"><meta itemprop=description content="Outside of the RHCA exams, I haven&rsquo;t configured a PXE system for my personal needs. A colleague demoed his PXE setup for me and I was hooked. Once I realized how much time I could save when I&rsquo;m building and tearing down virtual machines, it made complete sense. This post will show you how to configure PXE and tftpd in Mikrotik&rsquo;s RouterOS to boot and install Fedora 19 (as well as provide rescue environments)."><meta itemprop=datePublished content="2013-07-23T21:47:33+00:00"><meta itemprop=dateModified content="2020-02-12T16:36:14-06:00"><meta itemprop=wordCount content="565"><meta itemprop=image content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta itemprop=keywords content="fedora,mikro,network,pxe,redhat,ssh,sysadmin,virt-manager,virtualization,"><meta name=referrer content="no-referrer-when-downgrade"><style>body{font-family:Verdana,sans-serif;margin:auto;padding:20px;max-width:820px;text-align:left;background-color:#fff;word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:#444}h1,h2,h3,h4,h5,h6,strong,b{color:#222}a{color:#3273dc}.title{text-decoration:none;border:0}.title span{font-weight:400}nav a{margin-right:10px}textarea{width:100%;font-size:16px}input{font-size:16px}content{line-height:1.6}table{width:100%}img{max-width:100%}code{padding:2px 5px;background-color:#f2f2f2}pre code{color:#222;display:block;padding:20px;white-space:pre-wrap;font-size:14px}div.highlight code{background-color:unset;color:initial}blockquote{border-left:1px solid #999;color:#222;padding-left:20px;font-style:italic}footer{padding:25px;text-align:center}.helptext{color:#777;font-size:small}.errorlist{color:#eba613;font-size:small}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:#8b6fcb}@media(prefers-color-scheme:dark){body{background-color:#333;color:#ddd}h1,h2,h3,h4,h5,h6,strong,b{color:#eee}a{color:#8cc2dd}code{background-color:#777}pre code{color:#ddd}blockquote{color:#ccc}textarea,input{background-color:#252525;color:#ddd}.helptext{color:#aaa}}</style></head><body><header><a href=../../../../ class=title><h2>Major Hayden's Blog ðŸ¤ </h2></a><nav><a href=../../../../>Home</a>
<a href=../../../../ham-radio-faq>Ham Radio</a>
<a href=../../../../icanhazip-com-faq>icanhazip FAQ</a>
<a href=../../../../posts>Posts</a></nav><script async src=https://media.ethicalads.io/media/client/ethicalads.min.js></script><div class="adaptive raised" data-ea-publisher=major-io data-ea-type=text></div></header><main><h1>PXE boot Fedora 19 using a Mikrotik firewall</h1><i><time datetime=2013-07-23 pubdate>2013-07-23</time></i>
<content><p>Outside of the RHCA exams, I haven&rsquo;t configured a <a href=http://en.wikipedia.org/wiki/Preboot_Execution_Environment>PXE</a> system for my personal needs. A colleague demoed his PXE setup for me and I was hooked. Once I realized how much time I could save when I&rsquo;m building and tearing down virtual machines, it made complete sense. This post will show you how to configure PXE and tftpd in <a href="http://major.io/?s=mikrotik">Mikrotik&rsquo;s RouterOS</a> to boot and install Fedora 19 (as well as provide rescue environments).</p><p>The first thing you&rsquo;ll need are a few files from a working Fedora installation. Install the <code>syslinux-tftpboot</code> package and grab the following files:</p><pre><code>/tftpboot/pxelinux.0
/tftpboot/vesamenu.c32
</code></pre><p>You&rsquo;ll also need a <a href=http://mirrors.kernel.org/fedora/releases/19/Fedora/x86_64/os/images/pxeboot/vmlinuz>vmlinuz</a> and <a href=http://mirrors.kernel.org/fedora/releases/19/Fedora/x86_64/os/images/pxeboot/initrd.img>initrd.img</a> file from your favorite Fedora mirror (use the linked text here for F19 x86_64 or look in the <code>os/images/pxeboot</code> directory on the mirror for your architecture).</p><p>When you have your four files, create a directory on the Mikrotik via FTP called <strong>tftp</strong>, and upload those to your Mikrotik. Your directory should look something like this:</p><pre><code> ls tftp/
-rw-rw----   1 root     root       155792 Jul 23 00:01 vesamenu.c32
-rw-rw----   1 root     root      5055896 Jul 22 23:41 vmlinuz
-rw-rw----   1 root     root     32829968 Jul 22 23:42 initrd.img
-rw-rw----   1 root     root        26460 Jul 22 23:37 pxelinux.0
</code></pre><p>Within the <strong>tftp</strong> directory, make a directory called <strong>pxelinux.cfg</strong>. Add a file called <strong>default</strong> inside the pxelinux.cfg directory with these contents:</p><pre><code>default vesamenu.c32
prompt 0
timeout 600

display boot.msg

label linux
  menu label ^Install or upgrade an existing system
  kernel vmlinuz
  append initrd=initrd.img repo=http://mirrors.kernel.org/fedora/releases/19/Fedora/x86_64/os/ ks=http://example.com/kickstart.ks ip=eth0:dhcp
label vesa
  menu label Install system with ^basic video driver
  kernel vmlinuz
  append initrd=initrd.img xdriver=vesa nomodeset
label rescue
  menu label ^Rescue installed system
  menu default
  kernel vmlinuz
  append initrd=initrd.img repo=http://mirrors.kernel.org/fedora/releases/19/Fedora/x86_64/os/ rescue ip=eth0:dhcp
label local
  menu label Boot from ^local drive
  localboot 0xffff
</code></pre><p>Be sure to adjust the <code>ip=</code> <code>and</code> <code>repo=</code> arguments to fit your server. Keep in mind that from Fedora 17 on, you&rsquo;ll need to use the <a href=https://fedoraproject.org/wiki/Dracut/Options#Network>dracut syntax</a> for anaconda boot options. Once that&rsquo;s done, you&rsquo;re ready to configure the Mikrotik firewall, so get logged into the firewall over ssh.</p><p>We need to set some network options for our Mikrotik&rsquo;s DHCP server:</p><pre><code>/ip dhcp-server network
set 0 boot-file-name=pxelinux.0 next-server=192.168.25.1
</code></pre><p>The value for <code>next-server=</code> should be the gateway address for your internal network (the Mikrotik&rsquo;s internal IP).</p><p>Next, we need to configure the tftp server so that it serves up files to our internal network:</p><pre><code>/ip tftp
add ip-addresses=192.168.25.0/24 real-filename=tftp/pxelinux.0 req-filename=pxelinux.0
add ip-addresses=192.168.25.0/24 real-filename=tftp/pxelinux.cfg/default req-filename=pxelinux.cfg/default
add ip-addresses=192.168.25.0/24 real-filename=tftp/vmlinuz req-filename=vmlinuz
add ip-addresses=192.168.25.0/24 real-filename=tftp/vesamenu.c32 req-filename=vesamenu.c32
add ip-addresses=192.168.25.0/24 real-filename=tftp/initrd.img req-filename=initrd.img
</code></pre><p>Now it&rsquo;s time to test it! If you&rsquo;re using a physical machine, double check your BIOS to verify that PXE boot is enabled for your ethernet interface. Most modern chipsets have support for it, but be sure to check that it&rsquo;s enabled. You may have to reboot after enabling it in the BIOS for the ethernet BIOS to be included.</p><p>If you&rsquo;re using a virtual machine, just start up virt-manager and choose <em>Network Boot (PXE)</em> from the installation options:</p><p><img src=../../../../wp-content/uploads/2013/07/virt-manager-pxe.png alt=6></p><p>Once the VM boots, you&rsquo;ll be sent straight to the PXE boot screen:</p><p><img src=../../../../wp-content/uploads/2013/07/pxetest-Virtual-Machine.png alt=7></p><p><strong>TAKE NOTE!</strong> In the pxelinux.cfg/default file, I set rescue mode to boot as the default option. This will prevent a situation where you forget to remove PXE from a system&rsquo;s boot order and accidentally re-kickstart over the live system.</p><p>The installer should now boot up normally and you can install your Fedora system via kickstart or via the anaconda interface.</p></content><p><a href=https://major.io/tags/fedora/>#fedora</a>
<a href=https://major.io/tags/mikro/>#mikro</a>
<a href=https://major.io/tags/network/>#network</a>
<a href=https://major.io/tags/pxe/>#pxe</a>
<a href=https://major.io/tags/redhat/>#redhat</a>
<a href=https://major.io/tags/ssh/>#ssh</a>
<a href=https://major.io/tags/sysadmin/>#sysadmin</a>
<a href=https://major.io/tags/virt-manager/>#virt-manager</a>
<a href=https://major.io/tags/virtualization/>#virtualization</a></p></main><footer><hr>CC-BY-SA 4.0 &#187;
Made with <a href=https://gohugo.io/>Hugo</a> &#187;
Theme based on <a href=https://github.com/janraasch/hugo-bearblog/>Hugo Ê•â€¢á´¥â€¢Ê” Bear</a> &#187;
<a href=https://github.com/major/major.io/commit/84372fb2198913a5e498b8d32ffc77fb813f0a48>84372fb2</a></footer></body></html>