<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="Major Hayden"><meta name=description content="I&amp;rsquo;ve converted one of my KVM hypervisors from CentOS 6 to Fedora 18 and now comes the task of migrating my virtual machines off of my single remaining CentOS 6 hypervisor. This is definitely on a budget, so there&amp;rsquo;s no shared storage to make this process easier.
Here&amp;rsquo;s how I did it:
Migrate the logical volume
My first VM to migrate is my Fedora development VM where I build and test new packages."><meta name=keywords content=",centos,command line,fedora,kvm,linux,red hat,virtualization"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://major.io/2013/05/22/migrate-kvm-virtual-machines-from-centos-6-to-fedora-18-without-the-luxury-of-shared-storage/><title>Migrate KVM virtual machines from CentOS 6 to Fedora 18 without the luxury of shared storage :: Major Hayden ðŸ¤  â€” Words of wisdom from a social nerd</title><link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css rel=stylesheet type=text/css><link rel=stylesheet href=../../../../main.min.5dcefbf8102eb536dd3e2de53ffebfa58599ab2435c241a0db81728a5e015f2e.css><link rel=apple-touch-icon sizes=180x180 href=../../../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../../../favicon-16x16.png><link rel=manifest href=../../../../site.webmanifest><link rel=mask-icon href=../../../../safari-pinned-tab.svg color=#252627><link rel="shortcut icon" href=../../../../favicon.ico><meta name=msapplication-TileColor content="#252627"><meta name=theme-color content="#252627"><meta itemprop=name content="Migrate KVM virtual machines from CentOS 6 to Fedora 18 without the luxury of shared storage"><meta itemprop=description content="I&rsquo;ve converted one of my KVM hypervisors from CentOS 6 to Fedora 18 and now comes the task of migrating my virtual machines off of my single remaining CentOS 6 hypervisor. This is definitely on a budget, so there&rsquo;s no shared storage to make this process easier.
Here&rsquo;s how I did it:
Migrate the logical volume
My first VM to migrate is my Fedora development VM where I build and test new packages."><meta itemprop=datePublished content="2013-05-22T15:15:36+00:00"><meta itemprop=dateModified content="2013-05-22T15:15:36+00:00"><meta itemprop=wordCount content="511"><meta itemprop=image content="https://major.io"><meta itemprop=keywords content="centos,command line,fedora,kvm,linux,red hat,virtualization,"><meta property="article:section" content="Blog Posts"><meta property="article:published_time" content="2013-05-22 15:15:36 +0000 UTC"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Migrate KVM virtual machines from CentOS 6 to Fedora 18 without the luxury of shared storage :: Major Hayden ðŸ¤ "><meta name=twitter:description content><meta name=twitter:site content="https://major.io"><meta name=twitter:creator content="Major Hayden"><meta name=twitter:image content><style type=text/css>html{letter-spacing:unset}</style></head><body class=dark-theme><div class=container><header class=header><span class=header__inner><a href=../../../../ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>$ echo major.io</span>
<span class=logo__cursor style=visibility:hidden></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=https://major.io/ham-radio-faq>hamradio</a></li><li><a href=https://major.io/icanhazip-com-faq>icanhazip</a></li><li><a href=https://major.io/posts/>posts</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41C32.4934 41 41 32.4934 41 22 41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href=https://major.io/2013/05/22/migrate-kvm-virtual-machines-from-centos-6-to-fedora-18-without-the-luxury-of-shared-storage/>Migrate KVM virtual machines from CentOS 6 to Fedora 18 without the luxury of shared storage</a></h2><div class=post-content><p>I&rsquo;ve converted one of my KVM hypervisors from CentOS 6 to Fedora 18 and now comes the task of migrating my virtual machines off of my single remaining CentOS 6 hypervisor. This is definitely on a budget, so there&rsquo;s no shared storage to make this process easier.</p><p>Here&rsquo;s how I did it:</p><p><strong>Migrate the logical volume</strong></p><p>My first VM to migrate is my Fedora development VM where I build and test new packages. I have a 10G logical volume on the old node:</p><pre><code>[root@helium ~]# lvs /dev/mapper/vg_helium-fedora--dev
  LV         VG        Attr     LSize  Pool Origin Data%  Move Log Copy%  Convert
  fedora-dev vg_helium -wi-a--- 10.00g
</code></pre><p>I made a 10G logical volume on the new hypervisor:</p><pre><code>[root@hydrogen ~]# lvcreate -n fedora-dev -L10G vg_hydrogen
  Logical volume &quot;fedora-dev&quot; created
</code></pre><p>After getting ssh keys set up between both hypervisors and installing <a href=http://linux.die.net/man/1/pv><code>pv</code></a> (to track progress), I started the storage migration over ssh:</p><pre><code>dd if=/dev/mapper/vg_helium-fedora--dev | pv | ssh hydrogen dd of=/dev/mapper/vg_hydrogen-fedora--dev
</code></pre><p>Luckily it was only a 10GB logical volume so it transferred over in a few minutes.</p><p><strong>Dump and adjust the source VM&rsquo;s XML</strong></p><p>On the source server, I dumped the VM configuration to an XML file and copied it to the new host:</p><pre><code>virsh dumpxml fedora-dev &gt; fedora-dev.xml
scp fedora-dev.xml hydrogen:
</code></pre><p>Before importing the XML file on the new host, there are some adjustments that need to be made. First off was an adjustment of the storage volume since the new host had the same logical volume name but a different volume group (the source line):</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml>  <span style=color:#268bd2>&lt;disk</span> type=<span style=color:#2aa198>&#39;block&#39;</span> device=<span style=color:#2aa198>&#39;disk&#39;</span><span style=color:#268bd2>&gt;</span>
  <span style=color:#268bd2>&lt;driver</span> name=<span style=color:#2aa198>&#39;qemu&#39;</span> type=<span style=color:#2aa198>&#39;raw&#39;</span> cache=<span style=color:#2aa198>&#39;none&#39;</span> io=<span style=color:#2aa198>&#39;native&#39;</span><span style=color:#268bd2>&gt;&lt;/driver&gt;</span>
  <span style=color:#268bd2>&lt;source</span> dev=<span style=color:#2aa198>&#39;/dev/vg_hydrogen/fedora-dev&#39;</span><span style=color:#268bd2>/&gt;</span>
  <span style=color:#268bd2>&lt;target</span> dev=<span style=color:#2aa198>&#39;vda&#39;</span> bus=<span style=color:#2aa198>&#39;virtio&#39;</span><span style=color:#268bd2>&gt;&lt;/target&gt;</span>


<span style=color:#268bd2>&lt;address</span> type=<span style=color:#2aa198>&#39;pci&#39;</span> domain=<span style=color:#2aa198>&#39;0x0000&#39;</span> bus=<span style=color:#2aa198>&#39;0x00&#39;</span> slot=<span style=color:#2aa198>&#39;0x05&#39;</span> function=<span style=color:#2aa198>&#39;0x0&#39;</span><span style=color:#268bd2>&gt;</span>

<span style=color:#268bd2>&lt;/address&gt;</span>
<span style=color:#268bd2>&lt;/disk&gt;</span>
</code></pre></div><p>Also, there&rsquo;s a mismatch with the machine type (not architecture) between CentOS 6 and Fedora 18. I dumped the XML from a VM running on the Fedora 18 hypervisor and compared the machine type to my old CentOS VM&rsquo;s XML (the XML from the CentOS VM is on top):</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-diff data-lang=diff><span style=color:#dc322f>-    &lt;type arch=&#39;x86_64&#39; machine=&#39;rhel6.3.0&#39;&gt;hvm&lt;/type&gt;
</span><span style=color:#dc322f></span><span style=color:#719e07>+    &lt;type arch=&#39;x86_64&#39; machine=&#39;pc-1.2&#39;&gt;hvm&lt;/type&gt;
</span></code></pre></div><p>I replaced <code>rhel6.3.0</code> with <code>pc-1.2</code>. <em>If you forget this step, your VM won&rsquo;t start.</em> You&rsquo;ll get some errors about a mismatched machine type before the VM boots.</p><p>There&rsquo;s one last fix: the path to the <code>qemu-kvm</code> emulator:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-diff data-lang=diff><span style=color:#dc322f>-    &lt;emulator&gt;/usr/libexec/qemu-kvm&lt;/emulator&gt;
</span><span style=color:#dc322f></span><span style=color:#719e07>+    &lt;emulator&gt;/usr/bin/qemu-kvm&lt;/emulator&gt;
</span></code></pre></div><p>Replace <code>/usr/libexec/qemu-kvm</code> with <code>/usr/bin/qemu-kvm</code> and save your XML file.</p><p><strong>Import the VM configuration and launch the VM</strong></p><p>Importing the VM on the Fedora 18 hypervisor was easy:</p><pre><code>virsh define fedora-dev.xml
</code></pre><p>That causes the configuration to load into libvirt and it should appear in <code>virt-manager</code> or <code>virsh list</code> by this point. If not, double check your previous steps and look for error messages in your logs. That doesn&rsquo;t actually start the virtual machine, so I started it on the command line:</p><pre><code>virsh start fedora-dev
</code></pre><p>Within a few moments, the VM was up and responding to pings.</p><p>It&rsquo;s a good idea to hop into <code>virt-manager</code> and verify that the VM configuration is what you expect. Some configuration options don&rsquo;t line up terribly well between CentOS 6 and Fedora 18. You might need to adjust a few to match the performance you expect to see.</p></div></article><hr><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://major.io/tags/centos>centos</a></span><span class=tag><a href=https://major.io/tags/command-line>command line</a></span><span class=tag><a href=https://major.io/tags/fedora>fedora</a></span><span class=tag><a href=https://major.io/tags/kvm>kvm</a></span><span class=tag><a href=https://major.io/tags/linux>linux</a></span><span class=tag><a href=https://major.io/tags/red-hat>red hat</a></span><span class=tag><a href=https://major.io/tags/virtualization>virtualization</a></span></p></div></main></div><footer class=footer><div class=footer__inner><div class=footer__content><span>&copy; 2021</span>
<span><a href=https://major.io>Major Hayden</a></span>
<span><a href=https://creativecommons.org/licenses/by-sa/2.0/ target=_blank rel=noopener>CC BY-SA 2.0</a></span>
<span><a href=https://major.io/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></span></div></div><div class=footer__inner><div class=footer__content><span>Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>Made with &#10084; by <a href=https://github.com/rhazdon>rhazdon</a></span></div></div></footer></div><script type=text/javascript src=../../../../bundle.min.2d5469329143160ae2456a69c3c76dc2d0a3b212b46afe291a51bd68650ed6f8697e001dab54f1c272c77ce08092a8c55e5bb4314e0ee334aab4b927ec896638.js integrity="sha512-LVRpMpFDFgriRWppw8dtwtCjshK0av4pGlG9aGUO1vhpfgAdq1TxwnLHfOCAkqjFXlu0MU4O4zSqtLkn7IlmOA=="></script></body></html>