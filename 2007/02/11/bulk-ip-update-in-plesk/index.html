<!doctype html><html lang=en-us><head><meta http-equiv=x-clacks-overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://major.io/favicon.ico><title>Bulk IP update in Plesk | Major Hayden's Blog ðŸ¤ </title><meta name=title content="Bulk IP update in Plesk"><meta name=description content="There&rsquo;s lots of situations where you&rsquo;d want to use a bulk IP change in Plesk:
 Server is moving and needs to change IP&rsquo;s An IP is the destination for some type of DDOS attack An IP needs to be removed from the server  So how do you shift tons of domains from one IP to another without spending hours in Plesk clicking and clicking? Do the following instead:"><meta name=keywords content="plesk,"><meta property="og:title" content="Bulk IP update in Plesk"><meta property="og:description" content="There&rsquo;s lots of situations where you&rsquo;d want to use a bulk IP change in Plesk:
 Server is moving and needs to change IP&rsquo;s An IP is the destination for some type of DDOS attack An IP needs to be removed from the server  So how do you shift tons of domains from one IP to another without spending hours in Plesk clicking and clicking? Do the following instead:"><meta property="og:type" content="article"><meta property="og:url" content="https://major.io/2007/02/11/bulk-ip-update-in-plesk/"><meta property="og:image" content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2007-02-12T01:41:49+00:00"><meta property="article:modified_time" content="2007-02-12T01:41:49+00:00"><meta property="og:site_name" content="Major Hayden's Blog ðŸ¤ "><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta name=twitter:title content="Bulk IP update in Plesk"><meta name=twitter:description content="There&rsquo;s lots of situations where you&rsquo;d want to use a bulk IP change in Plesk:
 Server is moving and needs to change IP&rsquo;s An IP is the destination for some type of DDOS attack An IP needs to be removed from the server  So how do you shift tons of domains from one IP to another without spending hours in Plesk clicking and clicking? Do the following instead:"><meta name=twitter:site content="@mhayden"><meta itemprop=name content="Bulk IP update in Plesk"><meta itemprop=description content="There&rsquo;s lots of situations where you&rsquo;d want to use a bulk IP change in Plesk:
 Server is moving and needs to change IP&rsquo;s An IP is the destination for some type of DDOS attack An IP needs to be removed from the server  So how do you shift tons of domains from one IP to another without spending hours in Plesk clicking and clicking? Do the following instead:"><meta itemprop=datePublished content="2007-02-12T01:41:49+00:00"><meta itemprop=dateModified content="2007-02-12T01:41:49+00:00"><meta itemprop=wordCount content="442"><meta itemprop=image content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta itemprop=keywords content="plesk,"><meta name=referrer content="no-referrer-when-downgrade"><style>body{font-family:Verdana,sans-serif;margin:auto;padding:20px;max-width:820px;text-align:left;background-color:#fff;word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:#444}h1,h2,h3,h4,h5,h6,strong,b{color:#222}a{color:#3273dc}.title{text-decoration:none;border:0}.title span{font-weight:400}nav a{margin-right:10px}textarea{width:100%;font-size:16px}input{font-size:16px}content{line-height:1.6}table{width:100%}img{max-width:100%}code{padding:2px 5px;background-color:#f2f2f2}pre code{color:#222;display:block;padding:20px;white-space:pre-wrap;font-size:14px}div.highlight code{background-color:unset;color:initial}blockquote{border-left:1px solid #999;color:#222;padding-left:20px;font-style:italic}footer{padding:25px;text-align:center}.helptext{color:#777;font-size:small}.errorlist{color:#eba613;font-size:small}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:#8b6fcb}@media(prefers-color-scheme:dark){body{background-color:#333;color:#ddd}h1,h2,h3,h4,h5,h6,strong,b{color:#eee}a{color:#8cc2dd}code{background-color:#777}pre code{color:#ddd}blockquote{color:#ccc}textarea,input{background-color:#252525;color:#ddd}.helptext{color:#aaa}}</style></head><body><header><a href=../../../../ class=title><h2>Major Hayden's Blog ðŸ¤ </h2></a><nav><a href=../../../../>Home</a>
<a href=../../../../ham-radio-faq>Ham Radio</a>
<a href=../../../../icanhazip-com-faq>icanhazip FAQ</a>
<a href=../../../../posts>Posts</a></nav><script async src=https://media.ethicalads.io/media/client/ethicalads.min.js></script><div data-ea-publisher=major-io data-ea-type=text></div></header><main><h1>Bulk IP update in Plesk</h1><i><time datetime=2007-02-12 pubdate>2007-02-12</time></i>
<content><p>There&rsquo;s lots of situations where you&rsquo;d want to use a bulk IP change in Plesk:</p><ul><li>Server is moving and needs to change IP&rsquo;s</li><li>An IP is the destination for some type of DDOS attack</li><li>An IP needs to be removed from the server</li></ul><p>So how do you shift tons of domains from one IP to another without spending hours in Plesk clicking and clicking? Do the following instead:</p><p>Get into MySQL and find out which IP you&rsquo;re moving from and to:</p><pre><code>mysql -u admin -p`cat /etc/psa/.psa.shadow`
mysql&gt; select * from IP_Addresses;
</code></pre><p>You should see a printout of all of the available IP&rsquo;s on the server. Make a note of the &ldquo;id&rdquo; of the IP you&rsquo;re moving from and to. In this example, here&rsquo;s what we&rsquo;re doing:</p><ul><li>Moving FROM &ldquo;192.168.1.192&rdquo; (id = 2)</li><li>Moving TO &ldquo;192.168.1.209&rdquo; (id =3)</li></ul><p>Now we can start shifting the physically hosted domains over in the database:</p><pre><code>mysql&gt; update hosting set ip_address_id=3 where ip_address_id=2;
</code></pre><p>We also need to change the domains that are set up for standard or frame forwarding:</p><pre><code>mysql&gt; update forwarding set ip_address_id=3 where ip_address_id=2;
</code></pre><p>Now we&rsquo;re stuck with the arduous task of updating DNS records. Plesk is kind enough to store this data in four different ways:</p><pre><code>mysql&gt; update dns_recs set displayHost='192.168.1.209' where displayHost='192.168.1.192';
mysql&gt; update dns_recs set host='192.168.1.209' where host='192.168.1.192';
mysql&gt; update dns_recs set displayVal='192.168.1.209' where displayVal='192.168.1.192';
mysql&gt; update dns_recs set val='192.168.1.209' where val='192.168.1.192';
</code></pre><p>Everything domain related is now moved, but the clients that the domains belong to might not have this new IP address in their IP pool. First, we need to find out our component ID&rsquo;s from the repository table (which generally should be the same as the IP_Addresses.id column, but not always)</p><pre><code>mysql&gt; SELECT clients.login, IP_Addresses.ip_address,Repository.* FROM clients LEFT JOIN Repository ON clients.pool_id = Repository.rep_id LEFT JOIN IP_Addresses ON Repository.component_id = IP_Addresses.id;
</code></pre><p>For this example, we&rsquo;ll pretend that the output consists of 2&rsquo;s for these clients. We can flip the IP&rsquo;s in the clients' IP pools by running the following:</p><pre><code>mysql&gt; update Repository set component_id=3 where component_id=2;
</code></pre><p>Now that everything is changed in Plesk&rsquo;s database, it&rsquo;s time to change up the Apache and BIND configuration files. Luckily, this can be done pretty easily with Plesk&rsquo;s command line tools:</p><pre><code># /usr/local/psa/admin/bin/websrvmng -av
# mysql -Ns -uadmin -p`cat /etc/psa/.psa.shadow` -D psa -e 'select name from domains' | awk '{print &quot;/usr/local/psa/admin/sbin/dnsmng update &quot; $1 }' | sh
</code></pre><p>All that is left is to force Apache and BIND to pick up the new configuration:</p><pre><code># /etc/init.d/httpd reload
# /etc/init.d/named reload
</code></pre><p>Just wait for the DNS records to propagate and you should be all set! The instructions are cumbersome, I know, but it&rsquo;s easier than clicking for-ev-er.</p></content><p><a href=https://major.io/tags/plesk/>#plesk</a></p></main><footer><hr>CC-BY-SA 4.0 &#187;
Made with <a href=https://gohugo.io/>Hugo</a> &#187;
Theme based on <a href=https://github.com/janraasch/hugo-bearblog/>Hugo Ê•â€¢á´¥â€¢Ê” Bear</a><br></footer></body></html>