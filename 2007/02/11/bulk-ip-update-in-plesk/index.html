<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="Major Hayden"><meta name=description content="There&amp;rsquo;s lots of situations where you&amp;rsquo;d want to use a bulk IP change in Plesk:
 Server is moving and needs to change IP&amp;rsquo;s An IP is the destination for some type of DDOS attack An IP needs to be removed from the server  So how do you shift tons of domains from one IP to another without spending hours in Plesk clicking and clicking? Do the following instead:"><meta name=keywords content=",plesk"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://major.io/2007/02/11/bulk-ip-update-in-plesk/><title>Bulk IP update in Plesk :: Major Hayden ðŸ¤  â€” Words of wisdom from a social nerd</title><link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css rel=stylesheet type=text/css><link rel=stylesheet href=../../../../main.min.5dcefbf8102eb536dd3e2de53ffebfa58599ab2435c241a0db81728a5e015f2e.css><link rel=apple-touch-icon sizes=180x180 href=../../../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../../../favicon-16x16.png><link rel=manifest href=../../../../site.webmanifest><link rel=mask-icon href=../../../../safari-pinned-tab.svg color=#252627><link rel="shortcut icon" href=../../../../favicon.ico><meta name=msapplication-TileColor content="#252627"><meta name=theme-color content="#252627"><meta itemprop=name content="Bulk IP update in Plesk"><meta itemprop=description content="There&rsquo;s lots of situations where you&rsquo;d want to use a bulk IP change in Plesk:
 Server is moving and needs to change IP&rsquo;s An IP is the destination for some type of DDOS attack An IP needs to be removed from the server  So how do you shift tons of domains from one IP to another without spending hours in Plesk clicking and clicking? Do the following instead:"><meta itemprop=datePublished content="2007-02-12T01:41:49+00:00"><meta itemprop=dateModified content="2007-02-12T01:41:49+00:00"><meta itemprop=wordCount content="442"><meta itemprop=image content="https://major.io"><meta itemprop=keywords content="plesk,"><meta property="article:published_time" content="2007-02-12 01:41:49 +0000 UTC"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Bulk IP update in Plesk :: Major Hayden ðŸ¤ "><meta name=twitter:description content><meta name=twitter:site content="https://major.io"><meta name=twitter:creator content="Major Hayden"><meta name=twitter:image content><style type=text/css>html{letter-spacing:unset}</style></head><body class=dark-theme><div class=container><header class=header><span class=header__inner><a href=../../../../ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>$ echo major.io</span>
<span class=logo__cursor style=visibility:hidden></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=https://major.io/ham-radio-faq>hamradio</a></li><li><a href=https://major.io/icanhazip-com-faq>icanhazip</a></li><li><a href=https://major.io/posts/>posts</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41C32.4934 41 41 32.4934 41 22 41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href=https://major.io/2007/02/11/bulk-ip-update-in-plesk/>Bulk IP update in Plesk</a></h2><div class=post-content><p>There&rsquo;s lots of situations where you&rsquo;d want to use a bulk IP change in Plesk:</p><ul><li>Server is moving and needs to change IP&rsquo;s</li><li>An IP is the destination for some type of DDOS attack</li><li>An IP needs to be removed from the server</li></ul><p>So how do you shift tons of domains from one IP to another without spending hours in Plesk clicking and clicking? Do the following instead:</p><p>Get into MySQL and find out which IP you&rsquo;re moving from and to:</p><pre><code>mysql -u admin -p`cat /etc/psa/.psa.shadow`
mysql&gt; select * from IP_Addresses;
</code></pre><p>You should see a printout of all of the available IP&rsquo;s on the server. Make a note of the &ldquo;id&rdquo; of the IP you&rsquo;re moving from and to. In this example, here&rsquo;s what we&rsquo;re doing:</p><ul><li>Moving FROM &ldquo;192.168.1.192&rdquo; (id = 2)</li><li>Moving TO &ldquo;192.168.1.209&rdquo; (id =3)</li></ul><p>Now we can start shifting the physically hosted domains over in the database:</p><pre><code>mysql&gt; update hosting set ip_address_id=3 where ip_address_id=2;
</code></pre><p>We also need to change the domains that are set up for standard or frame forwarding:</p><pre><code>mysql&gt; update forwarding set ip_address_id=3 where ip_address_id=2;
</code></pre><p>Now we&rsquo;re stuck with the arduous task of updating DNS records. Plesk is kind enough to store this data in four different ways:</p><pre><code>mysql&gt; update dns_recs set displayHost='192.168.1.209' where displayHost='192.168.1.192';
mysql&gt; update dns_recs set host='192.168.1.209' where host='192.168.1.192';
mysql&gt; update dns_recs set displayVal='192.168.1.209' where displayVal='192.168.1.192';
mysql&gt; update dns_recs set val='192.168.1.209' where val='192.168.1.192';
</code></pre><p>Everything domain related is now moved, but the clients that the domains belong to might not have this new IP address in their IP pool. First, we need to find out our component ID&rsquo;s from the repository table (which generally should be the same as the IP_Addresses.id column, but not always)</p><pre><code>mysql&gt; SELECT clients.login, IP_Addresses.ip_address,Repository.* FROM clients LEFT JOIN Repository ON clients.pool_id = Repository.rep_id LEFT JOIN IP_Addresses ON Repository.component_id = IP_Addresses.id;
</code></pre><p>For this example, we&rsquo;ll pretend that the output consists of 2&rsquo;s for these clients. We can flip the IP&rsquo;s in the clients' IP pools by running the following:</p><pre><code>mysql&gt; update Repository set component_id=3 where component_id=2;
</code></pre><p>Now that everything is changed in Plesk&rsquo;s database, it&rsquo;s time to change up the Apache and BIND configuration files. Luckily, this can be done pretty easily with Plesk&rsquo;s command line tools:</p><pre><code># /usr/local/psa/admin/bin/websrvmng -av
# mysql -Ns -uadmin -p`cat /etc/psa/.psa.shadow` -D psa -e 'select name from domains' | awk '{print &quot;/usr/local/psa/admin/sbin/dnsmng update &quot; $1 }' | sh
</code></pre><p>All that is left is to force Apache and BIND to pick up the new configuration:</p><pre><code># /etc/init.d/httpd reload
# /etc/init.d/named reload
</code></pre><p>Just wait for the DNS records to propagate and you should be all set! The instructions are cumbersome, I know, but it&rsquo;s easier than clicking for-ev-er.</p></div></article><hr><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://major.io/tags/plesk>plesk</a></span></p></div></main></div><footer class=footer><div class=footer__inner><div class=footer__content><span>&copy; 2021</span>
<span><a href=https://major.io>Major Hayden</a></span>
<span><a href=https://creativecommons.org/licenses/by-sa/2.0/ target=_blank rel=noopener>CC BY-SA 2.0</a></span>
<span><a href=https://major.io/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></span></div></div><div class=footer__inner><div class=footer__content><span>Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>Made with &#10084; by <a href=https://github.com/rhazdon>rhazdon</a></span></div></div></footer></div><script type=text/javascript src=../../../../bundle.min.2d5469329143160ae2456a69c3c76dc2d0a3b212b46afe291a51bd68650ed6f8697e001dab54f1c272c77ce08092a8c55e5bb4314e0ee334aab4b927ec896638.js integrity="sha512-LVRpMpFDFgriRWppw8dtwtCjshK0av4pGlG9aGUO1vhpfgAdq1TxwnLHfOCAkqjFXlu0MU4O4zSqtLkn7IlmOA=="></script></body></html>