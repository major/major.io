<!doctype html><html lang=en-us><head><meta http-equiv=x-clacks-overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://major.io/favicon.ico><title>Measuring raw shell bandwidth | Major Hayden's Blog ðŸ¤ </title><meta name=title content="Measuring raw shell bandwidth"><meta name=description content="Okay, so we know it&rsquo;s easy to measure web, ftp and mail traffic, right? You can just parse the logs, sum it all up, and move on with your day. However, what do you do about users with SFTP or RSYNC privileges? This can create a problem when the bandwidth on your server keeps cranking up, but your web/ftp/mail traffic stats don&rsquo;t show an increase.
Need a solution? Enjoy:
First, create an OUTPUT rule for your user, which in this case will be root."><meta name=keywords content="command line,"><meta property="og:title" content="Measuring raw shell bandwidth"><meta property="og:description" content="Okay, so we know it&rsquo;s easy to measure web, ftp and mail traffic, right? You can just parse the logs, sum it all up, and move on with your day. However, what do you do about users with SFTP or RSYNC privileges? This can create a problem when the bandwidth on your server keeps cranking up, but your web/ftp/mail traffic stats don&rsquo;t show an increase.
Need a solution? Enjoy:
First, create an OUTPUT rule for your user, which in this case will be root."><meta property="og:type" content="article"><meta property="og:url" content="https://major.io/2007/02/11/measuring-raw-shell-bandwidth/"><meta property="og:image" content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2007-02-12T04:20:06+00:00"><meta property="article:modified_time" content="2007-02-12T04:20:06+00:00"><meta property="og:site_name" content="Major Hayden's Blog ðŸ¤ "><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta name=twitter:title content="Measuring raw shell bandwidth"><meta name=twitter:description content="Okay, so we know it&rsquo;s easy to measure web, ftp and mail traffic, right? You can just parse the logs, sum it all up, and move on with your day. However, what do you do about users with SFTP or RSYNC privileges? This can create a problem when the bandwidth on your server keeps cranking up, but your web/ftp/mail traffic stats don&rsquo;t show an increase.
Need a solution? Enjoy:
First, create an OUTPUT rule for your user, which in this case will be root."><meta name=twitter:site content="@mhayden"><meta itemprop=name content="Measuring raw shell bandwidth"><meta itemprop=description content="Okay, so we know it&rsquo;s easy to measure web, ftp and mail traffic, right? You can just parse the logs, sum it all up, and move on with your day. However, what do you do about users with SFTP or RSYNC privileges? This can create a problem when the bandwidth on your server keeps cranking up, but your web/ftp/mail traffic stats don&rsquo;t show an increase.
Need a solution? Enjoy:
First, create an OUTPUT rule for your user, which in this case will be root."><meta itemprop=datePublished content="2007-02-12T04:20:06+00:00"><meta itemprop=dateModified content="2007-02-12T04:20:06+00:00"><meta itemprop=wordCount content="221"><meta itemprop=image content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta itemprop=keywords content="command line,"><meta name=referrer content="no-referrer-when-downgrade"><style>body{font-family:Verdana,sans-serif;margin:auto;padding:20px;max-width:820px;text-align:left;background-color:#fff;word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:#444}h1,h2,h3,h4,h5,h6,strong,b{color:#222}a{color:#3273dc}.title{text-decoration:none;border:0}.title span{font-weight:400}nav a{margin-right:10px}textarea{width:100%;font-size:16px}input{font-size:16px}content{line-height:1.6}table{width:100%}img{max-width:100%}code{padding:2px 5px;background-color:#f2f2f2}pre code{color:#222;display:block;padding:20px;white-space:pre-wrap;font-size:14px}div.highlight code{background-color:unset;color:initial}blockquote{border-left:1px solid #999;color:#222;padding-left:20px;font-style:italic}footer{padding:25px;text-align:center}.helptext{color:#777;font-size:small}.errorlist{color:#eba613;font-size:small}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:#8b6fcb}@media(prefers-color-scheme:dark){body{background-color:#333;color:#ddd}h1,h2,h3,h4,h5,h6,strong,b{color:#eee}a{color:#8cc2dd}code{background-color:#777}pre code{color:#ddd}blockquote{color:#ccc}textarea,input{background-color:#252525;color:#ddd}.helptext{color:#aaa}}</style></head><body><header><a href=../../../../ class=title><h2>Major Hayden's Blog ðŸ¤ </h2></a><nav><a href=../../../../>Home</a>
<a href=../../../../ham-radio-faq>Ham Radio</a>
<a href=../../../../icanhazip-com-faq>icanhazip FAQ</a>
<a href=../../../../posts>Posts</a></nav><script async src=https://media.ethicalads.io/media/client/ethicalads.min.js></script><div data-ea-publisher=major-io data-ea-type=text></div></header><main><h1>Measuring raw shell bandwidth</h1><i><time datetime=2007-02-12 pubdate>2007-02-12</time></i>
<content><p>Okay, so we know it&rsquo;s easy to measure web, ftp and mail traffic, right? You can just parse the logs, sum it all up, and move on with your day. However, what do you do about users with SFTP or RSYNC privileges? This can create a problem when the bandwidth on your server keeps cranking up, but your web/ftp/mail traffic stats don&rsquo;t show an increase.</p><p>Need a solution? Enjoy:</p><p>First, create an OUTPUT rule for your user, which in this case will be root. Why no INPUT rule? Many hosts don&rsquo;t charge for incoming bandwidth, so why bother?</p><pre><code># iptables -A INPUT -j ACCEPT -m owner --uid-owner=root
</code></pre><p>Now check this out:</p><pre><code># /sbin/iptables -v -xL -Z
Chain OUTPUT (policy ACCEPT 1287 packets, 221983 bytes)
pkts      bytes target     prot opt in     out     source        destination
437    59684 ACCEPT     all  --  any    any     anywhere      anywhere  OWNER UID match root`
</code></pre><p>The number in the &lsquo;bytes&rsquo; column is the count of bytes that this user sent out of your server since the last time you ran that iptables command. If you don&rsquo;t want to zero out the bytes each time you run the command, just drop the Z flag from the iptables command.</p><p>You can go wild with awk if you desire:</p><pre><code># /sbin/iptables -v -xL | grep root | awk '{ print $2 }'
59684
</code></pre></content><p><a href=https://major.io/tags/command-line/>#command line</a></p></main><footer><hr>CC-BY-SA 4.0 &#187;
Made with <a href=https://gohugo.io/>Hugo</a> &#187;
Theme based on <a href=https://github.com/janraasch/hugo-bearblog/>Hugo Ê•â€¢á´¥â€¢Ê” Bear</a><br></footer></body></html>