<!doctype html><html lang=en-us><head><meta http-equiv=x-clacks-overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://major.io/favicon.ico><title>Repairing the qmail queue | Major Hayden's Blog ðŸ¤ </title><meta name=title content="Repairing the qmail queue"><meta name=description content="There&rsquo;s three main things to remember when it comes to the qmail queue:
 1. Don&rsquo;t mess with the qmail queue while qmail is running.
  2. Don&rsquo;t mess with the qmail queue while qmail is stopped.
  3. Don&rsquo;t mess with the qmail queue ever.
 The qmail application keeps a database (sort of) of the pieces of mail it expects to be in the queue (and on the filesystem)."><meta name=keywords content="mail,"><meta property="og:title" content="Repairing the qmail queue"><meta property="og:description" content="There&rsquo;s three main things to remember when it comes to the qmail queue:
 1. Don&rsquo;t mess with the qmail queue while qmail is running.
  2. Don&rsquo;t mess with the qmail queue while qmail is stopped.
  3. Don&rsquo;t mess with the qmail queue ever.
 The qmail application keeps a database (sort of) of the pieces of mail it expects to be in the queue (and on the filesystem)."><meta property="og:type" content="article"><meta property="og:url" content="https://major.io/2007/01/11/rebuilding-the-qmail-queue/"><meta property="og:image" content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2007-01-11T22:37:07+00:00"><meta property="article:modified_time" content="2020-02-12T16:36:14-06:00"><meta property="og:site_name" content="Major Hayden's Blog ðŸ¤ "><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta name=twitter:title content="Repairing the qmail queue"><meta name=twitter:description content="There&rsquo;s three main things to remember when it comes to the qmail queue:
 1. Don&rsquo;t mess with the qmail queue while qmail is running.
  2. Don&rsquo;t mess with the qmail queue while qmail is stopped.
  3. Don&rsquo;t mess with the qmail queue ever.
 The qmail application keeps a database (sort of) of the pieces of mail it expects to be in the queue (and on the filesystem)."><meta name=twitter:site content="@mhayden"><meta itemprop=name content="Repairing the qmail queue"><meta itemprop=description content="There&rsquo;s three main things to remember when it comes to the qmail queue:
 1. Don&rsquo;t mess with the qmail queue while qmail is running.
  2. Don&rsquo;t mess with the qmail queue while qmail is stopped.
  3. Don&rsquo;t mess with the qmail queue ever.
 The qmail application keeps a database (sort of) of the pieces of mail it expects to be in the queue (and on the filesystem)."><meta itemprop=datePublished content="2007-01-11T22:37:07+00:00"><meta itemprop=dateModified content="2020-02-12T16:36:14-06:00"><meta itemprop=wordCount content="280"><meta itemprop=image content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta itemprop=keywords content="mail,"><meta name=referrer content="no-referrer-when-downgrade"><style>body{font-family:Verdana,sans-serif;margin:auto;padding:20px;max-width:820px;text-align:left;background-color:#fff;word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:#444}h1,h2,h3,h4,h5,h6,strong,b{color:#222}a{color:#3273dc}.title{text-decoration:none;border:0}.title span{font-weight:400}nav a{margin-right:10px}textarea{width:100%;font-size:16px}input{font-size:16px}content{line-height:1.6}table{width:100%}img{max-width:100%}code{padding:2px 5px;background-color:#f2f2f2}pre code{color:#222;display:block;padding:20px;white-space:pre-wrap;font-size:14px}div.highlight code{background-color:unset;color:initial}blockquote{border-left:1px solid #999;color:#222;padding-left:20px;font-style:italic}footer{padding:25px;text-align:center}.helptext{color:#777;font-size:small}.errorlist{color:#eba613;font-size:small}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:#8b6fcb}@media(prefers-color-scheme:dark){body{background-color:#333;color:#ddd}h1,h2,h3,h4,h5,h6,strong,b{color:#eee}a{color:#8cc2dd}code{background-color:#777}pre code{color:#ddd}blockquote{color:#ccc}textarea,input{background-color:#252525;color:#ddd}.helptext{color:#aaa}}</style></head><body><header><a href=../../../../ class=title><h2>Major Hayden's Blog ðŸ¤ </h2></a><nav><a href=../../../../>Home</a>
<a href=../../../../ham-radio-faq>Ham Radio</a>
<a href=../../../../icanhazip-com-faq>icanhazip FAQ</a>
<a href=../../../../posts>Posts</a></nav><script async src=https://media.ethicalads.io/media/client/ethicalads.min.js></script><div class="adaptive raised" data-ea-publisher=major-io data-ea-type=text></div></header><main><h1>Repairing the qmail queue</h1><i><time datetime=2007-01-11 pubdate>2007-01-11</time></i>
<content><p>There&rsquo;s three main things to remember when it comes to the qmail queue:</p><blockquote><p><strong>1.</strong> Don&rsquo;t mess with the qmail queue while qmail is running.</p></blockquote><blockquote><p><strong>2.</strong> Don&rsquo;t mess with the qmail queue while qmail is stopped.</p></blockquote><blockquote><p><strong>3.</strong> Don&rsquo;t mess with the qmail queue <strong>ever</strong>.</p></blockquote><p>The qmail application keeps a database (sort of) of the pieces of mail it expects to be in the queue (and on the filesystem). Many python scripts (like mailRemove.py) claim they will speed up your qmail queue by removing failure notices and tidying up the queue files. Most of the time, these scripts work just fine, but sometimes they remove something they shouldn&rsquo;t and then qmail can&rsquo;t find the file.</p><p>What does qmail do when it can&rsquo;t find the file that corresponds to an item in the queue? It stops delivering mail, eats the CPU, and cranks the load average up. Impressive, isn&rsquo;t it?</p><p>Should you find yourself with an impressively hosed qmail queue, do the following (and say goodbye to every e-mail in your queue):</p><pre><code>/etc/init.d/qmail stop
cd /var/qmail/queue
rm -rf info intd local mess remote todo
mkdir mess
for i in `seq 0 22`; do
mkdir mess/$i
done
cp -r mess info
cp -r mess intd
cp -r mess local
cp -r mess remote
cp -r mess todo
chmod -R 750 mess todo
chown -R qmailq:qmail mess todo
chmod -R 700 info intd local remote
chown -R qmailq:qmail intd
chown -R qmails:qmail info local remote
/etc/init.d/qmail start
</code></pre><p><strong>Just in case you missed it,</strong> this will delete <strong>all mail messages</strong> that exist in your queue. But, then again, you&rsquo;re not going to get those messages anyways (thanks qmail!), so repairing the queue is your only option.</p></content><p><a href=https://major.io/tags/mail/>#mail</a></p></main><footer><hr>CC-BY-SA 4.0 &#187;
Made with <a href=https://gohugo.io/>Hugo</a> &#187;
Theme based on <a href=https://github.com/janraasch/hugo-bearblog/>Hugo Ê•â€¢á´¥â€¢Ê” Bear</a> &#187;
<a href=https://github.com/major/major.io/commit/84372fb2198913a5e498b8d32ffc77fb813f0a48>84372fb2</a></footer></body></html>