<!doctype html><html lang=en-us><head><meta http-equiv=x-clacks-overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://major.io/favicon.ico><title>Time Warner Road Runner, Linux, and large IPv6 subnets | Major Hayden's Blog ðŸ¤ </title><meta name=title content="Time Warner Road Runner, Linux, and large IPv6 subnets"><meta name=description content="Although Time Warner Cable is now Spectrum and wide-dhcpv6 is quite old, this post is still what I&rsquo;m using today (in 2019)!
 I&rsquo;ve written about how to get larger IPv6 subnets from Time Warner Cable&rsquo;s Road Runner service on a Mikrotik router before, but I&rsquo;ve converted to using a Linux server as my router for my home. Getting the larger /56 IPv6 subnet is a little tricky and it&rsquo;s not terribly well documented."><meta name=keywords content="fedora,firewall,ipv6,router,security,"><meta property="og:title" content="Time Warner Road Runner, Linux, and large IPv6 subnets"><meta property="og:description" content="Although Time Warner Cable is now Spectrum and wide-dhcpv6 is quite old, this post is still what I&rsquo;m using today (in 2019)!
 I&rsquo;ve written about how to get larger IPv6 subnets from Time Warner Cable&rsquo;s Road Runner service on a Mikrotik router before, but I&rsquo;ve converted to using a Linux server as my router for my home. Getting the larger /56 IPv6 subnet is a little tricky and it&rsquo;s not terribly well documented."><meta property="og:type" content="article"><meta property="og:url" content="https://major.io/2015/09/11/time-warner-road-runner-linux-and-large-ipv6-subnets/"><meta property="og:image" content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2015-09-11T21:08:44+00:00"><meta property="article:modified_time" content="2015-09-11T21:08:44+00:00"><meta property="og:site_name" content="Major Hayden's Blog ðŸ¤ "><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta name=twitter:title content="Time Warner Road Runner, Linux, and large IPv6 subnets"><meta name=twitter:description content="Although Time Warner Cable is now Spectrum and wide-dhcpv6 is quite old, this post is still what I&rsquo;m using today (in 2019)!
 I&rsquo;ve written about how to get larger IPv6 subnets from Time Warner Cable&rsquo;s Road Runner service on a Mikrotik router before, but I&rsquo;ve converted to using a Linux server as my router for my home. Getting the larger /56 IPv6 subnet is a little tricky and it&rsquo;s not terribly well documented."><meta name=twitter:site content="@mhayden"><meta itemprop=name content="Time Warner Road Runner, Linux, and large IPv6 subnets"><meta itemprop=description content="Although Time Warner Cable is now Spectrum and wide-dhcpv6 is quite old, this post is still what I&rsquo;m using today (in 2019)!
 I&rsquo;ve written about how to get larger IPv6 subnets from Time Warner Cable&rsquo;s Road Runner service on a Mikrotik router before, but I&rsquo;ve converted to using a Linux server as my router for my home. Getting the larger /56 IPv6 subnet is a little tricky and it&rsquo;s not terribly well documented."><meta itemprop=datePublished content="2015-09-11T21:08:44+00:00"><meta itemprop=dateModified content="2015-09-11T21:08:44+00:00"><meta itemprop=wordCount content="802"><meta itemprop=image content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta itemprop=keywords content="fedora,firewall,ipv6,router,security,"><meta name=referrer content="no-referrer-when-downgrade"><style>body{font-family:Verdana,sans-serif;margin:auto;padding:20px;max-width:820px;text-align:left;background-color:#fff;word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:#444}h1,h2,h3,h4,h5,h6,strong,b{color:#222}a{color:#3273dc}.title{text-decoration:none;border:0}.title span{font-weight:400}nav a{margin-right:10px}textarea{width:100%;font-size:16px}input{font-size:16px}content{line-height:1.6}table{width:100%}img{max-width:100%}code{padding:2px 5px;background-color:#f2f2f2}pre code{color:#222;display:block;padding:20px;white-space:pre-wrap;font-size:14px}div.highlight code{background-color:unset;color:initial}blockquote{border-left:1px solid #999;color:#222;padding-left:20px;font-style:italic}footer{padding:25px;text-align:center}.helptext{color:#777;font-size:small}.errorlist{color:#eba613;font-size:small}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:#8b6fcb}@media(prefers-color-scheme:dark){body{background-color:#333;color:#ddd}h1,h2,h3,h4,h5,h6,strong,b{color:#eee}a{color:#8cc2dd}code{background-color:#777}pre code{color:#ddd}blockquote{color:#ccc}textarea,input{background-color:#252525;color:#ddd}.helptext{color:#aaa}}</style></head><body><header><a href=../../../../ class=title><h2>Major Hayden's Blog ðŸ¤ </h2></a><nav><a href=../../../../>Home</a>
<a href=../../../../ham-radio-faq>Ham Radio</a>
<a href=../../../../icanhazip-com-faq>icanhazip FAQ</a>
<a href=../../../../posts>Posts</a></nav></header><main><h1>Time Warner Road Runner, Linux, and large IPv6 subnets</h1><i><time datetime=2015-09-11 pubdate>2015-09-11</time></i>
<content><blockquote><p>Although Time Warner Cable is now Spectrum and wide-dhcpv6 is quite
old, this post is still what I&rsquo;m using today (in 2019)!</p></blockquote><p>I&rsquo;ve written about how to <a href=../../../../2014/09/11/howto-time-warner-cable-ipv6/>get larger IPv6 subnets from Time Warner Cable&rsquo;s Road Runner service</a> on a Mikrotik router before, but I&rsquo;ve converted to using a Linux server as my router for my home. Getting the larger /56 IPv6 subnet is a little tricky and it&rsquo;s not terribly well documented.</p><h2 id=my-network>My network</h2><p>My Linux router has two bridges, <em>br0</em> and <em>br1</em>, that handle WAN and LAN traffic respectively. This is a fairly simple configuration.</p><pre><code>                +-------------------+
                |                   |
+-----------+   |                   |     +----------+
|Cable modem+---+ br0          br1  +-----+LAN switch|
+-----------+   |                   |     +----------+
                |    Linux router   |
                +-------------------+
</code></pre><p>Ideally, I&rsquo;d like to have a single address assigned to <em>br0</em> so that my Linux router can reach IPv6 destinations. I&rsquo;d also like a /64 assigned to the <em>br1</em> interface so that I can distribute addresses from that subnet to devices on my LAN.</p><h2 id=getting-dhcpv6-working>Getting DHCPv6 working</h2><p>The <a href=http://sourceforge.net/projects/wide-dhcpv6/>wide-dhcpv6</a> package provides a DHCPv6 client and also takes care of assigning some addresses for you. Installing it is easy with dnf:</p><pre><code>dnf install wide-dhcpv6
</code></pre><p>We will create a new configuration file at <code>/etc/wide-dhcpv6/dhcp6c.conf</code>:</p><pre><code>interface br0 {
 send ia-pd 1;
 send ia-na 1;
};

id-assoc na 1 {
};

id-assoc pd 1 {
 prefix ::/56 infinity;
 prefix-interface br0 {
  sla-id 1;
  sla-len 8;
 };
 prefix-interface br1 {
  sla-id 2;
  sla-len 8;
 };
 prefix-interface vlan1 {
  sla-id 3;
  sla-len 8;
 };
};
</code></pre><p>If this configuration file makes sense to you without explanation, I&rsquo;m impressed. Let&rsquo;s break it up into pieces to understand it.</p><p>The first section with <em>interface br0</em> specifies that we want to do our DHCPv6 requests on the <em>br0</em> interface. The configuration lines inside the curly braces says we want to specify a <a href=https://en.wikipedia.org/wiki/Prefix_delegation>prefix delegation</a> (the <em>IA_PD</em> DHCPv6 option) and we also want a stateful (SLAAC) address assigned on <em>br0</em> (the <em>IA_NA</em> DHCPv6 option). These are just simple flags that tell the upstream DHCPv6 server that we want to specify a particular prefix size and that we also want a single address (via SLAAC) for our external interface.</p><p>The <em>id-assoc na 1</em> section specifies that we want to accept the default SLAAC address provided by the upstream network device.</p><p>The <em>id-assoc pd 1</em> section gives the upstream DHCPv6 server a hint that we really want a /56 block of IPv6 addresses. The next three sections give our DHCPv6 client an idea of how we want addresses configured on our internal network devices. The three interfaces in each <em>prefix-interface</em> section will receive a different block (noted by the <em>sla-id</em> increasing by one each time). Also, the block size we intend to assign is a /64 (<em>sla-len</em> is 8, which means we knock 8 bits off a /56 and end up with a /64). Don&rsquo;t change your <em>sla-id</em> after you set it. That will cause the DHCPv6 client to move your /64 address blocks around to a different interface.</p><p>Still with me? This stuff is really confusing and documentation is sparse.</p><p>Start the DHCPv6 client and ensure it comes up at boot:</p><pre><code>systemctl enable dhcp6c
systemctl start dhcp6c
</code></pre><p>Run <code>ip addr</code> and look for IPv6 blocks configured on each interface. In my case, <em>br0</em> got a single address, and the other interfaces received unique /64&rsquo;s.</p><h2 id=telling-the-lan-about-ipv6>Telling the LAN about IPv6</h2><p>The router is working now, but we need to tell our devices on the LAN that we have some IPv6 addresses available. You have different options for this, such as dnsmasq or radvd, but we will use radvd here:</p><pre><code>dnf -y install radvd
</code></pre><p>If you open <code>/etc/radvd.conf</code>, you&rsquo;ll notice a helpful comment block at the top with a great example configuration. I only want to announce IPv6 on my <em>br1</em> interface, so I&rsquo;ll add this configuration block:</p><pre><code>interface br1
{
  AdvSendAdvert on;
  MaxRtrAdvInterval 30;

  prefix ::/64
  {
    AdvOnLink on;
    AdvAutonomous on;
    AdvRouterAddr off;
  };
};
</code></pre><p>You don&rsquo;t actually need to specify the IPv6 prefix since radvd is smart enough to examine your interface and discover the IPv6 subnet assigned to it. This configuration says we will send router advertisements, let systems on the network choose their own addresses, and we will advertise those addresses as soon as the link comes up.</p><p>Let&rsquo;s start radvd and ensure it comes up at boot:</p><pre><code>systemctl enable radvd
systemctl start radvd
</code></pre><p>Connect a machine to your LAN and you should receive an IPv6 address shortly after the link comes up!</p><h2 id=troubleshooting>Troubleshooting</h2><p>If you&rsquo;re having trouble getting an IPv6 address, double-check your iptables rules. You will need to ensure you&rsquo;re allowing UDP 546 into your external interface. Here are some examples you can use:</p><pre><code># If you're using firewalld
firewall-cmd --add-port=546/udp
firewall-cmd --add-port=546/udp --permanent
# If you're using bare ip6tables
ip6tables -A INPUT -p udp -m udp --dport 546 -j ACCEPT
</code></pre></content><p><a href=https://major.io/tags/fedora/>#fedora</a>
<a href=https://major.io/tags/firewall/>#firewall</a>
<a href=https://major.io/tags/ipv6/>#ipv6</a>
<a href=https://major.io/tags/router/>#router</a>
<a href=https://major.io/tags/security/>#security</a></p></main><footer><script async src=https://media.ethicalads.io/media/client/ethicalads.min.js></script><div data-ea-publisher=major-io data-ea-type=text></div><hr>CC-BY-SA 4.0 &#187;
Made with <a href=https://gohugo.io/>Hugo</a> &#187;
Theme based on <a href=https://github.com/janraasch/hugo-bearblog/>Hugo Ê•â€¢á´¥â€¢Ê” Bear</a><br></footer></body></html>