<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="Major Hayden"><meta name=description content="Although Time Warner Cable is now Spectrum and wide-dhcpv6 is quite old, this post is still what I&amp;rsquo;m using today (in 2019)!
 I&amp;rsquo;ve written about how to get larger IPv6 subnets from Time Warner Cable&amp;rsquo;s Road Runner service on a Mikrotik router before, but I&amp;rsquo;ve converted to using a Linux server as my router for my home. Getting the larger /56 IPv6 subnet is a little tricky and it&amp;rsquo;s not terribly well documented."><meta name=keywords content=",fedora,firewall,ipv6,router,security"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://major.io/2015/09/11/time-warner-road-runner-linux-and-large-ipv6-subnets/><title>Time Warner Road Runner, Linux, and large IPv6 subnets :: Major Hayden ðŸ¤  â€” Words of wisdom from a social nerd</title><link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css rel=stylesheet type=text/css><link rel=stylesheet href=../../../../main.89fa80e2143f71bd5c96a7c94e531dec3276a367e22f87e74a76026ab64680bf.css><link rel=apple-touch-icon sizes=180x180 href=../../../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../../../favicon-16x16.png><link rel=manifest href=../../../../site.webmanifest><link rel=mask-icon href=../../../../safari-pinned-tab.svg color=#252627><link rel="shortcut icon" href=../../../../favicon.ico><meta name=msapplication-TileColor content="#252627"><meta name=theme-color content="#252627"><meta itemprop=name content="Time Warner Road Runner, Linux, and large IPv6 subnets"><meta itemprop=description content="Although Time Warner Cable is now Spectrum and wide-dhcpv6 is quite old, this post is still what I&rsquo;m using today (in 2019)!
 I&rsquo;ve written about how to get larger IPv6 subnets from Time Warner Cable&rsquo;s Road Runner service on a Mikrotik router before, but I&rsquo;ve converted to using a Linux server as my router for my home. Getting the larger /56 IPv6 subnet is a little tricky and it&rsquo;s not terribly well documented."><meta itemprop=datePublished content="2015-09-11T21:08:44+00:00"><meta itemprop=dateModified content="2015-09-11T21:08:44+00:00"><meta itemprop=wordCount content="802"><meta itemprop=image content="https://major.io"><meta itemprop=keywords content="fedora,firewall,ipv6,router,security,"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://major.io"><meta name=twitter:title content="Time Warner Road Runner, Linux, and large IPv6 subnets"><meta name=twitter:description content="Although Time Warner Cable is now Spectrum and wide-dhcpv6 is quite old, this post is still what I&rsquo;m using today (in 2019)!
 I&rsquo;ve written about how to get larger IPv6 subnets from Time Warner Cable&rsquo;s Road Runner service on a Mikrotik router before, but I&rsquo;ve converted to using a Linux server as my router for my home. Getting the larger /56 IPv6 subnet is a little tricky and it&rsquo;s not terribly well documented."><meta name=twitter:site content="@mhayden"><meta property="article:section" content="Blog Posts"><meta property="article:published_time" content="2015-09-11 21:08:44 +0000 UTC"><style type=text/css>html{letter-spacing:unset}</style></head><body><div class=container><header class=header><span class=header__inner><a href=../../../../ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>$ echo major.io</span>
<span class=logo__cursor style=visibility:hidden></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=../../../../ham-radio-faq>hamradio</a></li><li><a href=../../../../icanhazip-com-faq>icanhazip</a></li><li><a href=../../../../posts/>posts</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href=https://major.io/2015/09/11/time-warner-road-runner-linux-and-large-ipv6-subnets/>Time Warner Road Runner, Linux, and large IPv6 subnets</a></h2><div class=post-content><blockquote><p>Although Time Warner Cable is now Spectrum and wide-dhcpv6 is quite
old, this post is still what I&rsquo;m using today (in 2019)!</p></blockquote><p>I&rsquo;ve written about how to <a href=../../../../2014/09/11/howto-time-warner-cable-ipv6/>get larger IPv6 subnets from Time Warner Cable&rsquo;s Road Runner service</a> on a Mikrotik router before, but I&rsquo;ve converted to using a Linux server as my router for my home. Getting the larger /56 IPv6 subnet is a little tricky and it&rsquo;s not terribly well documented.</p><h2 id=my-network>My network</h2><p>My Linux router has two bridges, <em>br0</em> and <em>br1</em>, that handle WAN and LAN traffic respectively. This is a fairly simple configuration.</p><pre><code>                +-------------------+
                |                   |
+-----------+   |                   |     +----------+
|Cable modem+---+ br0          br1  +-----+LAN switch|
+-----------+   |                   |     +----------+
                |    Linux router   |
                +-------------------+
</code></pre><p>Ideally, I&rsquo;d like to have a single address assigned to <em>br0</em> so that my Linux router can reach IPv6 destinations. I&rsquo;d also like a /64 assigned to the <em>br1</em> interface so that I can distribute addresses from that subnet to devices on my LAN.</p><h2 id=getting-dhcpv6-working>Getting DHCPv6 working</h2><p>The <a href=http://sourceforge.net/projects/wide-dhcpv6/>wide-dhcpv6</a> package provides a DHCPv6 client and also takes care of assigning some addresses for you. Installing it is easy with dnf:</p><pre><code>dnf install wide-dhcpv6
</code></pre><p>We will create a new configuration file at <code>/etc/wide-dhcpv6/dhcp6c.conf</code>:</p><pre><code>interface br0 {
 send ia-pd 1;
 send ia-na 1;
};

id-assoc na 1 {
};

id-assoc pd 1 {
 prefix ::/56 infinity;
 prefix-interface br0 {
  sla-id 1;
  sla-len 8;
 };
 prefix-interface br1 {
  sla-id 2;
  sla-len 8;
 };
 prefix-interface vlan1 {
  sla-id 3;
  sla-len 8;
 };
};
</code></pre><p>If this configuration file makes sense to you without explanation, I&rsquo;m impressed. Let&rsquo;s break it up into pieces to understand it.</p><p>The first section with <em>interface br0</em> specifies that we want to do our DHCPv6 requests on the <em>br0</em> interface. The configuration lines inside the curly braces says we want to specify a <a href=https://en.wikipedia.org/wiki/Prefix_delegation>prefix delegation</a> (the <em>IA_PD</em> DHCPv6 option) and we also want a stateful (SLAAC) address assigned on <em>br0</em> (the <em>IA_NA</em> DHCPv6 option). These are just simple flags that tell the upstream DHCPv6 server that we want to specify a particular prefix size and that we also want a single address (via SLAAC) for our external interface.</p><p>The <em>id-assoc na 1</em> section specifies that we want to accept the default SLAAC address provided by the upstream network device.</p><p>The <em>id-assoc pd 1</em> section gives the upstream DHCPv6 server a hint that we really want a /56 block of IPv6 addresses. The next three sections give our DHCPv6 client an idea of how we want addresses configured on our internal network devices. The three interfaces in each <em>prefix-interface</em> section will receive a different block (noted by the <em>sla-id</em> increasing by one each time). Also, the block size we intend to assign is a /64 (<em>sla-len</em> is 8, which means we knock 8 bits off a /56 and end up with a /64). Don&rsquo;t change your <em>sla-id</em> after you set it. That will cause the DHCPv6 client to move your /64 address blocks around to a different interface.</p><p>Still with me? This stuff is really confusing and documentation is sparse.</p><p>Start the DHCPv6 client and ensure it comes up at boot:</p><pre><code>systemctl enable dhcp6c
systemctl start dhcp6c
</code></pre><p>Run <code>ip addr</code> and look for IPv6 blocks configured on each interface. In my case, <em>br0</em> got a single address, and the other interfaces received unique /64&rsquo;s.</p><h2 id=telling-the-lan-about-ipv6>Telling the LAN about IPv6</h2><p>The router is working now, but we need to tell our devices on the LAN that we have some IPv6 addresses available. You have different options for this, such as dnsmasq or radvd, but we will use radvd here:</p><pre><code>dnf -y install radvd
</code></pre><p>If you open <code>/etc/radvd.conf</code>, you&rsquo;ll notice a helpful comment block at the top with a great example configuration. I only want to announce IPv6 on my <em>br1</em> interface, so I&rsquo;ll add this configuration block:</p><pre><code>interface br1
{
  AdvSendAdvert on;
  MaxRtrAdvInterval 30;

  prefix ::/64
  {
    AdvOnLink on;
    AdvAutonomous on;
    AdvRouterAddr off;
  };
};
</code></pre><p>You don&rsquo;t actually need to specify the IPv6 prefix since radvd is smart enough to examine your interface and discover the IPv6 subnet assigned to it. This configuration says we will send router advertisements, let systems on the network choose their own addresses, and we will advertise those addresses as soon as the link comes up.</p><p>Let&rsquo;s start radvd and ensure it comes up at boot:</p><pre><code>systemctl enable radvd
systemctl start radvd
</code></pre><p>Connect a machine to your LAN and you should receive an IPv6 address shortly after the link comes up!</p><h2 id=troubleshooting>Troubleshooting</h2><p>If you&rsquo;re having trouble getting an IPv6 address, double-check your iptables rules. You will need to ensure you&rsquo;re allowing UDP 546 into your external interface. Here are some examples you can use:</p><pre><code># If you're using firewalld
firewall-cmd --add-port=546/udp
firewall-cmd --add-port=546/udp --permanent
# If you're using bare ip6tables
ip6tables -A INPUT -p udp -m udp --dport 546 -j ACCEPT
</code></pre></div></article><hr><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://major.io/tags/fedora/>fedora</a></span>
<span class=tag><a href=https://major.io/tags/firewall/>firewall</a></span>
<span class=tag><a href=https://major.io/tags/ipv6/>ipv6</a></span>
<span class=tag><a href=https://major.io/tags/router/>router</a></span>
<span class=tag><a href=https://major.io/tags/security/>security</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-folder meta-icon"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg><span class=tag><a href=https://major.io/categories/blog-posts/>Blog Posts</a></span></p></div></main></div><footer class=footer><div class=footer__inner><div class=footer__content><span>&copy; 2021</span>
<span><a href=https://major.io>Major Hayden</a></span>
<span><a href=https://creativecommons.org/licenses/by-sa/2.0/ target=_blank rel=noopener>CC BY-SA 2.0</a></span><span><a href=https://major.io/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></span></div></div><div class=footer__inner><div class=footer__content><span>Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>Made with &#10084; by <a href=https://github.com/rhazdon>Djordje Atlialp</a></span></div></div></footer></div><script type=text/javascript src=../../../../bundle.min.e9f93b80e78a22e6f04cbb5f73e0f9c4ba60ff73a2a0ef85965c688f93dd1f2722a282e30e485603e4c65b1b346720e35f213435ec5556e196a97a68d097c80f.js integrity="sha512-6fk7gOeKIubwTLtfc+D5xLpg/3OioO+Fllxoj5PdHyciooLjDkhWA+TGWxs0ZyDjXyE0NexVVuGWqXpo0JfIDw=="></script></body></html>