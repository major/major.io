<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="Major Hayden"><meta name=description content="NOTE: This works in Fedora 21, but not in Fedora 22. Review this post for the fixes.
GNOME 3 has improved by leaps and bounds since its original release and it&amp;rsquo;s my daily driver window manager on my Linux laptop. Even with all of these improvements, there&amp;rsquo;s still no built-in way to rotate wallpaper (that I&amp;rsquo;ve found).
There are some extensions, like BackSlide, that enable background rotation on a time interval."><meta name=keywords content=",bash,fedora,gnome,script,systemd"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://major.io/2015/02/11/rotate-gnome-3s-wallpaper-systemd-user-units-timers/><title>Rotate GNOME 3â€™s wallpaper with systemd user units and timers :: Major Hayden ðŸ¤  â€” Words of wisdom from a social nerd</title><link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css rel=stylesheet type=text/css><link rel=stylesheet href=../../../../main.89fa80e2143f71bd5c96a7c94e531dec3276a367e22f87e74a76026ab64680bf.css><link rel=apple-touch-icon sizes=180x180 href=../../../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../../../favicon-16x16.png><link rel=manifest href=../../../../site.webmanifest><link rel=mask-icon href=../../../../safari-pinned-tab.svg color=#252627><link rel="shortcut icon" href=../../../../favicon.ico><meta name=msapplication-TileColor content="#252627"><meta name=theme-color content="#252627"><meta itemprop=name content="Rotate GNOME 3â€™s wallpaper with systemd user units and timers"><meta itemprop=description content="NOTE: This works in Fedora 21, but not in Fedora 22. Review this post for the fixes.
GNOME 3 has improved by leaps and bounds since its original release and it&rsquo;s my daily driver window manager on my Linux laptop. Even with all of these improvements, there&rsquo;s still no built-in way to rotate wallpaper (that I&rsquo;ve found).
There are some extensions, like BackSlide, that enable background rotation on a time interval."><meta itemprop=datePublished content="2015-02-11T14:23:03+00:00"><meta itemprop=dateModified content="2015-02-11T14:23:03+00:00"><meta itemprop=wordCount content="645"><meta itemprop=image content="https://major.io"><meta itemprop=keywords content="bash,fedora,gnome,script,systemd,"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://major.io"><meta name=twitter:title content="Rotate GNOME 3â€™s wallpaper with systemd user units and timers"><meta name=twitter:description content="NOTE: This works in Fedora 21, but not in Fedora 22. Review this post for the fixes.
GNOME 3 has improved by leaps and bounds since its original release and it&rsquo;s my daily driver window manager on my Linux laptop. Even with all of these improvements, there&rsquo;s still no built-in way to rotate wallpaper (that I&rsquo;ve found).
There are some extensions, like BackSlide, that enable background rotation on a time interval."><meta name=twitter:site content="@mhayden"><meta property="article:section" content="Blog Posts"><meta property="article:published_time" content="2015-02-11 14:23:03 +0000 UTC"><style type=text/css>html{letter-spacing:unset}</style></head><body><div class=container><header class=header><span class=header__inner><a href=../../../../ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>$ echo major.io</span>
<span class=logo__cursor style=visibility:hidden></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=../../../../ham-radio-faq>hamradio</a></li><li><a href=../../../../icanhazip-com-faq>icanhazip</a></li><li><a href=../../../../posts/>posts</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href=https://major.io/2015/02/11/rotate-gnome-3s-wallpaper-systemd-user-units-timers/>Rotate GNOME 3â€™s wallpaper with systemd user units and timers</a></h2><div class=post-content><p><em>NOTE: This works in Fedora 21, but not in Fedora 22. Review <a href=../../../../2015/06/23/fedora-22-and-rotating-gnome-wallpaper-with-systemd-timers/>this post</a> for the fixes.</em></p><p><a href=http://www.gnome.org/gnome-3/>GNOME 3</a> has improved by leaps and bounds since its original release and it&rsquo;s my daily driver window manager on my Linux laptop. Even with all of these improvements, there&rsquo;s still no built-in way to rotate wallpaper (that I&rsquo;ve found).</p><p>There are some extensions, like <a href=https://extensions.gnome.org/extension/543/backslide/>BackSlide</a>, that enable background rotation on a time interval. Fedora 21 uses GNOME 3.14 and the current BackSlide version is incompatible. BackSlide&rsquo;s interface is fairly useful but I wanted something different.</p><p>One of systemd&rsquo;s handy features is the ability to set up <a href=http://www.freedesktop.org/wiki/Software/systemd/>systemd</a> unit files on a per-user basis. Every user can create unit files in their home directory and tell systemd to begin using those.</p><h3 id=getting-started>Getting started</h3><p>We first need a script that can rotate the background based on files in a particular directory. All of my wallpaper images are in <code>~/Pictures/wallpapers</code>. I adjusted this script that I found on GitHub so that it searches through files in my wallpaper directory and picks one at random to use:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#719e07>#!/bin/bash
</span><span style=color:#719e07></span>
<span style=color:#268bd2>walls_dir</span><span style=color:#719e07>=</span><span style=color:#268bd2>$HOME</span>/Pictures/Wallpapers
<span style=color:#268bd2>selection</span><span style=color:#719e07>=</span><span style=color:#719e07>$(</span>find <span style=color:#268bd2>$walls_dir</span> -type f -name <span style=color:#2aa198>&#34;*.jpg&#34;</span> -o -name <span style=color:#2aa198>&#34;*.png&#34;</span> | shuf -n1<span style=color:#719e07>)</span>
gsettings <span style=color:#b58900>set</span> org.gnome.desktop.background picture-uri <span style=color:#2aa198>&#34;file://</span><span style=color:#268bd2>$selection</span><span style=color:#2aa198>&#34;</span>
</code></pre></div><p>I tossed this script into <code>~/bin/rotate_bg.sh</code> and made it executable with <code>chmod +x ~/bin/rotate_bg.sh</code>. Before you go any further, run the script manually in a terminal to verify that your background rotates to another image.</p><h3 id=preparing-the-systemd-service-unit-file>Preparing the systemd service unit file</h3><p>You&rsquo;ll need to create a user-level systemd service file directory if it doesn&rsquo;t exist already:</p><pre><code>mkdir ~/.config/systemd/user/
</code></pre><p>Drop this file into <code>~/.config/systemd/user/gnome-background-change.service</code>:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=color:#719e07>[Unit]</span>
Description<span style=color:#719e07>=</span><span style=color:#2aa198>Rotate GNOME background</span>

<span style=color:#719e07>[Service]</span>
Type<span style=color:#719e07>=</span><span style=color:#2aa198>oneshot</span>
Environment<span style=color:#719e07>=</span><span style=color:#2aa198>DISPLAY=:0</span>
ExecStart<span style=color:#719e07>=</span><span style=color:#2aa198>/usr/bin/bash /home/[USERNAME]/bin/rotate_bg.sh</span>

<span style=color:#719e07>[Install]</span>
WantedBy<span style=color:#719e07>=</span><span style=color:#2aa198>basic.target</span>
</code></pre></div><p>This unit file tells systemd that we have a oneshot script that will exit when it&rsquo;s finished. In addition, we also give the environment details to systemd so that it&rsquo;s aware of our existing X session.</p><p>Don&rsquo;t enable or start the service file yet. We will let our timer handle that part.</p><h3 id=setting-a-timer>Setting a timer</h3><p>Systemd&rsquo;s concept of <a href=http://www.freedesktop.org/software/systemd/man/systemd.timer.html>timers</a> is pretty detailed. You have plenty of control over how and when you want a particular service to run. We need a simple calendar-based timer (much like cron) that will start up our service from the previous step.</p><p>Drop this into <code>~/.config/systemd/user/gnome-background-change.timer</code>:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=color:#719e07>[Unit]</span>
Description<span style=color:#719e07>=</span><span style=color:#2aa198>Rotate GNOME wallpaper timer</span>

<span style=color:#719e07>[Timer]</span>
OnCalendar<span style=color:#719e07>=</span><span style=color:#2aa198>*:0/5</span>
Persistent<span style=color:#719e07>=</span><span style=color:#2aa198>true</span>
Unit<span style=color:#719e07>=</span><span style=color:#2aa198>gnome-background-change.service</span>

<span style=color:#719e07>[Install]</span>
WantedBy<span style=color:#719e07>=</span><span style=color:#2aa198>gnome-background-change.service</span>
</code></pre></div><p>We&rsquo;re telling systemd that we want this timer to run every five minutes and we want to start our service unit file from the previous step. The <code>Persistent</code> line tells systemd that we want this unit file run if the last run was missed. For example, if you log in at 7:02AM, we don&rsquo;t want to wait until 7:05AM to rotate the background. We can rotate it immediately after login.</p><p>If you&rsquo;d like a different interval, be sure to review systemd&rsquo;s <a href=http://www.freedesktop.org/software/systemd/man/systemd.time.html>time syntax</a> for the <code>OnCalendar</code> line. It&rsquo;s a little quirky if you&rsquo;re used to working with crontabs but it&rsquo;s very powerful once you understand it.</p><p>Now we can enable and start the timer:</p><pre><code>systemctl --user enable gnome-background-change.timer
systemctl --user start gnome-background-change.timer
</code></pre><h3 id=checking-our-work>Checking our work</h3><p>You can use systemctl to query the timer we just activated:</p><pre><code>$ systemctl --user list-timers
NEXT                         LEFT          LAST                         PASSED  UNIT                          ACTIVATES
Wed 2015-02-11 08:15:00 CST  3min 53s left Wed 2015-02-11 08:10:49 CST  16s ago gnome-background-change.timer gnome-background-change.service
</code></pre><p>In my case, this shows that the background rotation service last ran 16 seconds ago. It will run again in just under four minutes. If you find that the service runs but your wallpaper doesn&rsquo;t change, try running <code>journalctl -xe</code> to see if your service is throwing any errors.</p><h3 id=additional-reading>Additional reading</h3><p>This is just the tip of the iceberg of what systemd can do with user unit files and timers. the Arch Linux wiki has some awesome documentation about <a href=https://wiki.archlinux.org/index.php/Systemd/User>user unit files</a> and <a href=https://wiki.archlinux.org/index.php/Systemd/Timers>timers</a>. Check out the other timers that already exist on your system for more ideas.</p></div></article><hr><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://major.io/tags/bash/>bash</a></span>
<span class=tag><a href=https://major.io/tags/fedora/>fedora</a></span>
<span class=tag><a href=https://major.io/tags/gnome/>gnome</a></span>
<span class=tag><a href=https://major.io/tags/script/>script</a></span>
<span class=tag><a href=https://major.io/tags/systemd/>systemd</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-folder meta-icon"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg><span class=tag><a href=https://major.io/categories/blog-posts/>Blog Posts</a></span></p></div></main></div><footer class=footer><div class=footer__inner><div class=footer__content><span>&copy; 2021</span>
<span><a href=https://major.io>Major Hayden</a></span>
<span><a href=https://creativecommons.org/licenses/by-sa/2.0/ target=_blank rel=noopener>CC BY-SA 2.0</a></span><span><a href=https://major.io/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></span></div></div><div class=footer__inner><div class=footer__content><span>Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>Made with &#10084; by <a href=https://github.com/rhazdon>Djordje Atlialp</a></span></div></div></footer></div><script type=text/javascript src=../../../../bundle.min.e9f93b80e78a22e6f04cbb5f73e0f9c4ba60ff73a2a0ef85965c688f93dd1f2722a282e30e485603e4c65b1b346720e35f213435ec5556e196a97a68d097c80f.js integrity="sha512-6fk7gOeKIubwTLtfc+D5xLpg/3OioO+Fllxoj5PdHyciooLjDkhWA+TGWxs0ZyDjXyE0NexVVuGWqXpo0JfIDw=="></script></body></html>