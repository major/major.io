<!doctype html><html lang=en-us><head><meta http-equiv=x-clacks-overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://major.io/favicon.ico><title>Rotate GNOME 3â€™s wallpaper with systemd user units and timers | Major Hayden's Blog ðŸ¤ </title><meta name=title content="Rotate GNOME 3â€™s wallpaper with systemd user units and timers"><meta name=description content="NOTE: This works in Fedora 21, but not in Fedora 22. Review this post for the fixes.
GNOME 3 has improved by leaps and bounds since its original release and it&rsquo;s my daily driver window manager on my Linux laptop. Even with all of these improvements, there&rsquo;s still no built-in way to rotate wallpaper (that I&rsquo;ve found).
There are some extensions, like BackSlide, that enable background rotation on a time interval."><meta name=keywords content="bash,fedora,gnome,script,systemd,"><meta property="og:title" content="Rotate GNOME 3â€™s wallpaper with systemd user units and timers"><meta property="og:description" content="NOTE: This works in Fedora 21, but not in Fedora 22. Review this post for the fixes.
GNOME 3 has improved by leaps and bounds since its original release and it&rsquo;s my daily driver window manager on my Linux laptop. Even with all of these improvements, there&rsquo;s still no built-in way to rotate wallpaper (that I&rsquo;ve found).
There are some extensions, like BackSlide, that enable background rotation on a time interval."><meta property="og:type" content="article"><meta property="og:url" content="https://major.io/2015/02/11/rotate-gnome-3s-wallpaper-systemd-user-units-timers/"><meta property="og:image" content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2015-02-11T14:23:03+00:00"><meta property="article:modified_time" content="2020-02-12T16:36:14-06:00"><meta property="og:site_name" content="Major Hayden's Blog ðŸ¤ "><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta name=twitter:title content="Rotate GNOME 3â€™s wallpaper with systemd user units and timers"><meta name=twitter:description content="NOTE: This works in Fedora 21, but not in Fedora 22. Review this post for the fixes.
GNOME 3 has improved by leaps and bounds since its original release and it&rsquo;s my daily driver window manager on my Linux laptop. Even with all of these improvements, there&rsquo;s still no built-in way to rotate wallpaper (that I&rsquo;ve found).
There are some extensions, like BackSlide, that enable background rotation on a time interval."><meta name=twitter:site content="@mhayden"><meta itemprop=name content="Rotate GNOME 3â€™s wallpaper with systemd user units and timers"><meta itemprop=description content="NOTE: This works in Fedora 21, but not in Fedora 22. Review this post for the fixes.
GNOME 3 has improved by leaps and bounds since its original release and it&rsquo;s my daily driver window manager on my Linux laptop. Even with all of these improvements, there&rsquo;s still no built-in way to rotate wallpaper (that I&rsquo;ve found).
There are some extensions, like BackSlide, that enable background rotation on a time interval."><meta itemprop=datePublished content="2015-02-11T14:23:03+00:00"><meta itemprop=dateModified content="2020-02-12T16:36:14-06:00"><meta itemprop=wordCount content="645"><meta itemprop=image content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta itemprop=keywords content="bash,fedora,gnome,script,systemd,"><meta name=referrer content="no-referrer-when-downgrade"><style>body{font-family:Verdana,sans-serif;margin:auto;padding:20px;max-width:820px;text-align:left;background-color:#fff;word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:#444}h1,h2,h3,h4,h5,h6,strong,b{color:#222}a{color:#3273dc}.title{text-decoration:none;border:0}.title span{font-weight:400}nav a{margin-right:10px}textarea{width:100%;font-size:16px}input{font-size:16px}content{line-height:1.6}table{width:100%}img{max-width:100%}code{padding:2px 5px;background-color:#f2f2f2}pre code{color:#222;display:block;padding:20px;white-space:pre-wrap;font-size:14px}div.highlight code{background-color:unset;color:initial}blockquote{border-left:1px solid #999;color:#222;padding-left:20px;font-style:italic}footer{padding:25px;text-align:center}.helptext{color:#777;font-size:small}.errorlist{color:#eba613;font-size:small}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:#8b6fcb}@media(prefers-color-scheme:dark){body{background-color:#333;color:#ddd}h1,h2,h3,h4,h5,h6,strong,b{color:#eee}a{color:#8cc2dd}code{background-color:#777}pre code{color:#ddd}blockquote{color:#ccc}textarea,input{background-color:#252525;color:#ddd}.helptext{color:#aaa}}</style></head><body><header><a href=../../../../ class=title><h2>Major Hayden's Blog ðŸ¤ </h2></a><nav><a href=../../../../>Home</a>
<a href=../../../../ham-radio-faq>Ham Radio</a>
<a href=../../../../icanhazip-com-faq>icanhazip FAQ</a>
<a href=../../../../posts>Posts</a></nav><script async src=https://media.ethicalads.io/media/client/ethicalads.min.js></script><div class="adaptive raised" data-ea-publisher=major-io data-ea-type=text></div></header><main><h1>Rotate GNOME 3â€™s wallpaper with systemd user units and timers</h1><i><time datetime=2015-02-11 pubdate>2015-02-11</time></i>
<content><p><em>NOTE: This works in Fedora 21, but not in Fedora 22. Review <a href=../../../../2015/06/23/fedora-22-and-rotating-gnome-wallpaper-with-systemd-timers/>this post</a> for the fixes.</em></p><p><a href=http://www.gnome.org/gnome-3/>GNOME 3</a> has improved by leaps and bounds since its original release and it&rsquo;s my daily driver window manager on my Linux laptop. Even with all of these improvements, there&rsquo;s still no built-in way to rotate wallpaper (that I&rsquo;ve found).</p><p>There are some extensions, like <a href=https://extensions.gnome.org/extension/543/backslide/>BackSlide</a>, that enable background rotation on a time interval. Fedora 21 uses GNOME 3.14 and the current BackSlide version is incompatible. BackSlide&rsquo;s interface is fairly useful but I wanted something different.</p><p>One of systemd&rsquo;s handy features is the ability to set up <a href=http://www.freedesktop.org/wiki/Software/systemd/>systemd</a> unit files on a per-user basis. Every user can create unit files in their home directory and tell systemd to begin using those.</p><h3 id=getting-started>Getting started</h3><p>We first need a script that can rotate the background based on files in a particular directory. All of my wallpaper images are in <code>~/Pictures/wallpapers</code>. I adjusted this script that I found on GitHub so that it searches through files in my wallpaper directory and picks one at random to use:</p><div class=highlight><pre style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#93a1a1;font-style:italic>#!/bin/bash
</span><span style=color:#93a1a1;font-style:italic></span>
<span style=color:#268bd2>walls_dir</span>=<span style=color:#268bd2>$HOME</span>/Pictures/Wallpapers
<span style=color:#268bd2>selection</span>=<span style=color:#859900>$(</span>find <span style=color:#268bd2>$walls_dir</span> -type f -name <span style=color:#2aa198>&#34;*.jpg&#34;</span> -o -name <span style=color:#2aa198>&#34;*.png&#34;</span> | shuf -n1<span style=color:#859900>)</span>
gsettings <span style=color:#cb4b16>set</span> org.gnome.desktop.background picture-uri <span style=color:#2aa198>&#34;file://</span><span style=color:#268bd2>$selection</span><span style=color:#2aa198>&#34;</span>
</code></pre></div><p>I tossed this script into <code>~/bin/rotate_bg.sh</code> and made it executable with <code>chmod +x ~/bin/rotate_bg.sh</code>. Before you go any further, run the script manually in a terminal to verify that your background rotates to another image.</p><h3 id=preparing-the-systemd-service-unit-file>Preparing the systemd service unit file</h3><p>You&rsquo;ll need to create a user-level systemd service file directory if it doesn&rsquo;t exist already:</p><pre><code>mkdir ~/.config/systemd/user/
</code></pre><p>Drop this file into <code>~/.config/systemd/user/gnome-background-change.service</code>:</p><div class=highlight><pre style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=color:#859900>[Unit]</span>
<span style=color:#268bd2>Description</span>=<span style=color:#2aa198>Rotate GNOME background</span>

<span style=color:#859900>[Service]</span>
<span style=color:#268bd2>Type</span>=<span style=color:#2aa198>oneshot</span>
<span style=color:#268bd2>Environment</span>=<span style=color:#2aa198>DISPLAY=:0</span>
<span style=color:#268bd2>ExecStart</span>=<span style=color:#2aa198>/usr/bin/bash /home/[USERNAME]/bin/rotate_bg.sh</span>

<span style=color:#859900>[Install]</span>
<span style=color:#268bd2>WantedBy</span>=<span style=color:#2aa198>basic.target</span>
</code></pre></div><p>This unit file tells systemd that we have a oneshot script that will exit when it&rsquo;s finished. In addition, we also give the environment details to systemd so that it&rsquo;s aware of our existing X session.</p><p>Don&rsquo;t enable or start the service file yet. We will let our timer handle that part.</p><h3 id=setting-a-timer>Setting a timer</h3><p>Systemd&rsquo;s concept of <a href=http://www.freedesktop.org/software/systemd/man/systemd.timer.html>timers</a> is pretty detailed. You have plenty of control over how and when you want a particular service to run. We need a simple calendar-based timer (much like cron) that will start up our service from the previous step.</p><p>Drop this into <code>~/.config/systemd/user/gnome-background-change.timer</code>:</p><div class=highlight><pre style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=color:#859900>[Unit]</span>
<span style=color:#268bd2>Description</span>=<span style=color:#2aa198>Rotate GNOME wallpaper timer</span>

<span style=color:#859900>[Timer]</span>
<span style=color:#268bd2>OnCalendar</span>=<span style=color:#2aa198>*:0/5</span>
<span style=color:#268bd2>Persistent</span>=<span style=color:#2aa198>true</span>
<span style=color:#268bd2>Unit</span>=<span style=color:#2aa198>gnome-background-change.service</span>

<span style=color:#859900>[Install]</span>
<span style=color:#268bd2>WantedBy</span>=<span style=color:#2aa198>gnome-background-change.service</span>
</code></pre></div><p>We&rsquo;re telling systemd that we want this timer to run every five minutes and we want to start our service unit file from the previous step. The <code>Persistent</code> line tells systemd that we want this unit file run if the last run was missed. For example, if you log in at 7:02AM, we don&rsquo;t want to wait until 7:05AM to rotate the background. We can rotate it immediately after login.</p><p>If you&rsquo;d like a different interval, be sure to review systemd&rsquo;s <a href=http://www.freedesktop.org/software/systemd/man/systemd.time.html>time syntax</a> for the <code>OnCalendar</code> line. It&rsquo;s a little quirky if you&rsquo;re used to working with crontabs but it&rsquo;s very powerful once you understand it.</p><p>Now we can enable and start the timer:</p><pre><code>systemctl --user enable gnome-background-change.timer
systemctl --user start gnome-background-change.timer
</code></pre><h3 id=checking-our-work>Checking our work</h3><p>You can use systemctl to query the timer we just activated:</p><pre><code>$ systemctl --user list-timers
NEXT                         LEFT          LAST                         PASSED  UNIT                          ACTIVATES
Wed 2015-02-11 08:15:00 CST  3min 53s left Wed 2015-02-11 08:10:49 CST  16s ago gnome-background-change.timer gnome-background-change.service
</code></pre><p>In my case, this shows that the background rotation service last ran 16 seconds ago. It will run again in just under four minutes. If you find that the service runs but your wallpaper doesn&rsquo;t change, try running <code>journalctl -xe</code> to see if your service is throwing any errors.</p><h3 id=additional-reading>Additional reading</h3><p>This is just the tip of the iceberg of what systemd can do with user unit files and timers. the Arch Linux wiki has some awesome documentation about <a href=https://wiki.archlinux.org/index.php/Systemd/User>user unit files</a> and <a href=https://wiki.archlinux.org/index.php/Systemd/Timers>timers</a>. Check out the other timers that already exist on your system for more ideas.</p></content><p><a href=https://major.io/tags/bash/>#bash</a>
<a href=https://major.io/tags/fedora/>#fedora</a>
<a href=https://major.io/tags/gnome/>#gnome</a>
<a href=https://major.io/tags/script/>#script</a>
<a href=https://major.io/tags/systemd/>#systemd</a></p></main><footer><hr>CC-BY-SA 4.0 &#187;
Made with <a href=https://gohugo.io/>Hugo</a> &#187;
Theme based on <a href=https://github.com/janraasch/hugo-bearblog/>Hugo Ê•â€¢á´¥â€¢Ê” Bear</a> &#187;
<a href=https://github.com/major/major.io/commit/84372fb2198913a5e498b8d32ffc77fb813f0a48>84372fb2</a></footer></body></html>