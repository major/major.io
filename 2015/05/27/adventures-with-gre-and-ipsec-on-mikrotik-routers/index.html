<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=false><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><title>Adventures with GRE and IPSec on Mikrotik routers &#183; ðŸ¤  Major Hayden</title><meta name=title content="Adventures with GRE and IPSec on Mikrotik routers &#183; ðŸ¤  Major Hayden"><meta name=description content="A social nerd writing about everything"><link rel=canonical href=https://major.io/2015/05/27/adventures-with-gre-and-ipsec-on-mikrotik-routers/><link type=text/css rel=stylesheet href=/css/main.bundle.min.55253fde34a251b02bdc3be052caf9044f977a6d44817f370ad781aed774a2a79759827fd0c3255abb87575848a355a0068eb43b2958172f6c237352069d6cea.css integrity="sha512-VSU/3jSiUbAr3DvgUsr5BE+Xem1EgX83CteBrtd0oqeXWYJ/0MMlWruHV1hIo1WgBo60OylYFy9sI3NSBp1s6g=="><script type=text/javascript src=/js/appearance.min.badab316c9287a5a42a843e4eb45da65bb3d194a5a0f5fa4a3e516160e67df0b8c65f4f19a8e146436e29d583699e6cb41d6bbe99e05e1dbaa877763bad9f8e2.js integrity="sha512-utqzFskoelpCqEPk60XaZbs9GUpaD1+ko+UWFg5n3wuMZfTxmo4UZDbinVg2mebLQda76Z4F4duqh3djutn44g=="></script>
<script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.15ae6e2c9b1ac24a9ccf40003fa689efb1a18db1ee9b73d780b01a6c31b150441415862513e93184f68fe385759e4698b8763cba6a0f79493c1fed99ad5868d4.js integrity="sha512-Fa5uLJsawkqcz0AAP6aJ77GhjbHum3PXgLAabDGxUEQUFYYlE+kxhPaP44V1nkaYuHY8umoPeUk8H+2ZrVho1A==" data-copy=Copy data-copied=Copied></script>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:title" content="Adventures with GRE and IPSec on Mikrotik routers"><meta property="og:description" content="I recently picked up a RB850GX2 from my favorite Mikrotik retailer, r0c-n0c."><meta property="og:type" content="article"><meta property="og:url" content="https://major.io/2015/05/27/adventures-with-gre-and-ipsec-on-mikrotik-routers/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2015-05-27T13:46:28+00:00"><meta property="article:modified_time" content="2015-05-27T13:46:28+00:00"><meta property="og:site_name" content="ðŸ¤  Major Hayden"><meta name=twitter:card content="summary"><meta name=twitter:title content="Adventures with GRE and IPSec on Mikrotik routers"><meta name=twitter:description content="I recently picked up a RB850GX2 from my favorite Mikrotik retailer, r0c-n0c."><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Posts","name":"Adventures with GRE and IPSec on Mikrotik routers","headline":"Adventures with GRE and IPSec on Mikrotik routers","abstract":"I recently picked up a RB850GX2 from my favorite Mikrotik retailer, r0c-n0c.","inLanguage":"en","url":"https:\/\/major.io\/2015\/05\/27\/adventures-with-gre-and-ipsec-on-mikrotik-routers\/","author":{"@type":"Person","name":"Major Hayden"},"copyrightYear":"2015","dateCreated":"2015-05-27T13:46:28\u002b00:00","datePublished":"2015-05-27T13:46:28\u002b00:00","dateModified":"2015-05-27T13:46:28\u002b00:00","keywords":["general advice","ipsec","mikrotik","networking","security"],"mainEntityOfPage":"true","wordCount":"1702"}]</script><meta name=author content="Major Hayden"><link href=mailto:major@mhtx.net rel=me><link href=https://github.com/major rel=me><link href=https://gitlab.com/majorhayden rel=me><link href=https://linkedin.com/in/majorhayden rel=me><link href=https://t.me/majorhayden rel=me><link href=https://twitter.com/majorhayden rel=me></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 bg-neutral text-neutral-900 sm:px-14 md:px-24 lg:px-32 dark:bg-neutral-800 dark:text-neutral max-w-7xl"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 dark:bg-neutral-600 focus:translate-y-0" href=#main-content><span class="font-bold ltr:pr-2 rtl:pl-2 text-primary-600 dark:text-primary-400">&darr;</span>Skip to main content</a></div><header class="py-6 font-semibold sm:py-10 text-neutral-900 dark:text-neutral print:hidden"><nav class="flex justify-between"><div><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" rel=me href=/>ðŸ¤  Major Hayden</a></div><ul class="flex flex-col list-none ltr:text-right rtl:text-left sm:flex-row"><li class="mb-1 sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/posts/ title=Posts>Blog</a></li><li class="mb-1 sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/tags/ title=Tags>Tags</a></li><li class="mb-1 sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/w5wut/ title="W5WUT: My amateur radio station">W5WUT</a></li><li class="mb-1 sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/cv/ title="Major's CV">CV</a></li><li class="ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><button id=search-button class="text-base hover:text-primary-600 dark:hover:text-primary-400" title="Search (/)">
<span class="relative inline-block align-text-bottom icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button></li></ul></nav></header><div class="relative flex flex-col grow"><main id=main-content class=grow><article><header class=max-w-prose><ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden"><li class="inline hidden"><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/>ðŸ¤  Major Hayden</a><span class="px-1 text-primary-500">/</span></li><li class=inline><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/>Posts</a><span class="px-1 text-primary-500">/</span></li><li class="inline hidden"><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/2015/05/27/adventures-with-gre-and-ipsec-on-mikrotik-routers/>Adventures with GRE and IPSec on Mikrotik routers</a><span class="px-1 text-primary-500">/</span></li></ol><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Adventures with GRE and IPSec on Mikrotik routers</h1><div class="mt-8 mb-12 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime="2015-05-27 13:46:28 +0000 UTC">27 May 2015</time><span class="px-2 text-primary-500">&#183;</span><span>1702 words</span><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">8 mins</span></div><div class="my-1 text-xs text-neutral-500 dark:text-neutral-400"><a href=/tags/general-advice/ class="px-1 py-[1px] border rounded-md border-neutral-200 dark:border-neutral-600 hover:border-primary-300 hover:text-primary-700 dark:hover:border-primary-600 dark:hover:text-primary-400">general advice</a>
<a href=/tags/ipsec/ class="px-1 py-[1px] border rounded-md border-neutral-200 dark:border-neutral-600 hover:border-primary-300 hover:text-primary-700 dark:hover:border-primary-600 dark:hover:text-primary-400">ipsec</a>
<a href=/tags/mikrotik/ class="px-1 py-[1px] border rounded-md border-neutral-200 dark:border-neutral-600 hover:border-primary-300 hover:text-primary-700 dark:hover:border-primary-600 dark:hover:text-primary-400">mikrotik</a>
<a href=/tags/networking/ class="px-1 py-[1px] border rounded-md border-neutral-200 dark:border-neutral-600 hover:border-primary-300 hover:text-primary-700 dark:hover:border-primary-600 dark:hover:text-primary-400">networking</a>
<a href=/tags/security/ class="px-1 py-[1px] border rounded-md border-neutral-200 dark:border-neutral-600 hover:border-primary-300 hover:text-primary-700 dark:hover:border-primary-600 dark:hover:text-primary-400">security</a></div></div></header><section class="flex flex-col max-w-full mt-0 prose lg:flex-row dark:prose-invert"><div class="order-first px-0 lg:max-w-xs ltr:lg:pl-8 rtl:lg:pr-8 lg:order-last"><div class="ltr:pl-5 rtl:pr-5 toc lg:sticky lg:top-10 print:hidden"><details open class="mt-0 overflow-hidden rounded-lg rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5"><summary class="block py-1 text-lg font-semibold cursor-pointer rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 text-neutral-800 dark:text-neutral-100 lg:hidden bg-neutral-100 dark:bg-neutral-700">Table of Contents</summary><div class="py-2 border-dotted ltr:border-l rtl:border-r rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 border-neutral-300 dark:border-neutral-600"><nav id=TableOfContents><ul><li><ul><li><a href=#the-setup>The Setup</a></li><li><a href=#gre>GRE</a></li><li><a href=#ips-and-routes>IP&rsquo;s and Routes</a></li><li><a href=#adding-ipsec>Adding IPSec</a></li><li><a href=#checking-our-work>Checking our work</a></li><li><a href=#how-i-made-a-huge-mistake>How I made a huge mistake</a></li></ul></li></ul></nav></div></details></div></div><div class="min-w-0 min-h-0 max-w-prose"><p><figure><img class="my-0 rounded-md" src=https://major.io/wp-content/uploads/2015/05/mikrotik-routerboard-rb8_6221.jpg alt=1></figure></p><p>I recently picked up a <a href=http://routerboard.com/RB850Gx2>RB850GX2</a> from my favorite Mikrotik retailer, <a href=https://www.roc-noc.com/mikrotik/routerboard/RB850Gx2.html>r0c-n0c</a>. It&rsquo;s a dual-core PowerPC board with five ethernet ports and some decent performance for the price.</p><p>I still have the RB493G in a colocation and I usually connect my home and the colo via OpenVPN or IPSec. Networking is not one of my best skills and I&rsquo;m always looking to learn more about it when I can. I decided to try out a GRE tunnel on top of IPSec this time around. Combining GRE and IPSec allows you to simplify connectivity between two network segments through an encrypted tunnel.</p><h2 id=the-setup class="relative group">The Setup <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#the-setup aria-label=Anchor>#</a></span></h2><p>The LAN in my colo and at home is fairly simple: a /24 of RFC1918 space behind a Mikrotik doing NAT. My goal was to get a tunnel up between both environments so that I could reach devices behind my colo firewall from home and vice versa. I do plenty of ssh back and forth along with backups from time to time.</p><p>In this example, here&rsquo;s the current network configuration:</p><ul><li>Home: 192.168.50.0/24 on the LAN, 1.1.1.1 as the public IP</li><li>Colo: 192.168.150.0/24 on the LAN, 2.2.2.2 as the public IP</li></ul><p>I want devices on 192.168.50.0/24 to talk to 192.168.150.0/24 and vice versa. Let&rsquo;s get the GRE tunnel up first.</p><h2 id=gre class="relative group">GRE <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#gre aria-label=Anchor>#</a></span></h2><p>Plain GRE tunnels aren&rsquo;t encrypted, but I prefer to set them up first to test connectivity prior to adding IPSec into the mix. IPSec can be a challenge to configure the first time around.</p><p>I&rsquo;ll first create a GRE interface at home:</p><pre tabindex=0><code>/interface gre
add !keepalive local-address=1.1.1.1 name=home-to-colo remote-address=2.2.2.2
</code></pre><p>We&rsquo;ll do the same on the colo router:</p><pre tabindex=0><code>/interface gre
add !keepalive local-address=2.2.2.2 name=colo-to-home remote-address=1.1.1.1
</code></pre><p>You can check to see if the GRE tunnel is running from either router:</p><pre tabindex=0><code>/interface gre print
</code></pre><p>Look for the <strong>R</strong> in the flags column.</p><p>If you&rsquo;ve made it this far, you now have a GRE tunnel configured but we can&rsquo;t pass any traffic across it yet. We need to add some IP&rsquo;s to both sides and configure some routes.</p><h2 id=ips-and-routes class="relative group">IP&rsquo;s and Routes <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#ips-and-routes aria-label=Anchor>#</a></span></h2><p>You have some freedom here to choose the IP addresses for both ends of your tunnel but don&rsquo;t choose anything that interferes with your current LAN IP addresses. In my case, I&rsquo;ll choose 10.10.10.1/30 and 10.10.10.2/30 for both ends of the tunnel.</p><p>I&rsquo;ll give the 10.10.10.2 address to the home firewall:</p><pre tabindex=0><code>/ip address
add address=10.10.10.2/30 interface=home-to-colo network=10.10.10.0
</code></pre><p>And I&rsquo;ll give the 10.10.10.1 address to the colo firewall:</p><pre tabindex=0><code>/ip address
add address=10.10.10.1/30 interface=colo-to-home network=10.10.10.0
</code></pre><p>At this point, systems at home can ping 10.10.10.1 (the colo router&rsquo;s GRE tunnel endpoint) and systems at the colo can ping 10.10.10.2 (the home router&rsquo;s GRE tunnel endpoint). That&rsquo;s great because we will use these IP&rsquo;s to route our LAN traffic across the tunnel.</p><p>We need to tell the home router how to get traffic from its LAN over to the colo LAN and vice versa. We can do that with the tunnel endpoints we just configured.</p><p>Let&rsquo;s tell the home router to use the colo router&rsquo;s GRE tunnel endpoint to reach the colo LAN:</p><pre tabindex=0><code>/ip route
add distance=1 dst-address=192.168.150.0/24 gateway=home-to-colo
</code></pre><p>And tell the colo router to use the home router&rsquo;s GRE endpoint to reach the home LAN:</p><pre tabindex=0><code>/ip route
add distance=1 dst-address=192.168.50.0/24 gateway=colo-to-home
</code></pre><p>We don&rsquo;t have to tell the router about the tunnel&rsquo;s IP address since those routes are generated automatically when we added the IP addresses to each side of the GRE tunnel.</p><p>If you&rsquo;ve made it this far, systems in your home LAN should be able to ping the colo LAN and vice versa. If not, go back and double-check your IP addresses on both sides of the tunnel and your routes.</p><h2 id=adding-ipsec class="relative group">Adding IPSec <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#adding-ipsec aria-label=Anchor>#</a></span></h2><p><strong>BEFORE YOU GO ANY FURTHER, ensure you have some sort of out-of-band access to both routers.</strong> If you make a big mistake like I did (more on that later), you&rsquo;re going to be glad you set up another way to reach your devices!</p><p>We have an GRE tunnel without encryption already and that&rsquo;s allowing us to pass traffic. That&rsquo;s fine, but it&rsquo;s not terribly secure to send our packets in that tunnel across a hostile internet. IPSec will allow us to tell both routers that we want packets between the public IP addresses of both routers to be encrypted. The GRE tunnel will take care of actually delivering the packets, however. IPSec isn&rsquo;t an interface and it can&rsquo;t be a conduit for networking all by itself.</p><p><strong style=color:#d42020>Have you configured another way to access both routers yet? Seriously, stop now and do that. I mean it.</strong></p><p>If you have native IPv6 access (not a IPv6 over IPv4 tunnel!) into each device, that can be a viable backup plan. Another option might be serial cables or a dedicated console connection. You&rsquo;ll thank me later.</p><p>Configuring IPSec is done in three chunks:</p><ul><li>Make a proposal: both routers must agree on how to authenticate each other and encrypt traffic</li><li>Configure a peer list: both routers need to know how to reach each other and have some shared secrets</li><li>Set a policy: both routers need to agree on which packets must be encrypted</li></ul><p>We will start with the proposal. The defaults are good for both routers. Add this configuration <strong>on both devices</strong>:</p><pre tabindex=0><code>/ip ipsec proposal
set [ find default=yes ] auth-algorithms=md5 enc-algorithms=aes-128-cbc,twofish
</code></pre><p>Now our routers agree on what methods they&rsquo;ll use to encrypt traffic. Feel free to adjust these algorithms later if needed. Let&rsquo;s tell each router about its peer.</p><p>At home:</p><pre tabindex=0><code>/ip ipsec peer
add address=2.2.2.2/32 nat-traversal=no secret=letshavefunwithipsec
</code></pre><p>At the colo:</p><pre tabindex=0><code>/ip ipsec peer
add address=1.1.1.1/32 nat-traversal=no secret=letshavefunwithipsec
</code></pre><p>Both routers now know about each other and they both have the same shared secret (please use a better shared secret in production). All we have left is configuring a policy.</p><p>At this point, ensure you&rsquo;re accessing both routers via an out-of-band method (native IPv6, console, serial, etc). <strong>YOU ARE ABOUT TO LOSE CONNECTIVITY TO YOUR REMOTE DEVICE.</strong></p><p>At home, we set up a policy that says all traffic between the public addresses of both firewalls must be encrypted (GRE will carry the traffic for us). <strong>Ensure that the CIDR portion of the IP address for dst-address/src-address is present!</strong></p><pre tabindex=0><code>/ip ipsec policy
add dst-address=2.2.2.2/32 sa-dst-address=2.2.2.2 sa-src-address=1.1.1.1 src-address=1.1.1.1/32 tunnel=yes
</code></pre><p>We will do something similar on the colo side. <strong>Again, ensure that the CIDR portion of the IP address for dst-address/src-address is present!</strong></p><pre tabindex=0><code>/ip ipsec policy
add dst-address=1.1.1.1/32 sa-dst-address=1.1.1.1 sa-src-address=2.2.2.2 src-address=2.2.2.2/32 tunnel=yes
</code></pre><p>You should now be able to ping across your GRE tunnel but it&rsquo;s encrypted this time! If you find that one of your devices is inaccessible, don&rsquo;t panic. Disable the policy you just added (<code>set disabled=yes number=[number of your policy]</code>) and review your configuration.</p><p>In the policy step, we told both routers that if traffic moves between the <em>src-address</em> and <em>dst-address</em>, we want it encrypted. Also, the <em>sa-src-address</em> and <em>sa-dst-address</em> gives the router a hint to figure out the identity of the peer and what their shared secret is.</p><h2 id=checking-our-work class="relative group">Checking our work <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#checking-our-work aria-label=Anchor>#</a></span></h2><p>You can check your work with something like this on the home router:</p><pre tabindex=0><code>[major@Home] &gt; /ip ipsec remote-peers print
 0 local-address=1.1.1.1 remote-address=2.2.2.2 state=established side=initiator established=7h17m10s
</code></pre><p>If you have a line like that, your IPSec peers can communicate properly. To test the encryption, you have two options. One option is to put a device outside your firewall and dump traffic via a tap or hub.</p><p>Another option (albeit less accurate) is to use the profile tool built into RouterOS. Run the following:</p><pre tabindex=0><code>/tool profile
</code></pre><p>You&rsquo;ll see some output showing where the majority of your CPU is consumed. Now, transfer some large files between systems behind both routers. You can use <a href=/2010/03/20/testing-network-throughput-with-iperf/>iperf</a> for this as well if you really want to stress out the network link. When you do that, you should see <strong>encrypting</strong> in the profile output as a very large consumer of the CPU. If you only see something like <strong>gre</strong> or <strong>ethernet</strong> as your top CPU consumers, you may have missed something on your IPSec policy and your traffic is likely not being encrypted. This isn&rsquo;t true for all routers â€” it depends on your normal workloads.</p><h2 id=how-i-made-a-huge-mistake class="relative group">How I made a huge mistake <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#how-i-made-a-huge-mistake aria-label=Anchor>#</a></span></h2><p>When I was going through this process, I made it through the GRE portion without a hitch. Everything worked well. Once I added IPSec to the mix, I used the GRE tunnel endpoints (10.10.10.1 and 10.10.10.2) as my <em>src-address</em> and <em>dst-address</em> in my IPSec policy. Nothing was getting encrypted and I was getting really frustrated.</p><p>I kept reading tutorials on various sites and came to realize that I didn&rsquo;t need an encryption policy between the tunnel endpoints, I needed a policy between the actual public addresses of the routers. I wasn&rsquo;t aware that the GRE tunnel would happily keep working between the two public IP addresses even with the IPSec policy in place between the IP addresses.</p><p>First mistake: I didn&rsquo;t access my colo router via an out-of-band path. Second mistake: I applied my IPSec policy on the home router first and was shocked that I lost connectivity to the colo router. That was a quick fix â€” I just disabled the IPSec policy on the home router and I could access the colo router again.</p><p>Just after adjusting the IPSec policy on the colo router to use the public IP addresses, I noticed that connectivity dropped. At this point, I expected that â€” I set up a policy there but I hadn&rsquo;t done it on the home router yet. I enabled the policy on the home router and then started pinging. Nothing.</p><p>Then came the Pingdom and UptimeRobot alerts for my sites in the colo. <strong>Oh crap.</strong></p><p><figure><img class="my-0 rounded-md" src=https://major.io/wp-content/uploads/2015/05/ive-made-a-huge-mistake.gif alt=5></figure></p><p>Once I was able to reach the colo router via IPv6 through some other VM&rsquo;s, I realized what happened. I left the CIDR mask off the <em>src-address</em> and <em>dst-address</em> in the IPSec policy.</p><p>Guess what RouterOS chose as a CIDR mask for me? <strong>/0.</strong> Ouch.</p><p>I quickly adjusted those to be /32&rsquo;s. Within seconds, everything was up again and the GRE tunnel began working. As the Pingdom alerts cleared and my heart rate returned to normal, I figured the best thing I should do is share my story so that others don&rsquo;t make the same mistake. ;)</p></div></section><footer class="pt-8 max-w-prose print:hidden"><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="flex group" href=/2015/05/27/xen-4-5-crashes-during-boot-on-fedora-22/><span class="mr-3 ltr:inline rtl:hidden text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400">&larr;</span>
<span class="ml-3 ltr:hidden rtl:inline text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400">&rarr;</span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Xen 4.5 crashes during boot on Fedora 22</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2015-05-27 12:33:21 +0000 UTC">27 May 2015</time></span></span></a></span>
<span><a class="flex text-right group" href=/2015/06/04/upatre-and-icanhazip/><span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Upatre and icanhazip</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2015-06-05 02:01:19 +0000 UTC">5 June 2015</time></span></span>
<span class="ml-3 ltr:inline rtl:hidden text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400">&rarr;</span>
<span class="mr-3 ltr:hidden rtl:inline text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400">&larr;</span></a></span></div></div></footer></article><div class="absolute top-[100vh] ltr:right-0 rtl:left-0 w-12 pointer-events-none bottom-0"><a href=#the-top class="w-12 h-12 sticky pointer-events-auto top-[calc(100vh-5.5rem)] bg-neutral/50 dark:bg-neutral-800/50 backdrop-blur rounded-full text-xl flex items-center justify-center text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer class="py-10 print:hidden"><div class="flex items-center justify-between"><div><p class="text-sm text-neutral-500 dark:text-neutral-400">All content licensed <a href=https://creativecommons.org/licenses/by-sa/4.0/>CC-BY-SA</a></p><p class="text-xs text-neutral-500 dark:text-neutral-400">Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://git.io/hugo-congo target=_blank rel="noopener noreferrer">Congo</a></p></div><div class="text-sm cursor-pointer text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400 ltr:mr-14 rtl:ml-14"><button id=appearance-switcher class="w-12 h-12" type=button title="Switch to dark appearance">
<span class="inline dark:hidden"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></span><span class="hidden dark:inline"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></span></button></div></div></footer><div id=search-wrapper class="fixed inset-0 z-50 flex flex-col p-4 sm:p-6 md:p-[10vh] lg:p-[12vh] w-screen h-screen cursor-default bg-neutral-500/50 backdrop-blur-sm dark:bg-neutral-900/50 invisible" data-url=https://major.io/><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg border-neutral-200 top-20 bg-neutral dark:bg-neutral-800 dark:border-neutral-700"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative inline-block align-text-bottom icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-transparent focus:outline-2" placeholder=Search tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400" title="Close (Esc)">
<span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>