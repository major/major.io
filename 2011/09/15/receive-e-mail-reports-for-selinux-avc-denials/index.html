<!doctype html><html lang=en-us><head><meta http-equiv=x-clacks-overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://major.io/favicon.ico><title>Receive e-mail reports for SELinux AVC denials | Major Hayden's Blog ðŸ¤ </title><meta name=title content="Receive e-mail reports for SELinux AVC denials"><meta name=description content="SELinux isn&rsquo;t a technology that&rsquo;s easy to tackle for newcomers. However, there&rsquo;s been a lot of work to smooth out the rough edges while still keeping a tight grip on what applications and users are allowed to do on a Linux system. One of the biggest efforts has been around setroubleshoot.
The purpose behind setroubleshoot is to let users know when access has been denied, help them resolve it if necessary, and to reduce overall frustration while working through tight security restrictions in the default SELinux policies."><meta name=keywords content="centos,command line,email,fedora,messagebus,red hat,security,selinux,server,ssh,sysadmin,systemd,yum,"><meta property="og:title" content="Receive e-mail reports for SELinux AVC denials"><meta property="og:description" content="SELinux isn&rsquo;t a technology that&rsquo;s easy to tackle for newcomers. However, there&rsquo;s been a lot of work to smooth out the rough edges while still keeping a tight grip on what applications and users are allowed to do on a Linux system. One of the biggest efforts has been around setroubleshoot.
The purpose behind setroubleshoot is to let users know when access has been denied, help them resolve it if necessary, and to reduce overall frustration while working through tight security restrictions in the default SELinux policies."><meta property="og:type" content="article"><meta property="og:url" content="https://major.io/2011/09/15/receive-e-mail-reports-for-selinux-avc-denials/"><meta property="og:image" content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2011-09-16T04:17:04+00:00"><meta property="article:modified_time" content="2011-09-16T04:17:04+00:00"><meta property="og:site_name" content="Major Hayden's Blog ðŸ¤ "><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta name=twitter:title content="Receive e-mail reports for SELinux AVC denials"><meta name=twitter:description content="SELinux isn&rsquo;t a technology that&rsquo;s easy to tackle for newcomers. However, there&rsquo;s been a lot of work to smooth out the rough edges while still keeping a tight grip on what applications and users are allowed to do on a Linux system. One of the biggest efforts has been around setroubleshoot.
The purpose behind setroubleshoot is to let users know when access has been denied, help them resolve it if necessary, and to reduce overall frustration while working through tight security restrictions in the default SELinux policies."><meta name=twitter:site content="@mhayden"><meta itemprop=name content="Receive e-mail reports for SELinux AVC denials"><meta itemprop=description content="SELinux isn&rsquo;t a technology that&rsquo;s easy to tackle for newcomers. However, there&rsquo;s been a lot of work to smooth out the rough edges while still keeping a tight grip on what applications and users are allowed to do on a Linux system. One of the biggest efforts has been around setroubleshoot.
The purpose behind setroubleshoot is to let users know when access has been denied, help them resolve it if necessary, and to reduce overall frustration while working through tight security restrictions in the default SELinux policies."><meta itemprop=datePublished content="2011-09-16T04:17:04+00:00"><meta itemprop=dateModified content="2011-09-16T04:17:04+00:00"><meta itemprop=wordCount content="448"><meta itemprop=image content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta itemprop=keywords content="centos,command line,email,fedora,messagebus,red hat,security,selinux,server,ssh,sysadmin,systemd,yum,"><meta name=referrer content="no-referrer-when-downgrade"><style>body{font-family:Verdana,sans-serif;margin:auto;padding:20px;max-width:820px;text-align:left;background-color:#fff;word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:#444}h1,h2,h3,h4,h5,h6,strong,b{color:#222}a{color:#3273dc}.title{text-decoration:none;border:0}.title span{font-weight:400}nav a{margin-right:10px}textarea{width:100%;font-size:16px}input{font-size:16px}content{line-height:1.6}table{width:100%}img{max-width:100%}code{padding:2px 5px;background-color:#f2f2f2}pre code{color:#222;display:block;padding:20px;white-space:pre-wrap;font-size:14px}div.highlight code{background-color:unset;color:initial}blockquote{border-left:1px solid #999;color:#222;padding-left:20px;font-style:italic}footer{padding:25px;text-align:center}.helptext{color:#777;font-size:small}.errorlist{color:#eba613;font-size:small}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:#8b6fcb}@media(prefers-color-scheme:dark){body{background-color:#333;color:#ddd}h1,h2,h3,h4,h5,h6,strong,b{color:#eee}a{color:#8cc2dd}code{background-color:#777}pre code{color:#ddd}blockquote{color:#ccc}textarea,input{background-color:#252525;color:#ddd}.helptext{color:#aaa}}</style></head><body><header><a href=../../../../ class=title><h2>Major Hayden's Blog ðŸ¤ </h2></a><nav><a href=../../../../>Home</a>
<a href=../../../../ham-radio-faq>Ham Radio</a>
<a href=../../../../icanhazip-com-faq>icanhazip FAQ</a>
<a href=../../../../posts>Posts</a></nav></header><main><h1>Receive e-mail reports for SELinux AVC denials</h1><i><time datetime=2011-09-16 pubdate>2011-09-16</time></i>
<content><p>SELinux isn&rsquo;t a technology that&rsquo;s easy to tackle for newcomers. However, there&rsquo;s been a lot of work to smooth out the rough edges while still keeping a tight grip on what applications and users are allowed to do on a Linux system. One of the biggest efforts has been around <a href=https://fedorahosted.org/setroubleshoot/wiki/SETroubleShoot%20Overview>setroubleshoot</a>.</p><p>The purpose behind setroubleshoot is to let users know when access has been denied, help them resolve it if necessary, and to reduce overall frustration while working through tight security restrictions in the default SELinux policies. The GUI frontend for setroubleshoot is great for users who run Linux desktops or those who run servers with a display attached. Don&rsquo;t worry, you can configure setroubleshoot on remote servers to send alerts elsewhere when a GUI alert isn&rsquo;t an option.</p><p>Install a few packages to get started:</p><pre><code>yum install setroubleshoot{-server,-plugins,-doc}
</code></pre><p>Open <code>/etc/setroubleshoot/setroubleshoot.conf</code> in your favorite text editor and adjust the <code>[email]</code> section to fit your server:</p><div class=highlight><pre style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=color:#268bd2>recipients_filepath</span> = <span style=color:#2aa198>/var/lib/setroubleshoot/email_alert_recipients</span>
<span style=color:#268bd2>smtp_port</span> = <span style=color:#2aa198>25</span>
<span style=color:#268bd2>smtp_host</span> = <span style=color:#2aa198>localhost</span>
<span style=color:#268bd2>from_address</span> = <span style=color:#2aa198>selinux@myserver.com</span>
<span style=color:#268bd2>subject</span> = <span style=color:#2aa198>[MyServer] SELinux AVC Alert</span>
</code></pre></div><p>You could probably see it coming, but you need to put the e-mail addresses for your recipients into <code>/var/lib/setroubleshoot/email_alert_recipients</code>:</p><pre><code>echo &quot;selinux@mycompany.com&quot; &gt;&gt; /var/lib/setroubleshoot/email_alert_recipients
</code></pre><p>You&rsquo;ll notice that setroubleshoot doesn&rsquo;t have an init script and it doesn&rsquo;t exist in systemd in Fedora 15. It runs through the <a href=http://en.wikipedia.org/wiki/D-Bus>dbus-daemon</a> and a quick bounce of the messagebus via its init script brings in the necessary components to run setroubleshoot:</p><pre><code>service messagebus restart
</code></pre><p>A really easy (and safe) test is to ask sshd to bind to a non-standard port. Simply define an additional port on in your <code>/etc/ssh/sshd_config</code> like this:</p><pre><code>Port 22
Port 222
</code></pre><p>When you restart sshd, it will bind to port 22 with success, but it won&rsquo;t be allowed to bind to port 222 (since that&rsquo;s blocked by SELinux as a non-standard port for the <code>ssh_port_t</code> port type). <strong>DON&rsquo;T WORRY!</strong> Your sshd server will still be listening on port 22. If you wait a moment, you&rsquo;ll get an e-mail (perhaps two) that not only notify you of the denial, but they make suggestions for how to fix it:</p><pre><code>SELinux is preventing /usr/sbin/sshd from name_bind access on the tcp_socket port 222.

*****  Plugin bind_ports (99.5 confidence) suggests  *************************

If you want to allow /usr/sbin/sshd to bind to network port 222
Then you need to modify the port type.
Do
# semanage port -a -t PORT_TYPE -p tcp 222
   where PORT_TYPE is one of the following: ...
</code></pre><p>For this particular example, the quick fix would be to run:</p><pre><code>semanage port -a -t ssh_port_t -p tcp 222
</code></pre><hr><p><em>Much of this post&rsquo;s information was gathered from the detailed documentation on <a href=http://fedoraproject.org/wiki/Docs/Drafts/SELinux/SETroubleShoot/UserFAQ>Fedora&rsquo;s setroubleshoot User&rsquo;s FAQ</a> as well as <a href=http://danwalsh.livejournal.com/20931.html>Dan Walsh&rsquo;s setroubleshoot blog post</a>.</em></p></content><p><a href=https://major.io/tags/centos/>#centos</a>
<a href=https://major.io/tags/command-line/>#command line</a>
<a href=https://major.io/tags/email/>#email</a>
<a href=https://major.io/tags/fedora/>#fedora</a>
<a href=https://major.io/tags/messagebus/>#messagebus</a>
<a href=https://major.io/tags/red-hat/>#red hat</a>
<a href=https://major.io/tags/security/>#security</a>
<a href=https://major.io/tags/selinux/>#selinux</a>
<a href=https://major.io/tags/server/>#server</a>
<a href=https://major.io/tags/ssh/>#ssh</a>
<a href=https://major.io/tags/sysadmin/>#sysadmin</a>
<a href=https://major.io/tags/systemd/>#systemd</a>
<a href=https://major.io/tags/yum/>#yum</a></p></main><footer><script async src=https://media.ethicalads.io/media/client/ethicalads.min.js></script><div data-ea-publisher=major-io data-ea-type=text></div><hr>CC-BY-SA 4.0 &#187;
Made with <a href=https://gohugo.io/>Hugo</a> &#187;
Theme based on <a href=https://github.com/janraasch/hugo-bearblog/>Hugo Ê•â€¢á´¥â€¢Ê” Bear</a><br></footer></body></html>