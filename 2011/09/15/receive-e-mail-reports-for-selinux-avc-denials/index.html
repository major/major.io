<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="Major Hayden"><meta name=description content="SELinux isn&amp;rsquo;t a technology that&amp;rsquo;s easy to tackle for newcomers. However, there&amp;rsquo;s been a lot of work to smooth out the rough edges while still keeping a tight grip on what applications and users are allowed to do on a Linux system. One of the biggest efforts has been around setroubleshoot.
The purpose behind setroubleshoot is to let users know when access has been denied, help them resolve it if necessary, and to reduce overall frustration while working through tight security restrictions in the default SELinux policies."><meta name=keywords content=",centos,command line,email,fedora,messagebus,red hat,security,selinux,server,ssh,sysadmin,systemd,yum"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://major.io/2011/09/15/receive-e-mail-reports-for-selinux-avc-denials/><title>Receive e-mail reports for SELinux AVC denials :: Major Hayden ðŸ¤  â€” Words of wisdom from a social nerd</title><link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css rel=stylesheet type=text/css><link rel=stylesheet href=../../../../main.89fa80e2143f71bd5c96a7c94e531dec3276a367e22f87e74a76026ab64680bf.css><link rel=apple-touch-icon sizes=180x180 href=../../../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../../../favicon-16x16.png><link rel=manifest href=../../../../site.webmanifest><link rel=mask-icon href=../../../../safari-pinned-tab.svg color=#252627><link rel="shortcut icon" href=../../../../favicon.ico><meta name=msapplication-TileColor content="#252627"><meta name=theme-color content="#252627"><meta itemprop=name content="Receive e-mail reports for SELinux AVC denials"><meta itemprop=description content="SELinux isn&rsquo;t a technology that&rsquo;s easy to tackle for newcomers. However, there&rsquo;s been a lot of work to smooth out the rough edges while still keeping a tight grip on what applications and users are allowed to do on a Linux system. One of the biggest efforts has been around setroubleshoot.
The purpose behind setroubleshoot is to let users know when access has been denied, help them resolve it if necessary, and to reduce overall frustration while working through tight security restrictions in the default SELinux policies."><meta itemprop=datePublished content="2011-09-16T04:17:04+00:00"><meta itemprop=dateModified content="2011-09-16T04:17:04+00:00"><meta itemprop=wordCount content="448"><meta itemprop=image content="https://major.io"><meta itemprop=keywords content="centos,command line,email,fedora,messagebus,red hat,security,selinux,server,ssh,sysadmin,systemd,yum,"><meta property="article:section" content="Blog Posts"><meta property="article:published_time" content="2011-09-16 04:17:04 +0000 UTC"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Receive e-mail reports for SELinux AVC denials :: Major Hayden ðŸ¤ "><meta name=twitter:description content><meta name=twitter:site content="https://major.io"><meta name=twitter:creator content="Major Hayden"><meta name=twitter:image content><style type=text/css>html{letter-spacing:unset}</style></head><body class=dark-theme><div class=container><header class=header><span class=header__inner><a href=../../../../ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>$ echo major.io</span>
<span class=logo__cursor style=visibility:hidden></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=../../../../ham-radio-faq>hamradio</a></li><li><a href=../../../../icanhazip-com-faq>icanhazip</a></li><li><a href=../../../../posts/>posts</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href=https://major.io/2011/09/15/receive-e-mail-reports-for-selinux-avc-denials/>Receive e-mail reports for SELinux AVC denials</a></h2><div class=post-content><p>SELinux isn&rsquo;t a technology that&rsquo;s easy to tackle for newcomers. However, there&rsquo;s been a lot of work to smooth out the rough edges while still keeping a tight grip on what applications and users are allowed to do on a Linux system. One of the biggest efforts has been around <a href=https://fedorahosted.org/setroubleshoot/wiki/SETroubleShoot%20Overview>setroubleshoot</a>.</p><p>The purpose behind setroubleshoot is to let users know when access has been denied, help them resolve it if necessary, and to reduce overall frustration while working through tight security restrictions in the default SELinux policies. The GUI frontend for setroubleshoot is great for users who run Linux desktops or those who run servers with a display attached. Don&rsquo;t worry, you can configure setroubleshoot on remote servers to send alerts elsewhere when a GUI alert isn&rsquo;t an option.</p><p>Install a few packages to get started:</p><pre><code>yum install setroubleshoot{-server,-plugins,-doc}
</code></pre><p>Open <code>/etc/setroubleshoot/setroubleshoot.conf</code> in your favorite text editor and adjust the <code>[email]</code> section to fit your server:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini>recipients_filepath <span style=color:#719e07>=</span> <span style=color:#2aa198>/var/lib/setroubleshoot/email_alert_recipients</span>
smtp_port <span style=color:#719e07>=</span> <span style=color:#2aa198>25</span>
smtp_host <span style=color:#719e07>=</span> <span style=color:#2aa198>localhost</span>
from_address <span style=color:#719e07>=</span> <span style=color:#2aa198>selinux@myserver.com</span>
subject <span style=color:#719e07>=</span> <span style=color:#2aa198>[MyServer] SELinux AVC Alert</span>
</code></pre></div><p>You could probably see it coming, but you need to put the e-mail addresses for your recipients into <code>/var/lib/setroubleshoot/email_alert_recipients</code>:</p><pre><code>echo &quot;selinux@mycompany.com&quot; &gt;&gt; /var/lib/setroubleshoot/email_alert_recipients
</code></pre><p>You&rsquo;ll notice that setroubleshoot doesn&rsquo;t have an init script and it doesn&rsquo;t exist in systemd in Fedora 15. It runs through the <a href=http://en.wikipedia.org/wiki/D-Bus>dbus-daemon</a> and a quick bounce of the messagebus via its init script brings in the necessary components to run setroubleshoot:</p><pre><code>service messagebus restart
</code></pre><p>A really easy (and safe) test is to ask sshd to bind to a non-standard port. Simply define an additional port on in your <code>/etc/ssh/sshd_config</code> like this:</p><pre><code>Port 22
Port 222
</code></pre><p>When you restart sshd, it will bind to port 22 with success, but it won&rsquo;t be allowed to bind to port 222 (since that&rsquo;s blocked by SELinux as a non-standard port for the <code>ssh_port_t</code> port type). <strong>DON&rsquo;T WORRY!</strong> Your sshd server will still be listening on port 22. If you wait a moment, you&rsquo;ll get an e-mail (perhaps two) that not only notify you of the denial, but they make suggestions for how to fix it:</p><pre><code>SELinux is preventing /usr/sbin/sshd from name_bind access on the tcp_socket port 222.

*****  Plugin bind_ports (99.5 confidence) suggests  *************************

If you want to allow /usr/sbin/sshd to bind to network port 222
Then you need to modify the port type.
Do
# semanage port -a -t PORT_TYPE -p tcp 222
   where PORT_TYPE is one of the following: ...
</code></pre><p>For this particular example, the quick fix would be to run:</p><pre><code>semanage port -a -t ssh_port_t -p tcp 222
</code></pre><hr><p><em>Much of this post&rsquo;s information was gathered from the detailed documentation on <a href=http://fedoraproject.org/wiki/Docs/Drafts/SELinux/SETroubleShoot/UserFAQ>Fedora&rsquo;s setroubleshoot User&rsquo;s FAQ</a> as well as <a href=http://danwalsh.livejournal.com/20931.html>Dan Walsh&rsquo;s setroubleshoot blog post</a>.</em></p></div></article><hr><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://major.io/tags/centos/>centos</a></span>
<span class=tag><a href=https://major.io/tags/command-line/>command line</a></span>
<span class=tag><a href=https://major.io/tags/email/>email</a></span>
<span class=tag><a href=https://major.io/tags/fedora/>fedora</a></span>
<span class=tag><a href=https://major.io/tags/messagebus/>messagebus</a></span>
<span class=tag><a href=https://major.io/tags/red-hat/>red hat</a></span>
<span class=tag><a href=https://major.io/tags/security/>security</a></span>
<span class=tag><a href=https://major.io/tags/selinux/>selinux</a></span>
<span class=tag><a href=https://major.io/tags/server/>server</a></span>
<span class=tag><a href=https://major.io/tags/ssh/>ssh</a></span>
<span class=tag><a href=https://major.io/tags/sysadmin/>sysadmin</a></span>
<span class=tag><a href=https://major.io/tags/systemd/>systemd</a></span>
<span class=tag><a href=https://major.io/tags/yum/>yum</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-folder meta-icon"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg><span class=tag><a href=https://major.io/categories/blog-posts/>Blog Posts</a></span></p></div></main></div><footer class=footer><div class=footer__inner><div class=footer__content><span>&copy; 2021</span>
<span><a href=https://major.io>Major Hayden</a></span>
<span><a href=https://creativecommons.org/licenses/by-sa/2.0/ target=_blank rel=noopener>CC BY-SA 2.0</a></span><span><a href=https://major.io/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></span></div></div><div class=footer__inner><div class=footer__content><span>Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>Made with &#10084; by <a href=https://github.com/rhazdon>Djordje Atlialp</a></span></div></div></footer></div><script type=text/javascript src=../../../../bundle.min.e9f93b80e78a22e6f04cbb5f73e0f9c4ba60ff73a2a0ef85965c688f93dd1f2722a282e30e485603e4c65b1b346720e35f213435ec5556e196a97a68d097c80f.js integrity="sha512-6fk7gOeKIubwTLtfc+D5xLpg/3OioO+Fllxoj5PdHyciooLjDkhWA+TGWxs0ZyDjXyE0NexVVuGWqXpo0JfIDw=="></script></body></html>