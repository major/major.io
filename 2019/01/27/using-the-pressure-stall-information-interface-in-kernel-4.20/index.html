<!doctype html><html lang=en-us><head><meta http-equiv=x-clacks-overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://major.io/favicon.ico><title>Using the pressure stall information interface in kernel 4.20 | Major Hayden's Blog ðŸ¤ </title><meta name=title content="Using the pressure stall information interface in kernel 4.20"><meta name=description content="Fedora 29 now has kernel 4.20 available and it has lots of new features. One of the more interesting and easy to use features is the pressure stall information interface.
Load average We&rsquo;re all familiar with the load average measurement on Linux machines, even if the numbers do seem a bit cryptic:
$ w 10:55:46 up 11 min, 1 user, load average: 0.42, 0.39, 0.26 The numbers denote how many processes were active over the last one, five and 15 minutes."><meta name=keywords content="performance,fedora,linux,"><meta property="og:title" content="Using the pressure stall information interface in kernel 4.20"><meta property="og:description" content="Fedora 29 now has kernel 4.20 available and it has lots of new features. One of the more interesting and easy to use features is the pressure stall information interface.
Load average We&rsquo;re all familiar with the load average measurement on Linux machines, even if the numbers do seem a bit cryptic:
$ w 10:55:46 up 11 min, 1 user, load average: 0.42, 0.39, 0.26 The numbers denote how many processes were active over the last one, five and 15 minutes."><meta property="og:type" content="article"><meta property="og:url" content="https://major.io/2019/01/27/using-the-pressure-stall-information-interface-in-kernel-4.20/"><meta property="og:image" content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-01-27T00:00:00+00:00"><meta property="article:modified_time" content="2019-01-27T00:00:00+00:00"><meta property="og:site_name" content="Major Hayden's Blog ðŸ¤ "><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta name=twitter:title content="Using the pressure stall information interface in kernel 4.20"><meta name=twitter:description content="Fedora 29 now has kernel 4.20 available and it has lots of new features. One of the more interesting and easy to use features is the pressure stall information interface.
Load average We&rsquo;re all familiar with the load average measurement on Linux machines, even if the numbers do seem a bit cryptic:
$ w 10:55:46 up 11 min, 1 user, load average: 0.42, 0.39, 0.26 The numbers denote how many processes were active over the last one, five and 15 minutes."><meta name=twitter:site content="@mhayden"><meta itemprop=name content="Using the pressure stall information interface in kernel 4.20"><meta itemprop=description content="Fedora 29 now has kernel 4.20 available and it has lots of new features. One of the more interesting and easy to use features is the pressure stall information interface.
Load average We&rsquo;re all familiar with the load average measurement on Linux machines, even if the numbers do seem a bit cryptic:
$ w 10:55:46 up 11 min, 1 user, load average: 0.42, 0.39, 0.26 The numbers denote how many processes were active over the last one, five and 15 minutes."><meta itemprop=datePublished content="2019-01-27T00:00:00+00:00"><meta itemprop=dateModified content="2019-01-27T00:00:00+00:00"><meta itemprop=wordCount content="533"><meta itemprop=image content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta itemprop=keywords content="performance,fedora,linux,"><meta name=referrer content="no-referrer-when-downgrade"><style>body{font-family:Verdana,sans-serif;margin:auto;padding:20px;max-width:820px;text-align:left;background-color:#fff;word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:#444}h1,h2,h3,h4,h5,h6,strong,b{color:#222}a{color:#3273dc}.title{text-decoration:none;border:0}.title span{font-weight:400}nav a{margin-right:10px}textarea{width:100%;font-size:16px}input{font-size:16px}content{line-height:1.6}table{width:100%}img{max-width:100%}code{padding:2px 5px;background-color:#f2f2f2}pre code{color:#222;display:block;padding:20px;white-space:pre-wrap;font-size:14px}div.highlight code{background-color:unset;color:initial}blockquote{border-left:1px solid #999;color:#222;padding-left:20px;font-style:italic}footer{padding:25px;text-align:center}.helptext{color:#777;font-size:small}.errorlist{color:#eba613;font-size:small}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:#8b6fcb}@media(prefers-color-scheme:dark){body{background-color:#333;color:#ddd}h1,h2,h3,h4,h5,h6,strong,b{color:#eee}a{color:#8cc2dd}code{background-color:#777}pre code{color:#ddd}blockquote{color:#ccc}textarea,input{background-color:#252525;color:#ddd}.helptext{color:#aaa}}</style></head><body><header><a href=../../../../ class=title><h2>Major Hayden's Blog ðŸ¤ </h2></a><nav><a href=../../../../>Home</a>
<a href=../../../../ham-radio-faq>Ham Radio</a>
<a href=../../../../icanhazip-com-faq>icanhazip FAQ</a>
<a href=../../../../posts>Posts</a></nav><script async src=https://media.ethicalads.io/media/client/ethicalads.min.js></script><div class="adaptive raised" data-ea-publisher=major-io data-ea-type=text></div></header><main><h1>Using the pressure stall information interface in kernel 4.20</h1><i><time datetime=2019-01-27 pubdate>2019-01-27</time></i>
<content><p><img src=../../../../images/pressure_cooker.jpg alt=pressure_cooker></p><p>Fedora 29 now has kernel 4.20 available and it has <a href=https://kernelnewbies.org/Linux_4.20>lots of new features</a>.
One of the more interesting and easy to use features is the <a href=https://lwn.net/Articles/759658/>pressure stall
information</a> interface.</p><h2 id=load-average>Load average</h2><p>We&rsquo;re all familiar with the <a href=https://en.wikipedia.org/wiki/Load_(computing)>load average</a> measurement on Linux machines,
even if the numbers do seem a bit cryptic:</p><div class=highlight><pre style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>$ w
 10:55:46 up 11 min,  1 user,  load average: 0.42, 0.39, 0.26
</code></pre></div><p>The numbers denote how many processes were active over the last one, five and
15 minutes. In my case, I have a system with four cores. My numbers above
show that less than one process was active in the last set of intervals. That
means that my system isn&rsquo;t doing very much and processes are not waiting in
the queue.</p><p>However, if I begin compiling a kernel with eight threads (double my core
count), the numbers change dramatically:</p><div class=highlight><pre style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>$ w
 11:00:28 up 16 min,  1 user,  load average: 4.15, 1.89, 0.86
</code></pre></div><p>The one minute load average is now over four, which means some processes are
waiting to be served on the system. This makes sense because I am using eight
threads to compile a kernel on a system with four cores.</p><h2 id=more-detail>More detail</h2><p>We assume that the CPU is the limiting factor in the system since we know
that compiling a kernel takes lots of CPU time. We can verify (and quantify) that with the pressure stall information available in 4.20.</p><p>We start by taking a look in <code>/proc/pressure</code>:</p><div class=highlight><pre style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>$ head /proc/pressure/*
==&gt; /proc/pressure/cpu &lt;==
some avg10=71.37 avg60=57.25 avg300=23.83 total=100354487

==&gt; /proc/pressure/io &lt;==
some avg10=0.17 avg60=0.13 avg300=0.24 total=8101378
full avg10=0.00 avg60=0.01 avg300=0.16 total=5866706

==&gt; /proc/pressure/memory &lt;==
some avg10=0.00 avg60=0.00 avg300=0.00 total=0
full avg10=0.00 avg60=0.00 avg300=0.00 total=0
</code></pre></div><p>But what do these numbers mean? The shortest explanation is in the patch
itself:</p><blockquote><p>PSI aggregates and reports the overall wallclock time in which the
tasks in a system (or cgroup) wait for contended hardware resources.</p></blockquote><p>The numbers here are percentages, not time itself:</p><blockquote><p>The averages give the percentage of walltime in which one or more
tasks are delayed on the runqueue while another task has the
CPU. They&rsquo;re recent averages over 10s, 1m, 5m windows, so you can tell
short term trends from long term ones, similarly to the load average.</p></blockquote><p>We can try to apply some I/O pressure by making a big tarball of a kernel
source tree:</p><div class=highlight><pre style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>$ head /proc/pressure/*
==&gt; /proc/pressure/cpu &lt;==
some avg10=1.33 avg60=10.07 avg300=26.83 total=262389574

==&gt; /proc/pressure/io &lt;==
some avg10=40.53 avg60=13.27 avg300=3.46 total=20451978
full avg10=37.44 avg60=12.40 avg300=3.21 total=16659637

==&gt; /proc/pressure/memory &lt;==
some avg10=0.00 avg60=0.00 avg300=0.00 total=0
full avg10=0.00 avg60=0.00 avg300=0.00 total=0
</code></pre></div><p>The CPU is still under some stress here, but the I/O is now the limiting
factor.</p><p>The output also shows a <code>total=</code> number, and that is explained in the patch
as well:</p><blockquote><p>The total= value gives the absolute stall time in microseconds. This
allows detecting latency spikes that might be too short to sway the
running averages. It also allows custom time averaging in case the
10s/1m/5m windows aren&rsquo;t adequate for the usecase (or are too coarse
with future hardware).</p></blockquote><p>The total number can be helpful for machines that run for a long time,
especially when you graph them and you monitor them for trends.</p></content><p><a href=https://major.io/tags/performance/>#performance</a>
<a href=https://major.io/tags/fedora/>#fedora</a>
<a href=https://major.io/tags/linux/>#linux</a></p></main><footer><hr>CC-BY-SA 4.0 &#187;
Made with <a href=https://gohugo.io/>Hugo</a> &#187;
Theme based on <a href=https://github.com/janraasch/hugo-bearblog/>Hugo Ê•â€¢á´¥â€¢Ê” Bear</a><br></footer></body></html>