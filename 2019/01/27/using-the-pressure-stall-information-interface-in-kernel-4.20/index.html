<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="Major Hayden"><meta name=description content="Fedora 29 now has kernel 4.20 available and it has lots of new features. One of the more interesting and easy to use features is the pressure stall information interface.
Load average We&amp;rsquo;re all familiar with the load average measurement on Linux machines, even if the numbers do seem a bit cryptic:
$ w 10:55:46 up 11 min, 1 user, load average: 0.42, 0.39, 0.26 The numbers denote how many processes were active over the last one, five and 15 minutes."><meta name=keywords content=",performance,fedora,linux"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://major.io/2019/01/27/using-the-pressure-stall-information-interface-in-kernel-4.20/><title>Using the pressure stall information interface in kernel 4.20 :: Major Hayden ðŸ¤  â€” Words of wisdom from a social nerd</title><link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css rel=stylesheet type=text/css><link rel=stylesheet href=../../../../main.min.5dcefbf8102eb536dd3e2de53ffebfa58599ab2435c241a0db81728a5e015f2e.css><link rel=apple-touch-icon sizes=180x180 href=../../../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../../../favicon-16x16.png><link rel=manifest href=../../../../site.webmanifest><link rel=mask-icon href=../../../../safari-pinned-tab.svg color=#252627><link rel="shortcut icon" href=../../../../favicon.ico><meta name=msapplication-TileColor content="#252627"><meta name=theme-color content="#252627"><meta itemprop=name content="Using the pressure stall information interface in kernel 4.20"><meta itemprop=description content="Fedora 29 now has kernel 4.20 available and it has lots of new features. One of the more interesting and easy to use features is the pressure stall information interface.
Load average We&rsquo;re all familiar with the load average measurement on Linux machines, even if the numbers do seem a bit cryptic:
$ w 10:55:46 up 11 min, 1 user, load average: 0.42, 0.39, 0.26 The numbers denote how many processes were active over the last one, five and 15 minutes."><meta itemprop=datePublished content="2019-01-27T00:00:00+00:00"><meta itemprop=dateModified content="2019-01-27T00:00:00+00:00"><meta itemprop=wordCount content="533"><meta itemprop=image content="https://major.io"><meta itemprop=keywords content="performance,fedora,linux,"><meta property="article:section" content="Blog Posts"><meta property="article:published_time" content="2019-01-27 00:00:00 +0000 UTC"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Using the pressure stall information interface in kernel 4.20 :: Major Hayden ðŸ¤ "><meta name=twitter:description content><meta name=twitter:site content="https://major.io"><meta name=twitter:creator content="Major Hayden"><meta name=twitter:image content><style type=text/css>html{letter-spacing:unset}</style></head><body class=dark-theme><div class=container><header class=header><span class=header__inner><a href=../../../../ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>$ echo major.io</span>
<span class=logo__cursor style=visibility:hidden></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=https://major.io/ham-radio-faq>hamradio</a></li><li><a href=https://major.io/icanhazip-com-faq>icanhazip</a></li><li><a href=https://major.io/posts/>posts</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41C32.4934 41 41 32.4934 41 22 41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href=https://major.io/2019/01/27/using-the-pressure-stall-information-interface-in-kernel-4.20/>Using the pressure stall information interface in kernel 4.20</a></h2><div class=post-content><p><img src=../../../../images/pressure_cooker.jpg alt=pressure_cooker></p><p>Fedora 29 now has kernel 4.20 available and it has <a href=https://kernelnewbies.org/Linux_4.20>lots of new features</a>.
One of the more interesting and easy to use features is the <a href=https://lwn.net/Articles/759658/>pressure stall
information</a> interface.</p><h2 id=load-average>Load average</h2><p>We&rsquo;re all familiar with the <a href=https://en.wikipedia.org/wiki/Load_(computing)>load average</a> measurement on Linux machines,
even if the numbers do seem a bit cryptic:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>$ w
 10:55:46 up 11 min,  1 user,  load average: 0.42, 0.39, 0.26
</code></pre></div><p>The numbers denote how many processes were active over the last one, five and
15 minutes. In my case, I have a system with four cores. My numbers above
show that less than one process was active in the last set of intervals. That
means that my system isn&rsquo;t doing very much and processes are not waiting in
the queue.</p><p>However, if I begin compiling a kernel with eight threads (double my core
count), the numbers change dramatically:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>$ w
 11:00:28 up 16 min,  1 user,  load average: 4.15, 1.89, 0.86
</code></pre></div><p>The one minute load average is now over four, which means some processes are
waiting to be served on the system. This makes sense because I am using eight
threads to compile a kernel on a system with four cores.</p><h2 id=more-detail>More detail</h2><p>We assume that the CPU is the limiting factor in the system since we know
that compiling a kernel takes lots of CPU time. We can verify (and quantify) that with the pressure stall information available in 4.20.</p><p>We start by taking a look in <code>/proc/pressure</code>:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>$ head /proc/pressure/*
==&gt; /proc/pressure/cpu &lt;==
some avg10=71.37 avg60=57.25 avg300=23.83 total=100354487

==&gt; /proc/pressure/io &lt;==
some avg10=0.17 avg60=0.13 avg300=0.24 total=8101378
full avg10=0.00 avg60=0.01 avg300=0.16 total=5866706

==&gt; /proc/pressure/memory &lt;==
some avg10=0.00 avg60=0.00 avg300=0.00 total=0
full avg10=0.00 avg60=0.00 avg300=0.00 total=0
</code></pre></div><p>But what do these numbers mean? The shortest explanation is in the patch
itself:</p><blockquote><p>PSI aggregates and reports the overall wallclock time in which the
tasks in a system (or cgroup) wait for contended hardware resources.</p></blockquote><p>The numbers here are percentages, not time itself:</p><blockquote><p>The averages give the percentage of walltime in which one or more
tasks are delayed on the runqueue while another task has the
CPU. They&rsquo;re recent averages over 10s, 1m, 5m windows, so you can tell
short term trends from long term ones, similarly to the load average.</p></blockquote><p>We can try to apply some I/O pressure by making a big tarball of a kernel
source tree:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>$ head /proc/pressure/*
==&gt; /proc/pressure/cpu &lt;==
some avg10=1.33 avg60=10.07 avg300=26.83 total=262389574

==&gt; /proc/pressure/io &lt;==
some avg10=40.53 avg60=13.27 avg300=3.46 total=20451978
full avg10=37.44 avg60=12.40 avg300=3.21 total=16659637

==&gt; /proc/pressure/memory &lt;==
some avg10=0.00 avg60=0.00 avg300=0.00 total=0
full avg10=0.00 avg60=0.00 avg300=0.00 total=0
</code></pre></div><p>The CPU is still under some stress here, but the I/O is now the limiting
factor.</p><p>The output also shows a <code>total=</code> number, and that is explained in the patch
as well:</p><blockquote><p>The total= value gives the absolute stall time in microseconds. This
allows detecting latency spikes that might be too short to sway the
running averages. It also allows custom time averaging in case the
10s/1m/5m windows aren&rsquo;t adequate for the usecase (or are too coarse
with future hardware).</p></blockquote><p>The total number can be helpful for machines that run for a long time,
especially when you graph them and you monitor them for trends.</p></div></article><hr><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://major.io/tags/performance>performance</a></span><span class=tag><a href=https://major.io/tags/fedora>fedora</a></span><span class=tag><a href=https://major.io/tags/linux>linux</a></span></p></div></main></div><footer class=footer><div class=footer__inner><div class=footer__content><span>&copy; 2021</span>
<span><a href=https://major.io>Major Hayden</a></span>
<span><a href=https://creativecommons.org/licenses/by-sa/2.0/ target=_blank rel=noopener>CC BY-SA 2.0</a></span>
<span><a href=https://major.io/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></span></div></div><div class=footer__inner><div class=footer__content><span>Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>Made with &#10084; by <a href=https://github.com/rhazdon>rhazdon</a></span></div></div></footer></div><script type=text/javascript src=../../../../bundle.min.2d5469329143160ae2456a69c3c76dc2d0a3b212b46afe291a51bd68650ed6f8697e001dab54f1c272c77ce08092a8c55e5bb4314e0ee334aab4b927ec896638.js integrity="sha512-LVRpMpFDFgriRWppw8dtwtCjshK0av4pGlG9aGUO1vhpfgAdq1TxwnLHfOCAkqjFXlu0MU4O4zSqtLkn7IlmOA=="></script></body></html>