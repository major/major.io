<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="Major Hayden"><meta name=description content="The Home Assistant project provides a great open source way to get started with home automtion that can be entirely self-contained within your home. It already has plenty of integrations with external services, but it can also monitor Z-Wave devices at your home or office.
Here are my devices:
 Monoprice Z-Wave Garade Door Sensor Aeotec Z-Stick Gen5 (ZW090) Fedora Linux server with Docker installed  Install the Z-Wave stick Start by plugging the Z-Stick into your Linux server."><meta name=keywords content=",docker,homeassistant,fedora,security"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://major.io/2019/01/14/running-home-assistant-in-a-docker-container-with-zwave-usb-stick/><title>Running Home Assistant in a Docker container with a Z-Wave USB stick :: Major Hayden ðŸ¤  â€” Words of wisdom from a social nerd</title><link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css rel=stylesheet type=text/css><link rel=stylesheet href=../../../../main.89fa80e2143f71bd5c96a7c94e531dec3276a367e22f87e74a76026ab64680bf.css><link rel=apple-touch-icon sizes=180x180 href=../../../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../../../favicon-16x16.png><link rel=manifest href=../../../../site.webmanifest><link rel=mask-icon href=../../../../safari-pinned-tab.svg color=#252627><link rel="shortcut icon" href=../../../../favicon.ico><meta name=msapplication-TileColor content="#252627"><meta name=theme-color content="#252627"><meta itemprop=name content="Running Home Assistant in a Docker container with a Z-Wave USB stick"><meta itemprop=description content="The Home Assistant project provides a great open source way to get started with home automtion that can be entirely self-contained within your home. It already has plenty of integrations with external services, but it can also monitor Z-Wave devices at your home or office.
Here are my devices:
 Monoprice Z-Wave Garade Door Sensor Aeotec Z-Stick Gen5 (ZW090) Fedora Linux server with Docker installed  Install the Z-Wave stick Start by plugging the Z-Stick into your Linux server."><meta itemprop=datePublished content="2019-01-14T00:00:00+00:00"><meta itemprop=dateModified content="2019-01-14T00:00:00+00:00"><meta itemprop=wordCount content="645"><meta itemprop=image content="https://major.io"><meta itemprop=keywords content="docker,homeassistant,fedora,security,"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://major.io"><meta name=twitter:title content="Running Home Assistant in a Docker container with a Z-Wave USB stick"><meta name=twitter:description content="The Home Assistant project provides a great open source way to get started with home automtion that can be entirely self-contained within your home. It already has plenty of integrations with external services, but it can also monitor Z-Wave devices at your home or office.
Here are my devices:
 Monoprice Z-Wave Garade Door Sensor Aeotec Z-Stick Gen5 (ZW090) Fedora Linux server with Docker installed  Install the Z-Wave stick Start by plugging the Z-Stick into your Linux server."><meta name=twitter:site content="@mhayden"><meta property="article:section" content="Blog Posts"><meta property="article:published_time" content="2019-01-14 00:00:00 +0000 UTC"><style type=text/css>html{letter-spacing:unset}</style></head><body><div class=container><header class=header><span class=header__inner><a href=../../../../ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>$ echo major.io</span>
<span class=logo__cursor style=visibility:hidden></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=../../../../ham-radio-faq>hamradio</a></li><li><a href=../../../../icanhazip-com-faq>icanhazip</a></li><li><a href=../../../../posts/>posts</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href=https://major.io/2019/01/14/running-home-assistant-in-a-docker-container-with-zwave-usb-stick/>Running Home Assistant in a Docker container with a Z-Wave USB stick</a></h2><div class=post-content><p>The <a href=https://www.home-assistant.io/>Home Assistant</a> project provides a great open source way to get started
with home automtion that can be entirely self-contained within your home. It
already has plenty of <a href=https://www.home-assistant.io/components/>integrations</a> with external services, but it can also
monitor <a href=https://en.wikipedia.org/wiki/Z-Wave>Z-Wave</a> devices at your home or office.</p><p>Here are my devices:</p><ul><li><a href=https://www.amazon.com/Monoprice-Z-Wave-Garage-Door-Sensor/dp/B00V5IQ8E8>Monoprice Z-Wave Garade Door Sensor</a></li><li><a href=https://aeotec.com/z-wave-usb-stick>Aeotec Z-Stick Gen5 (ZW090)</a></li><li>Fedora Linux server with Docker installed</li></ul><h2 id=install-the-z-wave-stick>Install the Z-Wave stick</h2><p>Start by plugging the Z-Stick into your Linux server. Run <code>lsusb</code> and it should appear in the list:</p><pre><code># lsusb | grep Z-Stick
Bus 003 Device 006: ID 0658:0200 Sigma Designs, Inc. Aeotec Z-Stick Gen5 (ZW090) - UZB
</code></pre><p>The system journal should also tell you which TTY is assigned to the USB
stick (run <code>journalctl --boot</code> and search for <code>ACM</code>):</p><pre><code>kernel: usb 3-3.2: USB disconnect, device number 4
kernel: usb 3-1: new full-speed USB device number 6 using xhci_hcd
kernel: usb 3-1: New USB device found, idVendor=0658, idProduct=0200, bcdDevice= 0.00
kernel: usb 3-1: New USB device strings: Mfr=0, Product=0, SerialNumber=0
kernel: cdc_acm 3-1:1.0: ttyACM0: USB ACM device
kernel: usbcore: registered new interface driver cdc_acm
kernel: cdc_acm: USB Abstract Control Model driver for USB modems and ISDN adapters
</code></pre><p>In my case, my device is <code>/dev/ttyACM0</code>. If you have other serial devices
attached to your system, your Z-Stick may show up as <code>ttyACM1</code> or <code>ttyACM2</code>.</p><h2 id=using-z-wave-in-the-docker-container>Using Z-Wave in the Docker container</h2><p>If you use <code>docker-compose</code>, simply add a <code>devices</code> section to your existing
YAML file:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#268bd2>version</span>: <span style=color:#2aa198>&#39;2&#39;</span>
<span style=color:#268bd2>services</span>:
  <span style=color:#268bd2>home-assistant</span>:
    <span style=color:#268bd2>ports</span>:
      - <span style=color:#2aa198>&#34;8123:8123/tcp&#34;</span>
    <span style=color:#268bd2>network_mode</span>: <span style=color:#2aa198>&#34;host&#34;</span>
    <span style=color:#268bd2>devices</span>:
      - /dev/ttyACM0
    <span style=color:#268bd2>volumes</span>:
      - /etc/localtime:/etc/localtime:ro
      - /mnt/raid/hass/:/config:Z
    <span style=color:#268bd2>image</span>: homeassistant/home-assistant
    <span style=color:#268bd2>restart</span>: always
</code></pre></div><p>You can add the device to manual <code>docker run</code> commands by adding <code>--device /dev/ttyACM0</code> to your existing command line.</p><h2 id=pairing>Pairing</h2><p>For this step, always refer to the instructions that came with your Z-Wave
device since some require different pairing steps. In my case, I installed
the battery, pressed the button inside the sensor, and paired the device:</p><ul><li>Go to the Home Assistant web interface</li><li>Click <strong>Configuration</strong> on the left</li><li>Click <strong>Z-Wave</strong> on the right</li><li>Click <strong>Add Node</strong> and follow the steps on screen</li></ul><h2 id=understanding-how-the-sensor-works>Understanding how the sensor works</h2><p>Now that the sensor has been added, we need to understand how it works. One
of the entities the sensor provides is an <code>alarm_level</code>. It has two possible
values:</p><ul><li><code>0</code>: the sensor is tilted vertically (garage door is closed)</li><li><code>255</code>: the sensor is tilted horizontally (garage door is open)</li></ul><p>If the sensor changes from <code>0</code> to <code>255</code>, then someone opened the garage door.
Closing the door would result in the sensor changing from <code>255</code> to <code>0</code>.</p><h2 id=adding-automation>Adding automation</h2><p>Let&rsquo;s add automation to let us know when the door is open:</p><ul><li>Click <strong>Configuration</strong> on the left</li><li>Click <strong>Automation</strong> on the right</li><li>Click the plus (+) at the bottom right</li><li>Set a good name (like &ldquo;Garage door open&rdquo;)</li><li>Under triggers, look for <code>Vision ZG8101 Garage Door Detector Alarm Level</code>
and select it</li><li>Set <strong>From</strong> to <code>0</code></li><li>Set <strong>To</strong> to <code>255</code></li><li>Leave the <strong>For</strong> spot empty</li></ul><p>Now that we can detect the garage door being open, we need a notification
action. I love <a href=https://www.pushbullet.com/>PushBullet</a> and I have an action set up for PushBullet
notifications already. Here&rsquo;s how to use an action:</p><ul><li>Select <strong>Call Service</strong> for <strong>Action Type</strong> in the <strong>Actions</strong> section</li><li>Select a service to call when the trigger occurs</li><li><strong>Service data</strong> should contain the json that contains the notification
message and title</li></ul><p>Here&rsquo;s an example of my service data:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
  <span style=color:#268bd2>&#34;message&#34;</span>: <span style=color:#2aa198>&#34;Someone opened the garage door at home.&#34;</span>,
  <span style=color:#268bd2>&#34;title&#34;</span>: <span style=color:#2aa198>&#34;Garage door opened&#34;</span>
}
</code></pre></div><p>Press the orange and white save icon at the bottom right and you are ready to
go! You can tilt the sensor in your hand to test it or attach it to your
garage door and test it there.</p><p>If you want to know when the garage door is closed, follow the same steps
above, but use <code>255</code> for <strong>From</strong> and <code>0</code> for <strong>To</strong>.</p></div></article><hr><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://major.io/tags/docker/>docker</a></span>
<span class=tag><a href=https://major.io/tags/homeassistant/>homeassistant</a></span>
<span class=tag><a href=https://major.io/tags/fedora/>fedora</a></span>
<span class=tag><a href=https://major.io/tags/security/>security</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-folder meta-icon"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg><span class=tag><a href=https://major.io/categories/blog-posts/>Blog Posts</a></span></p></div></main></div><footer class=footer><div class=footer__inner><div class=footer__content><span>&copy; 2021</span>
<span><a href=https://major.io>Major Hayden</a></span>
<span><a href=https://creativecommons.org/licenses/by-sa/2.0/ target=_blank rel=noopener>CC BY-SA 2.0</a></span><span><a href=https://major.io/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></span></div></div><div class=footer__inner><div class=footer__content><span>Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>Made with &#10084; by <a href=https://github.com/rhazdon>Djordje Atlialp</a></span></div></div></footer></div><script type=text/javascript src=../../../../bundle.min.e9f93b80e78a22e6f04cbb5f73e0f9c4ba60ff73a2a0ef85965c688f93dd1f2722a282e30e485603e4c65b1b346720e35f213435ec5556e196a97a68d097c80f.js integrity="sha512-6fk7gOeKIubwTLtfc+D5xLpg/3OioO+Fllxoj5PdHyciooLjDkhWA+TGWxs0ZyDjXyE0NexVVuGWqXpo0JfIDw=="></script></body></html>