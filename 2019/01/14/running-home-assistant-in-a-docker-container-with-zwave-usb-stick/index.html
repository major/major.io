<!doctype html><html lang=en-us><head><meta http-equiv=x-clacks-overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://major.io/favicon.ico><title>Running Home Assistant in a Docker container with a Z-Wave USB stick | Major Hayden's Blog ðŸ¤ </title><meta name=title content="Running Home Assistant in a Docker container with a Z-Wave USB stick"><meta name=description content="The Home Assistant project provides a great open source way to get started with home automtion that can be entirely self-contained within your home. It already has plenty of integrations with external services, but it can also monitor Z-Wave devices at your home or office.
Here are my devices:
 Monoprice Z-Wave Garade Door Sensor Aeotec Z-Stick Gen5 (ZW090) Fedora Linux server with Docker installed  Install the Z-Wave stick Start by plugging the Z-Stick into your Linux server."><meta name=keywords content="docker,homeassistant,fedora,security,"><meta property="og:title" content="Running Home Assistant in a Docker container with a Z-Wave USB stick"><meta property="og:description" content="The Home Assistant project provides a great open source way to get started with home automtion that can be entirely self-contained within your home. It already has plenty of integrations with external services, but it can also monitor Z-Wave devices at your home or office.
Here are my devices:
 Monoprice Z-Wave Garade Door Sensor Aeotec Z-Stick Gen5 (ZW090) Fedora Linux server with Docker installed  Install the Z-Wave stick Start by plugging the Z-Stick into your Linux server."><meta property="og:type" content="article"><meta property="og:url" content="https://major.io/2019/01/14/running-home-assistant-in-a-docker-container-with-zwave-usb-stick/"><meta property="og:image" content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-01-14T00:00:00+00:00"><meta property="article:modified_time" content="2019-01-14T00:00:00+00:00"><meta property="og:site_name" content="Major Hayden's Blog ðŸ¤ "><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta name=twitter:title content="Running Home Assistant in a Docker container with a Z-Wave USB stick"><meta name=twitter:description content="The Home Assistant project provides a great open source way to get started with home automtion that can be entirely self-contained within your home. It already has plenty of integrations with external services, but it can also monitor Z-Wave devices at your home or office.
Here are my devices:
 Monoprice Z-Wave Garade Door Sensor Aeotec Z-Stick Gen5 (ZW090) Fedora Linux server with Docker installed  Install the Z-Wave stick Start by plugging the Z-Stick into your Linux server."><meta name=twitter:site content="@mhayden"><meta itemprop=name content="Running Home Assistant in a Docker container with a Z-Wave USB stick"><meta itemprop=description content="The Home Assistant project provides a great open source way to get started with home automtion that can be entirely self-contained within your home. It already has plenty of integrations with external services, but it can also monitor Z-Wave devices at your home or office.
Here are my devices:
 Monoprice Z-Wave Garade Door Sensor Aeotec Z-Stick Gen5 (ZW090) Fedora Linux server with Docker installed  Install the Z-Wave stick Start by plugging the Z-Stick into your Linux server."><meta itemprop=datePublished content="2019-01-14T00:00:00+00:00"><meta itemprop=dateModified content="2019-01-14T00:00:00+00:00"><meta itemprop=wordCount content="645"><meta itemprop=image content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta itemprop=keywords content="docker,homeassistant,fedora,security,"><meta name=referrer content="no-referrer-when-downgrade"><style>body{font-family:Verdana,sans-serif;margin:auto;padding:20px;max-width:820px;text-align:left;background-color:#fff;word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:#444}h1,h2,h3,h4,h5,h6,strong,b{color:#222}a{color:#3273dc}.title{text-decoration:none;border:0}.title span{font-weight:400}nav a{margin-right:10px}textarea{width:100%;font-size:16px}input{font-size:16px}content{line-height:1.6}table{width:100%}img{max-width:100%}code{padding:2px 5px;background-color:#f2f2f2}pre code{color:#222;display:block;padding:20px;white-space:pre-wrap;font-size:14px}div.highlight code{background-color:unset;color:initial}blockquote{border-left:1px solid #999;color:#222;padding-left:20px;font-style:italic}footer{padding:25px;text-align:center}.helptext{color:#777;font-size:small}.errorlist{color:#eba613;font-size:small}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:#8b6fcb}@media(prefers-color-scheme:dark){body{background-color:#333;color:#ddd}h1,h2,h3,h4,h5,h6,strong,b{color:#eee}a{color:#8cc2dd}code{background-color:#777}pre code{color:#ddd}blockquote{color:#ccc}textarea,input{background-color:#252525;color:#ddd}.helptext{color:#aaa}}</style></head><body><header><a href=../../../../ class=title><h2>Major Hayden's Blog ðŸ¤ </h2></a><nav><a href=../../../../>Home</a>
<a href=../../../../ham-radio-faq>Ham Radio</a>
<a href=../../../../icanhazip-com-faq>icanhazip FAQ</a>
<a href=../../../../posts>Posts</a></nav></header><main><h1>Running Home Assistant in a Docker container with a Z-Wave USB stick</h1><i><time datetime=2019-01-14 pubdate>2019-01-14</time></i>
<content><p>The <a href=https://www.home-assistant.io/>Home Assistant</a> project provides a great open source way to get started
with home automtion that can be entirely self-contained within your home. It
already has plenty of <a href=https://www.home-assistant.io/components/>integrations</a> with external services, but it can also
monitor <a href=https://en.wikipedia.org/wiki/Z-Wave>Z-Wave</a> devices at your home or office.</p><p>Here are my devices:</p><ul><li><a href=https://www.amazon.com/Monoprice-Z-Wave-Garage-Door-Sensor/dp/B00V5IQ8E8>Monoprice Z-Wave Garade Door Sensor</a></li><li><a href=https://aeotec.com/z-wave-usb-stick>Aeotec Z-Stick Gen5 (ZW090)</a></li><li>Fedora Linux server with Docker installed</li></ul><h2 id=install-the-z-wave-stick>Install the Z-Wave stick</h2><p>Start by plugging the Z-Stick into your Linux server. Run <code>lsusb</code> and it should appear in the list:</p><pre><code># lsusb | grep Z-Stick
Bus 003 Device 006: ID 0658:0200 Sigma Designs, Inc. Aeotec Z-Stick Gen5 (ZW090) - UZB
</code></pre><p>The system journal should also tell you which TTY is assigned to the USB
stick (run <code>journalctl --boot</code> and search for <code>ACM</code>):</p><pre><code>kernel: usb 3-3.2: USB disconnect, device number 4
kernel: usb 3-1: new full-speed USB device number 6 using xhci_hcd
kernel: usb 3-1: New USB device found, idVendor=0658, idProduct=0200, bcdDevice= 0.00
kernel: usb 3-1: New USB device strings: Mfr=0, Product=0, SerialNumber=0
kernel: cdc_acm 3-1:1.0: ttyACM0: USB ACM device
kernel: usbcore: registered new interface driver cdc_acm
kernel: cdc_acm: USB Abstract Control Model driver for USB modems and ISDN adapters
</code></pre><p>In my case, my device is <code>/dev/ttyACM0</code>. If you have other serial devices
attached to your system, your Z-Stick may show up as <code>ttyACM1</code> or <code>ttyACM2</code>.</p><h2 id=using-z-wave-in-the-docker-container>Using Z-Wave in the Docker container</h2><p>If you use <code>docker-compose</code>, simply add a <code>devices</code> section to your existing
YAML file:</p><div class=highlight><pre style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#268bd2;font-weight:700>version</span>: <span style=color:#2aa198>&#39;2&#39;</span>
<span style=color:#268bd2;font-weight:700>services</span>:
  <span style=color:#268bd2;font-weight:700>home-assistant</span>:
    <span style=color:#268bd2;font-weight:700>ports</span>:
      - <span style=color:#2aa198>&#34;8123:8123/tcp&#34;</span>
    <span style=color:#268bd2;font-weight:700>network_mode</span>: <span style=color:#2aa198>&#34;host&#34;</span>
    <span style=color:#268bd2;font-weight:700>devices</span>:
      - <span style=color:#2aa198>/dev/ttyACM0</span>
    <span style=color:#268bd2;font-weight:700>volumes</span>:
      - <span style=color:#2aa198>/etc/localtime:/etc/localtime:ro</span>
      - <span style=color:#2aa198>/mnt/raid/hass/:/config:Z</span>
    <span style=color:#268bd2;font-weight:700>image</span>: <span style=color:#2aa198>homeassistant/home-assistant</span>
    <span style=color:#268bd2;font-weight:700>restart</span>: <span style=color:#2aa198>always</span>
</code></pre></div><p>You can add the device to manual <code>docker run</code> commands by adding <code>--device /dev/ttyACM0</code> to your existing command line.</p><h2 id=pairing>Pairing</h2><p>For this step, always refer to the instructions that came with your Z-Wave
device since some require different pairing steps. In my case, I installed
the battery, pressed the button inside the sensor, and paired the device:</p><ul><li>Go to the Home Assistant web interface</li><li>Click <strong>Configuration</strong> on the left</li><li>Click <strong>Z-Wave</strong> on the right</li><li>Click <strong>Add Node</strong> and follow the steps on screen</li></ul><h2 id=understanding-how-the-sensor-works>Understanding how the sensor works</h2><p>Now that the sensor has been added, we need to understand how it works. One
of the entities the sensor provides is an <code>alarm_level</code>. It has two possible
values:</p><ul><li><code>0</code>: the sensor is tilted vertically (garage door is closed)</li><li><code>255</code>: the sensor is tilted horizontally (garage door is open)</li></ul><p>If the sensor changes from <code>0</code> to <code>255</code>, then someone opened the garage door.
Closing the door would result in the sensor changing from <code>255</code> to <code>0</code>.</p><h2 id=adding-automation>Adding automation</h2><p>Let&rsquo;s add automation to let us know when the door is open:</p><ul><li>Click <strong>Configuration</strong> on the left</li><li>Click <strong>Automation</strong> on the right</li><li>Click the plus (+) at the bottom right</li><li>Set a good name (like &ldquo;Garage door open&rdquo;)</li><li>Under triggers, look for <code>Vision ZG8101 Garage Door Detector Alarm Level</code>
and select it</li><li>Set <strong>From</strong> to <code>0</code></li><li>Set <strong>To</strong> to <code>255</code></li><li>Leave the <strong>For</strong> spot empty</li></ul><p>Now that we can detect the garage door being open, we need a notification
action. I love <a href=https://www.pushbullet.com/>PushBullet</a> and I have an action set up for PushBullet
notifications already. Here&rsquo;s how to use an action:</p><ul><li>Select <strong>Call Service</strong> for <strong>Action Type</strong> in the <strong>Actions</strong> section</li><li>Select a service to call when the trigger occurs</li><li><strong>Service data</strong> should contain the json that contains the notification
message and title</li></ul><p>Here&rsquo;s an example of my service data:</p><div class=highlight><pre style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
  <span style=color:#268bd2;font-weight:700>&#34;message&#34;</span>: <span style=color:#2aa198>&#34;Someone opened the garage door at home.&#34;</span>,
  <span style=color:#268bd2;font-weight:700>&#34;title&#34;</span>: <span style=color:#2aa198>&#34;Garage door opened&#34;</span>
}
</code></pre></div><p>Press the orange and white save icon at the bottom right and you are ready to
go! You can tilt the sensor in your hand to test it or attach it to your
garage door and test it there.</p><p>If you want to know when the garage door is closed, follow the same steps
above, but use <code>255</code> for <strong>From</strong> and <code>0</code> for <strong>To</strong>.</p></content><p><a href=https://major.io/tags/docker/>#docker</a>
<a href=https://major.io/tags/homeassistant/>#homeassistant</a>
<a href=https://major.io/tags/fedora/>#fedora</a>
<a href=https://major.io/tags/security/>#security</a></p></main><footer><script async src=https://media.ethicalads.io/media/client/ethicalads.min.js></script><div data-ea-publisher=major-io data-ea-type=text></div><hr>CC-BY-SA 4.0 &#187;
Made with <a href=https://gohugo.io/>Hugo</a> &#187;
Theme based on <a href=https://github.com/janraasch/hugo-bearblog/>Hugo Ê•â€¢á´¥â€¢Ê” Bear</a><br></footer></body></html>