<!doctype html><html lang=en-us><head><meta http-equiv=x-clacks-overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://major.io/favicon.ico><title>Install Chromium with VAAPI on Fedora 30 | Major Hayden's Blog ðŸ¤ </title><meta name=title content="Install Chromium with VAAPI on Fedora 30"><meta name=description content="Lower your CPU usage and increase battery life when you watch certain videos by using Chromium with VAAPI support."><meta name=keywords content="chromium,fedora,linux,"><meta property="og:title" content="Install Chromium with VAAPI on Fedora 30"><meta property="og:description" content="Lower your CPU usage and increase battery life when you watch certain videos by using Chromium with VAAPI support."><meta property="og:type" content="article"><meta property="og:url" content="https://major.io/2019/10/20/install-chromium-with-vaapi-on-fedora-30/"><meta property="og:image" content="https://major.io/images/2019-10-20-film.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-10-20T00:00:00+00:00"><meta property="article:modified_time" content="2019-10-20T00:00:00+00:00"><meta property="og:site_name" content="Major Hayden's Blog ðŸ¤ "><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://major.io/images/2019-10-20-film.jpg"><meta name=twitter:title content="Install Chromium with VAAPI on Fedora 30"><meta name=twitter:description content="Lower your CPU usage and increase battery life when you watch certain videos by using Chromium with VAAPI support."><meta name=twitter:site content="@mhayden"><meta itemprop=name content="Install Chromium with VAAPI on Fedora 30"><meta itemprop=description content="Lower your CPU usage and increase battery life when you watch certain videos by using Chromium with VAAPI support."><meta itemprop=datePublished content="2019-10-20T00:00:00+00:00"><meta itemprop=dateModified content="2019-10-20T00:00:00+00:00"><meta itemprop=wordCount content="836"><meta itemprop=image content="https://major.io/images/2019-10-20-film.jpg"><meta itemprop=keywords content="chromium,fedora,linux,"><meta name=referrer content="no-referrer-when-downgrade"><style>body{font-family:Verdana,sans-serif;margin:auto;padding:20px;max-width:820px;text-align:left;background-color:#fff;word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:#444}h1,h2,h3,h4,h5,h6,strong,b{color:#222}a{color:#3273dc}.title{text-decoration:none;border:0}.title span{font-weight:400}nav a{margin-right:10px}textarea{width:100%;font-size:16px}input{font-size:16px}content{line-height:1.6}table{width:100%}img{max-width:100%}code{padding:2px 5px;background-color:#f2f2f2}pre code{color:#222;display:block;padding:20px;white-space:pre-wrap;font-size:14px}div.highlight code{background-color:unset;color:initial}blockquote{border-left:1px solid #999;color:#222;padding-left:20px;font-style:italic}footer{padding:25px;text-align:center}.helptext{color:#777;font-size:small}.errorlist{color:#eba613;font-size:small}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:#8b6fcb}@media(prefers-color-scheme:dark){body{background-color:#333;color:#ddd}h1,h2,h3,h4,h5,h6,strong,b{color:#eee}a{color:#8cc2dd}code{background-color:#777}pre code{color:#ddd}blockquote{color:#ccc}textarea,input{background-color:#252525;color:#ddd}.helptext{color:#aaa}}</style></head><body><header><a href=../../../../ class=title><h2>Major Hayden's Blog ðŸ¤ </h2></a><nav><a href=../../../../>Home</a>
<a href=../../../../ham-radio-faq>Ham Radio</a>
<a href=../../../../icanhazip-com-faq>icanhazip FAQ</a>
<a href=../../../../posts>Posts</a></nav><script async src=https://media.ethicalads.io/media/client/ethicalads.min.js></script><div data-ea-publisher=major-io data-ea-type=text></div></header><main><h1>Install Chromium with VAAPI on Fedora 30</h1><i><time datetime=2019-10-20 pubdate>2019-10-20</time></i>
<content><p><img src=../../../../images/2019-10-20-film.jpg alt=film></p><p><em><strong>UPDATE:</strong></em> <em>The <code>chromium-vaapi</code> package is now <code>chromium-freeworld</code>.
This post was updated on 2019-11-06 to include the change. See the end of the
post for the update steps.</em></p><p>If you use a web browser to watch videos on a laptop, you&rsquo;ve probably noticed
that some videos play without much impact on the battery. Other videos cause
the fans to spin wildly and your battery life plummets.</p><p>Intel designed a specification called <a href=https://en.wikipedia.org/wiki/Video_Acceleration_API>VA API</a>, often called <em>VAAPI</em> (without
the space), and it offers up device drivers to applications running on your
system. It provides a pathway for those applications to access certain parts of
the graphics processing hardware directly. This increases performance, lowers
CPU usage, and increases battery life.</p><p>In this post, you will learn how to get VAAPI working on your Fedora 30 system
and how to use it along with a Chromium build that has VAAPI patches already
included. There are some DRM-related workarounds as well toward the end.</p><p><em>Note: Keep in mind that some videos are in formats that are difficult to
accelerate with a GPU and some applications support acceleration with some
formats but not others. You may find that your favorite site still uses the
same amount of CPU as it did before you completed this guide.</em> ðŸ˜¢</p><h2 id=getting-started-with-vaapi>Getting started with VAAPI</h2><p>You will need a few packages before you get started, and some of these depend
on the type of GPU that is present in your system. In my case, I&rsquo;m on a 4th
generation Lenovo X1 Carbon, and it has an Skylake GPU:</p><div class=highlight><pre style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>$ lspci | grep VGA
00:02.0 VGA compatible controller: Intel Corporation Skylake GT2 [HD Graphics 520] (rev 07)
</code></pre></div><p>Fedora 30 has quite a few VAAPI packages available:</p><div class=highlight><pre style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>$ sudo dnf list all | grep libva | awk &#39;{print $1}&#39;
libva.x86_64
libva-intel-driver.x86_64
libva-intel-hybrid-driver.x86_64
libva-utils.x86_64
libva-vdpau-driver.x86_64
libva.i686
libva-devel.i686
libva-devel.x86_64
libva-intel-driver.i686
libva-intel-hybrid-driver.i686
libva-vdpau-driver.i686
</code></pre></div><p>My Intel GPU requires these packages:</p><div class=highlight><pre style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>$ sudo dnf install libva libva-intel-driver \
    libva-vdpau-driver \
    libva-utils
</code></pre></div><p>At this point, you should be able to run <code>vainfo</code> to ensure that everything is
working:</p><div class=highlight><pre style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>$ vainfo
libva info: VA-API version 1.4.1
libva info: va_getDriverName() returns 0
libva info: Trying to open /usr/lib64/dri/i965_drv_video.so
libva info: Found init function __vaDriverInit_1_4
libva info: va_openDriver() returns 0
vainfo: VA-API version: 1.4 (libva 2.4.1)
vainfo: Driver version: Intel i965 driver for Intel(R) Skylake - 2.3.0
vainfo: Supported profile and entrypoints
      VAProfileMPEG2Simple            :	VAEntrypointVLD
      VAProfileMPEG2Simple            :	VAEntrypointEncSlice
      VAProfileMPEG2Main              :	VAEntrypointVLD
      VAProfileMPEG2Main              :	VAEntrypointEncSlice
      VAProfileH264ConstrainedBaseline:	VAEntrypointVLD
      VAProfileH264ConstrainedBaseline:	VAEntrypointEncSlice
      VAProfileH264ConstrainedBaseline:	VAEntrypointEncSliceLP
      VAProfileH264ConstrainedBaseline:	VAEntrypointFEI
      VAProfileH264ConstrainedBaseline:	VAEntrypointStats
      VAProfileH264Main               :	VAEntrypointVLD
      VAProfileH264Main               :	VAEntrypointEncSlice
      VAProfileH264Main               :	VAEntrypointEncSliceLP
      VAProfileH264Main               :	VAEntrypointFEI
      VAProfileH264Main               :	VAEntrypointStats
      VAProfileH264High               :	VAEntrypointVLD
      VAProfileH264High               :	VAEntrypointEncSlice
      VAProfileH264High               :	VAEntrypointEncSliceLP
      VAProfileH264High               :	VAEntrypointFEI
      VAProfileH264High               :	VAEntrypointStats
      VAProfileH264MultiviewHigh      :	VAEntrypointVLD
      VAProfileH264MultiviewHigh      :	VAEntrypointEncSlice
      VAProfileH264StereoHigh         :	VAEntrypointVLD
      VAProfileH264StereoHigh         :	VAEntrypointEncSlice
      VAProfileVC1Simple              :	VAEntrypointVLD
      VAProfileVC1Main                :	VAEntrypointVLD
      VAProfileVC1Advanced            :	VAEntrypointVLD
      VAProfileNone                   :	VAEntrypointVideoProc
      VAProfileJPEGBaseline           :	VAEntrypointVLD
      VAProfileJPEGBaseline           :	VAEntrypointEncPicture
      VAProfileVP8Version0_3          :	VAEntrypointVLD
      VAProfileVP8Version0_3          :	VAEntrypointEncSlice
      VAProfileHEVCMain               :	VAEntrypointVLD
      VAProfileHEVCMain               :	VAEntrypointEncSlice
      VAProfileVP9Profile0            :	VAEntrypointVLD

</code></pre></div><p>If you run into a problem like this one, try installing the
<code>libva-intel-hybrid-driver</code>:</p><div class=highlight><pre style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>$ vainfo
libva info: VA-API version 1.4.1
libva info: va_getDriverName() returns 0
libva info: Trying to open /usr/lib64/dri/i965_drv_video.so
libva info: va_openDriver() returns -1
vaInitialize failed with error code -1 (unknown libva error),exit
</code></pre></div><h2 id=installing-chromium-with-vaapi-support>Installing Chromium with VAAPI support</h2><p>Now that we have a pathway for applications to talk to our GPU, we can install
Chromium with VAAPI support:</p><div class=highlight><pre style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>$ sudo dnf -y install chromium-freeworld
</code></pre></div><p>Run <code>chromium-freeworld</code> to ensure Chromium starts properly. Visit
<a href=chrome://flags>chrome://flags</a> in the Chromium browser and search for
<code>ignore-gpu-blacklist</code>. Choose <strong>Enabled</strong> in the dropdown and press <strong>Relaunch
Now</strong> in the bottom right corner.</p><p>After the relaunch, check some common video sites, like <a href=https://youtube.com/>YouTube</a> or
<a href=http://dailymotion.com>DailyMotion</a>. The CPU usage may be a bit lower on these, but you can lower it
further by installing the <a href=https://github.com/erkserkserks/h264ify>h264ify</a> extension. It forces some sites to provide
h264 video rather than other CPU hungry formats.</p><h2 id=dealing-with-drm>Dealing with DRM</h2><p>The only remaining problem is DRM. Some sites, like Netflix or YouTube TV,
require that the browser can handle DRM content. The <code>Widevine</code> DRM module is
required for some of these sites, but it is automatically bundled with Chrome.
The regular Chrome (not Chromium) package contains the module at:
<code>/opt/google/chrome/libwidevinecdm.so</code>.</p><p>First, ensure Chromium is not running. Then copy that module over to Chromium&rsquo;s
directory:</p><div class=highlight><pre style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>sudo cp /opt/google/chrome/libwidevinecdm.so /usr/lib64/chromium-freeworld/
</code></pre></div><p>Start <code>chromium-freeworld</code> one more time and try out some DRM-protected sites like
Netflix and they should be working properly.</p><p>As I mentioned at the start of the guide, some applications support
acceleration with certain video formats and not others, so your results may
vary.</p><hr><h2 id=new-package-chromium-freeworld>New package: <code>chromium-freeworld</code></h2><p>When this post was first written, the chromium package was called
<code>chromium-vaapi</code>. It now <code>chromium-freeworld</code>. The upgrade is seamless since
the new package obsoletes the old one, but you need one extra step to bring
over the DRM module to the new chromium library directory:</p><div class=highlight><pre style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>sudo cp /usr/lib64/chromium-vaapi/libwidevinecdm.so /usr/lib64/chromium-freeworld
</code></pre></div><p>Restart <code>chromium-freeworld</code> and you&rsquo;re good to go again.</p><p><em>Photo credit: Pixabay<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup></em></p><section class=footnotes role=doc-endnotes><hr><ol><li id=fn:1 role=doc-endnote><p>The content was on pixabay at the time of writing, but it has since been
removed.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></section></content><p><a href=https://major.io/tags/chromium/>#chromium</a>
<a href=https://major.io/tags/fedora/>#fedora</a>
<a href=https://major.io/tags/linux/>#linux</a></p></main><footer><hr>CC-BY-SA 4.0 &#187;
Made with <a href=https://gohugo.io/>Hugo</a> &#187;
Theme based on <a href=https://github.com/janraasch/hugo-bearblog/>Hugo Ê•â€¢á´¥â€¢Ê” Bear</a><br></footer></body></html>