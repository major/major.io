<!doctype html><html lang=en-us><head><meta http-equiv=x-clacks-overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://major.io/favicon.ico><title>Apache 2.2: internal dummy connection | Major Hayden's Blog ðŸ¤ </title><meta name=title content="Apache 2.2: internal dummy connection"><meta name=description content="After working with some RHEL 5 servers fairly regularly, I noticed a reduction in Apache 2.2 performance when many connections were made to the server. There were messages like these streaming into the access_log as well:
127.0.0.1 - - [21/Aug/2008:12:00:10 -0400] &#34;GET / HTTP/1.0&#34; 200 2269 &#34;-&#34; &#34;Apache/2.2.3 (Red Hat) (internal dummy connection)&#34;<br /> 127.0.0.1 - - [21/Aug/2008:12:00:11 -0400] &#34;GET / HTTP/1.0&#34; 200 2269 &#34;-&#34; &#34;Apache/2.2.3 (Red Hat) (internal dummy connection)&#34;<br /> 127."><meta name=keywords content="apache,mod_rewrite,web,"><meta property="og:title" content="Apache 2.2: internal dummy connection"><meta property="og:description" content="After working with some RHEL 5 servers fairly regularly, I noticed a reduction in Apache 2.2 performance when many connections were made to the server. There were messages like these streaming into the access_log as well:
127.0.0.1 - - [21/Aug/2008:12:00:10 -0400] &#34;GET / HTTP/1.0&#34; 200 2269 &#34;-&#34; &#34;Apache/2.2.3 (Red Hat) (internal dummy connection)&#34;<br /> 127.0.0.1 - - [21/Aug/2008:12:00:11 -0400] &#34;GET / HTTP/1.0&#34; 200 2269 &#34;-&#34; &#34;Apache/2.2.3 (Red Hat) (internal dummy connection)&#34;<br /> 127."><meta property="og:type" content="article"><meta property="og:url" content="https://major.io/2008/09/23/apache-22-internal-dummy-connection/"><meta property="og:image" content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2008-09-24T01:42:21+00:00"><meta property="article:modified_time" content="2008-09-24T01:42:21+00:00"><meta property="og:site_name" content="Major Hayden's Blog ðŸ¤ "><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta name=twitter:title content="Apache 2.2: internal dummy connection"><meta name=twitter:description content="After working with some RHEL 5 servers fairly regularly, I noticed a reduction in Apache 2.2 performance when many connections were made to the server. There were messages like these streaming into the access_log as well:
127.0.0.1 - - [21/Aug/2008:12:00:10 -0400] &#34;GET / HTTP/1.0&#34; 200 2269 &#34;-&#34; &#34;Apache/2.2.3 (Red Hat) (internal dummy connection)&#34;<br /> 127.0.0.1 - - [21/Aug/2008:12:00:11 -0400] &#34;GET / HTTP/1.0&#34; 200 2269 &#34;-&#34; &#34;Apache/2.2.3 (Red Hat) (internal dummy connection)&#34;<br /> 127."><meta name=twitter:site content="@mhayden"><meta itemprop=name content="Apache 2.2: internal dummy connection"><meta itemprop=description content="After working with some RHEL 5 servers fairly regularly, I noticed a reduction in Apache 2.2 performance when many connections were made to the server. There were messages like these streaming into the access_log as well:
127.0.0.1 - - [21/Aug/2008:12:00:10 -0400] &#34;GET / HTTP/1.0&#34; 200 2269 &#34;-&#34; &#34;Apache/2.2.3 (Red Hat) (internal dummy connection)&#34;<br /> 127.0.0.1 - - [21/Aug/2008:12:00:11 -0400] &#34;GET / HTTP/1.0&#34; 200 2269 &#34;-&#34; &#34;Apache/2.2.3 (Red Hat) (internal dummy connection)&#34;<br /> 127."><meta itemprop=datePublished content="2008-09-24T01:42:21+00:00"><meta itemprop=dateModified content="2008-09-24T01:42:21+00:00"><meta itemprop=wordCount content="459"><meta itemprop=image content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta itemprop=keywords content="apache,mod_rewrite,web,"><meta name=referrer content="no-referrer-when-downgrade"><style>body{font-family:Verdana,sans-serif;margin:auto;padding:20px;max-width:820px;text-align:left;background-color:#fff;word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:#444}h1,h2,h3,h4,h5,h6,strong,b{color:#222}a{color:#3273dc}.title{text-decoration:none;border:0}.title span{font-weight:400}nav a{margin-right:10px}textarea{width:100%;font-size:16px}input{font-size:16px}content{line-height:1.6}table{width:100%}img{max-width:100%}code{padding:2px 5px;background-color:#f2f2f2}pre code{color:#222;display:block;padding:20px;white-space:pre-wrap;font-size:14px}div.highlight code{background-color:unset;color:initial}blockquote{border-left:1px solid #999;color:#222;padding-left:20px;font-style:italic}footer{padding:25px;text-align:center}.helptext{color:#777;font-size:small}.errorlist{color:#eba613;font-size:small}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:#8b6fcb}@media(prefers-color-scheme:dark){body{background-color:#333;color:#ddd}h1,h2,h3,h4,h5,h6,strong,b{color:#eee}a{color:#8cc2dd}code{background-color:#777}pre code{color:#ddd}blockquote{color:#ccc}textarea,input{background-color:#252525;color:#ddd}.helptext{color:#aaa}}</style></head><body><header><a href=../../../../ class=title><h2>Major Hayden's Blog ðŸ¤ </h2></a><nav><a href=../../../../>Home</a>
<a href=../../../../ham-radio-faq>Ham Radio</a>
<a href=../../../../icanhazip-com-faq>icanhazip FAQ</a>
<a href=../../../../posts>Posts</a></nav></header><main><h1>Apache 2.2: internal dummy connection</h1><i><time datetime=2008-09-24 pubdate>2008-09-24</time></i>
<content><p>After working with some RHEL 5 servers fairly regularly, I noticed a reduction in Apache 2.2 performance when many connections were made to the server. There were messages like these streaming into the access_log as well:</p><p><code>127.0.0.1 - - [21/Aug/2008:12:00:10 -0400] "GET / HTTP/1.0" 200 2269 "-" "Apache/2.2.3 (Red Hat) (internal dummy connection)"&lt;br /> 127.0.0.1 - - [21/Aug/2008:12:00:11 -0400] "GET / HTTP/1.0" 200 2269 "-" "Apache/2.2.3 (Red Hat) (internal dummy connection)"&lt;br /> 127.0.0.1 - - [21/Aug/2008:12:00:13 -0400] "GET / HTTP/1.0" 200 2269 "-" "Apache/2.2.3 (Red Hat) (internal dummy connection)"&lt;br /> 127.0.0.1 - - [21/Aug/2008:12:00:14 -0400] "GET / HTTP/1.0" 200 2269 "-" "Apache/2.2.3 (Red Hat) (internal dummy connection)"&lt;br /> 127.0.0.1 - - [21/Aug/2008:12:00:15 -0400] "GET / HTTP/1.0" 200 2269 "-" "Apache/2.2.3 (Red Hat) (internal dummy connection)"</code></p><p>On servers with ipv6 enabled, you might see a line like this one:</p><p><code>::1 - - [21/Aug/2008:12:00:15 -0400] "GET / HTTP/1.0" 200 2269 "-" "Apache/2.2.3 (Red Hat) (internal dummy connection)"</code></p><p>I began to wonder why Apache was making these connections back onto itself and initiating a <code>GET /</code>. Apache&rsquo;s <a href=http://wiki.apache.org/httpd/InternalDummyConnection>documentation</a> had the following:</p><blockquote><p>When the Apache HTTP Server manages its child processes, it needs a way to wake up processes that are listening for new connections. To do this, it sends a simple HTTP request back to itself. This request will appear in the access_log file with the remote address set to the loop-back interface (typically 127.0.0.1 or ::1 if IPv6 is configured). If you log the User-Agent string (as in the combined log format), you will see the server signature followed by &ldquo;(internal dummy connection)&rdquo; on non-SSL servers. During certain periods you may see up to one such request for each httpd child process.</p><p>These requests are perfectly normal and you do not, in general, need to worry about them. They can simply be ignored.</p></blockquote><p>Sure, I could easily ignore the requests, but the requests were increasing the load on my server more than I liked. Apache&rsquo;s documentation suggested omitting the lines from the logs by adding the following to the Apache configuration:</p><p><code>SetEnvIf Remote_Addr "127\.0\.0\.1" loopback</code></p><p>And then adding <code>env=!loopback</code> to your <code>CustomLog</code> lines ensures that the data won&rsquo;t show up in your access logs. However, you&rsquo;ll still end up with <code>Directory index forbidden by Options directive: /var/www/html/</code> filling up your error_logs. A quick search revealed a <a href=http://www.inventivelabs.com.au/weblog/post/apache-s-internal-dummy-connection>handy mod_rewrite</a> rule to get rid of these requests as quickly as possible with the lowest effort required from Apache:</p><p><code>RewriteCond %{HTTP_USER_AGENT} ^.*internal\ dummy\ connection.*$ [NC]&lt;br /> RewriteRule .* - [F,L]</code></p><p>At this point, the requests to the localhost should receive a 403 immediately. Since you can&rsquo;t keep Apache from sending all of these requests to itself, the best you can do is respond to them in a manner that requires the lowest possible resources.</p></content><p><a href=https://major.io/tags/apache/>#apache</a>
<a href=https://major.io/tags/mod_rewrite/>#mod_rewrite</a>
<a href=https://major.io/tags/web/>#web</a></p></main><footer><hr>CC-BY-SA 4.0 &#187;
Made with <a href=https://gohugo.io/>Hugo</a> &#187;
Theme based on <a href=https://github.com/janraasch/hugo-bearblog/>Hugo Ê•â€¢á´¥â€¢Ê” Bear</a><br></footer></body></html>