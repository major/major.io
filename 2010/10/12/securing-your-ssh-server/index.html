<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="Major Hayden"><meta name=description content="One of the most common questions that I see in my favorite IRC channel is: ‚ÄúHow can I secure sshd on my server?‚Äù There&amp;rsquo;s no single right answer, but most systems administrators combine multiple techniques to provide as much security as possible with the least inconvenience to the end user.
Here are my favorite techniques listed from most effective to least effective:
SSH key pairs
By disabling password-based authentication and requiring ssh key pairs, you reduce the chances of compromise via a brute force attack."><meta name=keywords content=",advice,command line,firewall,iptables,linux,network,security,ssh,sysadmin"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://major.io/2010/10/12/securing-your-ssh-server/><title>Securing your ssh server :: Major Hayden ü§† ‚Äî Words of wisdom from a social nerd</title><link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css rel=stylesheet type=text/css><link rel=stylesheet href=../../../../main.89fa80e2143f71bd5c96a7c94e531dec3276a367e22f87e74a76026ab64680bf.css><link rel=apple-touch-icon sizes=180x180 href=../../../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../../../favicon-16x16.png><link rel=manifest href=../../../../site.webmanifest><link rel=mask-icon href=../../../../safari-pinned-tab.svg color=#252627><link rel="shortcut icon" href=../../../../favicon.ico><meta name=msapplication-TileColor content="#252627"><meta name=theme-color content="#252627"><meta itemprop=name content="Securing your ssh server"><meta itemprop=description content="One of the most common questions that I see in my favorite IRC channel is: ‚ÄúHow can I secure sshd on my server?‚Äù There&rsquo;s no single right answer, but most systems administrators combine multiple techniques to provide as much security as possible with the least inconvenience to the end user.
Here are my favorite techniques listed from most effective to least effective:
SSH key pairs
By disabling password-based authentication and requiring ssh key pairs, you reduce the chances of compromise via a brute force attack."><meta itemprop=datePublished content="2010-10-12T22:39:15+00:00"><meta itemprop=dateModified content="2010-10-12T22:39:15+00:00"><meta itemprop=wordCount content="748"><meta itemprop=image content="https://major.io"><meta itemprop=keywords content="advice,command line,firewall,iptables,linux,network,security,ssh,sysadmin,"><meta property="article:section" content="Blog Posts"><meta property="article:published_time" content="2010-10-12 22:39:15 +0000 UTC"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Securing your ssh server :: Major Hayden ü§†"><meta name=twitter:description content><meta name=twitter:site content="https://major.io"><meta name=twitter:creator content="Major Hayden"><meta name=twitter:image content><style type=text/css>html{letter-spacing:unset}</style></head><body><div class=container><header class=header><span class=header__inner><a href=../../../../ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>$ echo major.io</span>
<span class=logo__cursor style=visibility:hidden></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=../../../../ham-radio-faq>hamradio</a></li><li><a href=../../../../icanhazip-com-faq>icanhazip</a></li><li><a href=../../../../posts/>posts</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href=https://major.io/2010/10/12/securing-your-ssh-server/>Securing your ssh server</a></h2><div class=post-content><p>One of the most common questions that I see in <a href=irc://irc.freenode.net/slicehost>my favorite IRC channel</a> is: ‚ÄúHow can I secure sshd on my server?‚Äù There&rsquo;s no single right answer, but most systems administrators combine multiple techniques to provide as much security as possible with the least inconvenience to the end user.</p><p>Here are my favorite techniques listed from most effective to least effective:</p><p><strong>SSH key pairs</strong></p><p>By disabling password-based authentication and requiring ssh key pairs, you reduce the chances of compromise via a brute force attack. This can also help you protect against weak account passwords since a valid private key is required to gain access to the server. However, a weak account password is still a big problem if you allow your users to use sudo.</p><p>If you&rsquo;re new to using ssh keys, there are <a href=http://sial.org/howto/openssh/publickey-auth/>many</a> <a href=http://www.debian-administration.org/articles/530>great</a> <a href=http://www.linuxquestions.org/linux/answers/Networking/Public_key_authentication_with_ssh>guides</a> that can walk you through the process.</p><p><strong>Firewall</strong></p><p>Limiting the source IP addresses that can access your server on port 22 is simple and effective. However, if you travel on vacation often or your home IP address changes frequently, this may not be a convenient way to limit access. Acquiring a server with trusted access through your firewall would make this method easier to use, but you&rsquo;d need to <a href=http://en.wikipedia.org/wiki/Recursion>consider the security of that server as well</a>.</p><p>The iptables rules would look something like this:</p><pre><code>iptables -A INPUT -j ACCEPT -p tcp --dport 22 -s 10.0.0.20
iptables -A INPUT -j ACCEPT -p tcp --dport 22 -s 10.0.0.25
iptables -A INPUT -j DROP -p tcp --dport 22
</code></pre><p><strong>Use a non-standard port</strong></p><p>I&rsquo;m not a big fan of <a href=http://en.wikipedia.org/wiki/Security_through_obscurity>security through obscurity</a> and it doesn&rsquo;t work well for ssh. If someone is simply scanning a subnet to find ssh daemons, you might not be seen the first time. However, if someone is targeting you specifically, changing the ssh port doesn&rsquo;t help at all. They&rsquo;ll find your ssh banner quickly and begin their attack.</p><p>If you prefer this method, simply adjust the <code>Port</code> configuration parameter in your sshd_config file.</p><p><strong>Limit users and groups</strong></p><p>If you have only certain users and groups who need ssh access to your server, setting user or group limits can help increase security. Consider a server which needs ssh access for developers and a manager. Adding this to to your sshd_config would allow only those users and groups to access your ssh daemon:</p><pre><code>AllowGroups developers
AllowUsers jsmith pjohnson asamuels
</code></pre><p>Keep in mind that any users or groups not included in the sshd_config won&rsquo;t be able to access your ssh server.</p><p><strong>TCP wrappers</strong></p><p>While <a href=http://en.wikipedia.org/wiki/TCP_Wrapper>TCP wrappers</a> are tried and true, I consider them to be a bit old-fashioned. I&rsquo;ve found that many new systems administrators may not think of TCP wrappers when they diagnose server issues and this could possibly cause delays when adjustments need to be made later.</p><p>If you&rsquo;re ready to use TCP wrappers to limit ssh connections, check out <a href=http://docs.redhat.com/docs/en-US/Red_Hat_Enterprise_Linux/5/html/Deployment_Guide/s1-tcpwrappers-access.html>Red Hat&rsquo;s extensive documentation</a>.</p><p><strong>fail2ban and denyhosts</strong></p><p>For those systems administrators who want to take a bit more active stance on blocking brute force attacks, there&rsquo;s always <a href=http://en.wikipedia.org/wiki/Fail2ban>fail2ban</a> or <a href=http://en.wikipedia.org/wiki/DenyHosts>denyhosts</a>. Both fail2ban and denyhosts monitor your authentication logs for repeated failures, but denyhosts can only work with your ssh daemon. You can use fail2ban with other applications like web servers and FTP servers.</p><p>The only downside of using these applications is that if a valid user accidentally tries to authenticate unsuccessfully multiple times, they may be locked out for a period of time. This could be a big problem if you&rsquo;re in the middle of a server emergency.</p><p>A quick search on Google will give you instructions on <a href=http://www.fail2ban.org/wiki/index.php/HOWTOs>fail2ban configuration</a> as well as <a href=http://denyhosts.sourceforge.net/faq.html#2_0>denyhosts configuration</a>.</p><p><strong>Port knocking</strong></p><p>Although <a href=http://en.wikipedia.org/wiki/Port_knocking>port knocking</a> is another tried and true method to prevent unauthorized access, it can be annoying to use unless you have users who are willing to jump through additional hoops. Port knocking involves a ‚Äúknock‚Äù on an arbitrary port that then allows the ssh daemon to be exposed to the user who sent the original knock.</p><p><a href=http://www.linuxjournal.com/article/6811>Linux Journal</a> has a great article explaining how port knocking works and it provides some sample configurations as well.</p><p><strong>Conclusion</strong></p><p>The best way to secure your ssh daemon is to apply more than one of these methods to your servers. Weighing security versus convenience of access isn&rsquo;t an easy task and it will be different for every environment. Regardless of the method or methods you choose, ensure that the rest of your team is comfortable with the changes and capable of adapting to them efficiently.</p></div></article><hr><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://major.io/tags/advice/>advice</a></span>
<span class=tag><a href=https://major.io/tags/command-line/>command line</a></span>
<span class=tag><a href=https://major.io/tags/firewall/>firewall</a></span>
<span class=tag><a href=https://major.io/tags/iptables/>iptables</a></span>
<span class=tag><a href=https://major.io/tags/linux/>linux</a></span>
<span class=tag><a href=https://major.io/tags/network/>network</a></span>
<span class=tag><a href=https://major.io/tags/security/>security</a></span>
<span class=tag><a href=https://major.io/tags/ssh/>ssh</a></span>
<span class=tag><a href=https://major.io/tags/sysadmin/>sysadmin</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-folder meta-icon"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg><span class=tag><a href=https://major.io/categories/blog-posts/>Blog Posts</a></span></p></div></main></div><footer class=footer><div class=footer__inner><div class=footer__content><span>&copy; 2021</span>
<span><a href=https://major.io>Major Hayden</a></span>
<span><a href=https://creativecommons.org/licenses/by-sa/2.0/ target=_blank rel=noopener>CC BY-SA 2.0</a></span><span><a href=https://major.io/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></span></div></div><div class=footer__inner><div class=footer__content><span>Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>Made with &#10084; by <a href=https://github.com/rhazdon>Djordje Atlialp</a></span></div></div></footer></div><script type=text/javascript src=../../../../bundle.min.e9f93b80e78a22e6f04cbb5f73e0f9c4ba60ff73a2a0ef85965c688f93dd1f2722a282e30e485603e4c65b1b346720e35f213435ec5556e196a97a68d097c80f.js integrity="sha512-6fk7gOeKIubwTLtfc+D5xLpg/3OioO+Fllxoj5PdHyciooLjDkhWA+TGWxs0ZyDjXyE0NexVVuGWqXpo0JfIDw=="></script></body></html>