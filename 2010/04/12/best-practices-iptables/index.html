<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="Major Hayden"><meta name=description content="Anyone who has used iptables before has locked themselves out of a remote server at least once. It&amp;rsquo;s easily avoided, but often forgotten. Lots of people have asked me for a list of best practices for iptables firewalls and I certainly hope this post helps.
Understand how iptables operates
Before you can begin using iptables, you need to fully understand how it matches packets with chains and rules. There is a terrific diagram in Wikipedia that will make it easier to understand."><meta name=keywords content><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://major.io/2010/04/12/best-practices-iptables/><title>Best practices: iptables :: Major Hayden ðŸ¤  â€” Words of wisdom from a social nerd</title><link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css rel=stylesheet type=text/css><link rel=stylesheet href=../../../../main.89fa80e2143f71bd5c96a7c94e531dec3276a367e22f87e74a76026ab64680bf.css><link rel=apple-touch-icon sizes=180x180 href=../../../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../../../favicon-16x16.png><link rel=manifest href=../../../../site.webmanifest><link rel=mask-icon href=../../../../safari-pinned-tab.svg color=#252627><link rel="shortcut icon" href=../../../../favicon.ico><meta name=msapplication-TileColor content="#252627"><meta name=theme-color content="#252627"><meta itemprop=name content="Best practices: iptables"><meta itemprop=description content="Anyone who has used iptables before has locked themselves out of a remote server at least once. It&rsquo;s easily avoided, but often forgotten. Lots of people have asked me for a list of best practices for iptables firewalls and I certainly hope this post helps.
Understand how iptables operates
Before you can begin using iptables, you need to fully understand how it matches packets with chains and rules. There is a terrific diagram in Wikipedia that will make it easier to understand."><meta itemprop=datePublished content="2010-04-12T13:35:31+00:00"><meta itemprop=dateModified content="2010-04-12T13:35:31+00:00"><meta itemprop=wordCount content="803"><meta itemprop=image content="https://major.io"><meta itemprop=keywords content><meta property="article:section" content="Blog Posts"><meta property="article:published_time" content="2010-04-12 13:35:31 +0000 UTC"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Best practices: iptables :: Major Hayden ðŸ¤ "><meta name=twitter:description content><meta name=twitter:site content="https://major.io"><meta name=twitter:creator content="Major Hayden"><meta name=twitter:image content><style type=text/css>html{letter-spacing:unset}</style></head><body class=dark-theme><div class=container><header class=header><span class=header__inner><a href=../../../../ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>$ echo major.io</span>
<span class=logo__cursor style=visibility:hidden></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=../../../../ham-radio-faq>hamradio</a></li><li><a href=../../../../icanhazip-com-faq>icanhazip</a></li><li><a href=../../../../posts/>posts</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41C32.4934 41 41 32.4934 41 22 41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href=https://major.io/2010/04/12/best-practices-iptables/>Best practices: iptables</a></h2><div class=post-content><p>Anyone who has used <a href=http://en.wikipedia.org/wiki/Iptables>iptables</a> before has locked themselves out of a remote server at least once. It&rsquo;s easily avoided, but often forgotten. Lots of people have asked me for a list of best practices for iptables firewalls and I certainly hope this post helps.</p><p><strong>Understand how iptables operates</strong></p><p>Before you can begin using iptables, you need to fully understand how it matches packets with chains and rules. There is a <a href=http://en.wikipedia.org/wiki/Iptables#Operational_summary>terrific diagram in Wikipedia</a> that will make it easier to understand. It&rsquo;s imperative to remember that iptables rules are read top-down until a matching rule is found. If no matching rule is found, the default policy of the chain will be applied (more on that in a moment).</p><p><strong>Don&rsquo;t set the default policy to DROP</strong></p><p>All iptables chains have a default policy setting. If a packet doesn&rsquo;t match any of the rules in a relevant chain, it will match the default policy and will be handled accordingly. I&rsquo;ve seen quite a few users set their default policy to DROP, and this can bring about some unintended consequences.</p><p>Consider a situation where your INPUT chain contains quite a few rules allowing traffic, and you&rsquo;ve set the default policy to DROP. Later on, another administrator logs into the server and flushes the rules (which isn&rsquo;t a good practice, either). I&rsquo;ve met quite a few good systems administrators who are unaware of the default policy for iptables chains. Your server will be completely inaccessible immediately. All of the packets will be dropped since they match the default policy in the chain.</p><p>Instead of using the default policy, I normally recommend making an explicit DROP/REJECT rule at the bottom of your chain that matches everything. You can leave your default policy set to ACCEPT and this should reduce the chance of blocking all access to the server.</p><p><strong>Don&rsquo;t blindly flush iptables rules</strong></p><p>Before running <code>iptables -F</code>, always check each chain&rsquo;s default policy. If the INPUT chain is set to DROP, you&rsquo;ll need to set it to ACCEPT if you want to access the server after the rules are flushed. Also, consider the security implications of your network when you clear the rules. Your services will be completely exposed and any masquerading or NAT rules will be removed.</p><p><strong>Remember localhost</strong></p><p>Lots of applications require access to the <code>lo</code> interface. Ensure that you set up your rules carefully so that the <code>lo</code> interface is not disturbed.</p><p><strong>Split complicated rule groups into separate chains</strong></p><p>Even if you&rsquo;re the only systems administrator for your particular network, it&rsquo;s important to keep your iptables rules manageable. If you have a certain subset of rules that may be a little complicated, consider breaking them out into their own chain. You can just add in a jump to that chain from your default set of chains.</p><p><strong>Use REJECT until you know your rules are working properly</strong></p><p>When you&rsquo;re writing iptables rules, you&rsquo;ll probably be testing them pretty often. One way to speed up that process is to use the REJECT target rather than DROP. You&rsquo;ll get an immediate rejection of your traffic (a TCP reset) instead of wondering if your packet is being dropped or if it&rsquo;s making it to your server at all. Once you&rsquo;re done with your testing, you can flip the rules from REJECT to DROP if you prefer.</p><p><em>For those folks working towards their RHCE, this is a huge help during the test. When you&rsquo;re nervous and in a hurry, the immediate packet rejection is a welcomed sight.</em></p><p><strong>Be stringent with your rules</strong></p><p>Try to make your rules as specific as possible for your needs. For example, I like to allow ICMP pings on my servers so that I can run network tests against them. I could easily toss a rule into my INPUT chain that looks like this:</p><p>However, I don&rsquo;t want to simply allow all ICMP traffic. There have been some ICMP flaws from time to time and I&rsquo;d rather keep as low of a profile as possible. There are <a href=http://en.wikipedia.org/wiki/Internet_Control_Message_Protocol#List_of_permitted_control_messages_.28incomplete_list.29>many types of ICMP control messages</a>, but I only want to allow echo requests:</p><p>This will allow echo requests (standard ICMP pings), but it won&rsquo;t explicitly allow any other ICMP traffic to pass through the firewall.</p><p><strong>Use comments for obscure rules</strong></p><p>If you have rules to cover edge cases that other administrators might not understand, consider using iptables comments by adding the following arguments to your rules:</p><p>The comments will appear in the iptables output if you list the current rules. They will also appear in your saved iptables rules.</p><p><strong>Always save your rules</strong></p><p>Most distributions offer some way to save your iptables rules so that they persist through reboots. Red Hat-based distributions offer <code>/etc/init.d/iptables save</code>, but Debian and Ubuntu require some <a href=http://rackerhacker.com/2009/11/16/automatically-loading-iptables-on-debianubuntu/>manual labor</a>. An errant reboot would easily take out your unsaved rules, so save them often.</p></div></article><hr><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-folder meta-icon"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg><span class=tag><a href=https://major.io/categories/blog-posts/>Blog Posts</a></span></p></div></main></div><footer class=footer><div class=footer__inner><div class=footer__content><span>&copy; 2021</span>
<span><a href=https://major.io>Major Hayden</a></span>
<span><a href=https://creativecommons.org/licenses/by-sa/2.0/ target=_blank rel=noopener>CC BY-SA 2.0</a></span><span><a href=https://major.io/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></span></div></div><div class=footer__inner><div class=footer__content><span>Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>Made with &#10084; by <a href=https://github.com/rhazdon>Djordje Atlialp</a></span></div></div></footer></div><script type=text/javascript src=../../../../bundle.min.9dd6c4fd1eb55000d257db1269676cdb26bfcc9ab1b1dc8885a54f94b97fa86e6d72e435907d76f8662e0f65472e78ab8ad69c36624d8d4a96c04c42e029d957.js integrity="sha512-ndbE/R61UADSV9sSaWds2ya/zJqxsdyIhaVPlLl/qG5tcuQ1kH12+GYuD2VHLniritacNmJNjUqWwExC4CnZVw=="></script></body></html>