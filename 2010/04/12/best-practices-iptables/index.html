<!doctype html><html lang=en-us><head><meta http-equiv=x-clacks-overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://major.io/favicon.ico><title>Best practices: iptables | Major Hayden's Blog ðŸ¤ </title><meta name=title content="Best practices: iptables"><meta name=description content="Anyone who has used iptables before has locked themselves out of a remote server at least once. It&rsquo;s easily avoided, but often forgotten. Lots of people have asked me for a list of best practices for iptables firewalls and I certainly hope this post helps.
Understand how iptables operates
Before you can begin using iptables, you need to fully understand how it matches packets with chains and rules. There is a terrific diagram in Wikipedia that will make it easier to understand."><meta name=keywords content><meta property="og:title" content="Best practices: iptables"><meta property="og:description" content="Anyone who has used iptables before has locked themselves out of a remote server at least once. It&rsquo;s easily avoided, but often forgotten. Lots of people have asked me for a list of best practices for iptables firewalls and I certainly hope this post helps.
Understand how iptables operates
Before you can begin using iptables, you need to fully understand how it matches packets with chains and rules. There is a terrific diagram in Wikipedia that will make it easier to understand."><meta property="og:type" content="article"><meta property="og:url" content="https://major.io/2010/04/12/best-practices-iptables/"><meta property="og:image" content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2010-04-12T13:35:31+00:00"><meta property="article:modified_time" content="2010-04-12T13:35:31+00:00"><meta property="og:site_name" content="Major Hayden's Blog ðŸ¤ "><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta name=twitter:title content="Best practices: iptables"><meta name=twitter:description content="Anyone who has used iptables before has locked themselves out of a remote server at least once. It&rsquo;s easily avoided, but often forgotten. Lots of people have asked me for a list of best practices for iptables firewalls and I certainly hope this post helps.
Understand how iptables operates
Before you can begin using iptables, you need to fully understand how it matches packets with chains and rules. There is a terrific diagram in Wikipedia that will make it easier to understand."><meta name=twitter:site content="@mhayden"><meta itemprop=name content="Best practices: iptables"><meta itemprop=description content="Anyone who has used iptables before has locked themselves out of a remote server at least once. It&rsquo;s easily avoided, but often forgotten. Lots of people have asked me for a list of best practices for iptables firewalls and I certainly hope this post helps.
Understand how iptables operates
Before you can begin using iptables, you need to fully understand how it matches packets with chains and rules. There is a terrific diagram in Wikipedia that will make it easier to understand."><meta itemprop=datePublished content="2010-04-12T13:35:31+00:00"><meta itemprop=dateModified content="2010-04-12T13:35:31+00:00"><meta itemprop=wordCount content="803"><meta itemprop=image content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta itemprop=keywords content><meta name=referrer content="no-referrer-when-downgrade"><style>body{font-family:Verdana,sans-serif;margin:auto;padding:20px;max-width:820px;text-align:left;background-color:#fff;word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:#444}h1,h2,h3,h4,h5,h6,strong,b{color:#222}a{color:#3273dc}.title{text-decoration:none;border:0}.title span{font-weight:400}nav a{margin-right:10px}textarea{width:100%;font-size:16px}input{font-size:16px}content{line-height:1.6}table{width:100%}img{max-width:100%}code{padding:2px 5px;background-color:#f2f2f2}pre code{color:#222;display:block;padding:20px;white-space:pre-wrap;font-size:14px}div.highlight code{background-color:unset;color:initial}blockquote{border-left:1px solid #999;color:#222;padding-left:20px;font-style:italic}footer{padding:25px;text-align:center}.helptext{color:#777;font-size:small}.errorlist{color:#eba613;font-size:small}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:#8b6fcb}@media(prefers-color-scheme:dark){body{background-color:#333;color:#ddd}h1,h2,h3,h4,h5,h6,strong,b{color:#eee}a{color:#8cc2dd}code{background-color:#777}pre code{color:#ddd}blockquote{color:#ccc}textarea,input{background-color:#252525;color:#ddd}.helptext{color:#aaa}}</style></head><body><header><a href=../../../../ class=title><h2>Major Hayden's Blog ðŸ¤ </h2></a><nav><a href=../../../../>Home</a>
<a href=../../../../ham-radio-faq>Ham Radio</a>
<a href=../../../../icanhazip-com-faq>icanhazip FAQ</a>
<a href=../../../../posts>Posts</a></nav></header><main><h1>Best practices: iptables</h1><i><time datetime=2010-04-12 pubdate>2010-04-12</time></i>
<content><p>Anyone who has used <a href=http://en.wikipedia.org/wiki/Iptables>iptables</a> before has locked themselves out of a remote server at least once. It&rsquo;s easily avoided, but often forgotten. Lots of people have asked me for a list of best practices for iptables firewalls and I certainly hope this post helps.</p><p><strong>Understand how iptables operates</strong></p><p>Before you can begin using iptables, you need to fully understand how it matches packets with chains and rules. There is a <a href=http://en.wikipedia.org/wiki/Iptables#Operational_summary>terrific diagram in Wikipedia</a> that will make it easier to understand. It&rsquo;s imperative to remember that iptables rules are read top-down until a matching rule is found. If no matching rule is found, the default policy of the chain will be applied (more on that in a moment).</p><p><strong>Don&rsquo;t set the default policy to DROP</strong></p><p>All iptables chains have a default policy setting. If a packet doesn&rsquo;t match any of the rules in a relevant chain, it will match the default policy and will be handled accordingly. I&rsquo;ve seen quite a few users set their default policy to DROP, and this can bring about some unintended consequences.</p><p>Consider a situation where your INPUT chain contains quite a few rules allowing traffic, and you&rsquo;ve set the default policy to DROP. Later on, another administrator logs into the server and flushes the rules (which isn&rsquo;t a good practice, either). I&rsquo;ve met quite a few good systems administrators who are unaware of the default policy for iptables chains. Your server will be completely inaccessible immediately. All of the packets will be dropped since they match the default policy in the chain.</p><p>Instead of using the default policy, I normally recommend making an explicit DROP/REJECT rule at the bottom of your chain that matches everything. You can leave your default policy set to ACCEPT and this should reduce the chance of blocking all access to the server.</p><p><strong>Don&rsquo;t blindly flush iptables rules</strong></p><p>Before running <code>iptables -F</code>, always check each chain&rsquo;s default policy. If the INPUT chain is set to DROP, you&rsquo;ll need to set it to ACCEPT if you want to access the server after the rules are flushed. Also, consider the security implications of your network when you clear the rules. Your services will be completely exposed and any masquerading or NAT rules will be removed.</p><p><strong>Remember localhost</strong></p><p>Lots of applications require access to the <code>lo</code> interface. Ensure that you set up your rules carefully so that the <code>lo</code> interface is not disturbed.</p><p><strong>Split complicated rule groups into separate chains</strong></p><p>Even if you&rsquo;re the only systems administrator for your particular network, it&rsquo;s important to keep your iptables rules manageable. If you have a certain subset of rules that may be a little complicated, consider breaking them out into their own chain. You can just add in a jump to that chain from your default set of chains.</p><p><strong>Use REJECT until you know your rules are working properly</strong></p><p>When you&rsquo;re writing iptables rules, you&rsquo;ll probably be testing them pretty often. One way to speed up that process is to use the REJECT target rather than DROP. You&rsquo;ll get an immediate rejection of your traffic (a TCP reset) instead of wondering if your packet is being dropped or if it&rsquo;s making it to your server at all. Once you&rsquo;re done with your testing, you can flip the rules from REJECT to DROP if you prefer.</p><p><em>For those folks working towards their RHCE, this is a huge help during the test. When you&rsquo;re nervous and in a hurry, the immediate packet rejection is a welcomed sight.</em></p><p><strong>Be stringent with your rules</strong></p><p>Try to make your rules as specific as possible for your needs. For example, I like to allow ICMP pings on my servers so that I can run network tests against them. I could easily toss a rule into my INPUT chain that looks like this:</p><p>However, I don&rsquo;t want to simply allow all ICMP traffic. There have been some ICMP flaws from time to time and I&rsquo;d rather keep as low of a profile as possible. There are <a href=http://en.wikipedia.org/wiki/Internet_Control_Message_Protocol#List_of_permitted_control_messages_.28incomplete_list.29>many types of ICMP control messages</a>, but I only want to allow echo requests:</p><p>This will allow echo requests (standard ICMP pings), but it won&rsquo;t explicitly allow any other ICMP traffic to pass through the firewall.</p><p><strong>Use comments for obscure rules</strong></p><p>If you have rules to cover edge cases that other administrators might not understand, consider using iptables comments by adding the following arguments to your rules:</p><p>The comments will appear in the iptables output if you list the current rules. They will also appear in your saved iptables rules.</p><p><strong>Always save your rules</strong></p><p>Most distributions offer some way to save your iptables rules so that they persist through reboots. Red Hat-based distributions offer <code>/etc/init.d/iptables save</code>, but Debian and Ubuntu require some <a href=http://rackerhacker.com/2009/11/16/automatically-loading-iptables-on-debianubuntu/>manual labor</a>. An errant reboot would easily take out your unsaved rules, so save them often.</p></content><p></p></main><footer><script async src=https://media.ethicalads.io/media/client/ethicalads.min.js></script><div data-ea-publisher=major-io data-ea-type=text></div><hr>CC-BY-SA 4.0 &#187;
Made with <a href=https://gohugo.io/>Hugo</a> &#187;
Theme based on <a href=https://github.com/janraasch/hugo-bearblog/>Hugo Ê•â€¢á´¥â€¢Ê” Bear</a><br></footer></body></html>