<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="Major Hayden"><meta name=description content="This problem has cropped up for me a few times, but I&amp;rsquo;ve always forgotten to make a post about it. If you&amp;rsquo;re working with a large InnoDB table and you&amp;rsquo;re updating, inserting, or deleting a large volume of rows, you may stumble upon this error:
InnoDB stores its lock tables in the main buffer pool. This means that the number of locks you can have at the same time is limited by the innodb_buffer_pool_size variable that was set when MySQL was started."><meta name=keywords content=",command line,database,innodb,memory,mysql"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://major.io/2010/01/29/mysql-the-total-number-of-locks-exceeds-the-lock-table-size/><title>MySQL: The total number of locks exceeds the lock table size :: Major Hayden ðŸ¤  â€” Words of wisdom from a social nerd</title><link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css rel=stylesheet type=text/css><link rel=stylesheet href=../../../../main.89fa80e2143f71bd5c96a7c94e531dec3276a367e22f87e74a76026ab64680bf.css><link rel=apple-touch-icon sizes=180x180 href=../../../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../../../favicon-16x16.png><link rel=manifest href=../../../../site.webmanifest><link rel=mask-icon href=../../../../safari-pinned-tab.svg color=#252627><link rel="shortcut icon" href=../../../../favicon.ico><meta name=msapplication-TileColor content="#252627"><meta name=theme-color content="#252627"><meta itemprop=name content="MySQL: The total number of locks exceeds the lock table size"><meta itemprop=description content="This problem has cropped up for me a few times, but I&rsquo;ve always forgotten to make a post about it. If you&rsquo;re working with a large InnoDB table and you&rsquo;re updating, inserting, or deleting a large volume of rows, you may stumble upon this error:
InnoDB stores its lock tables in the main buffer pool. This means that the number of locks you can have at the same time is limited by the innodb_buffer_pool_size variable that was set when MySQL was started."><meta itemprop=datePublished content="2010-01-29T13:12:21+00:00"><meta itemprop=dateModified content="2010-01-29T13:12:21+00:00"><meta itemprop=wordCount content="322"><meta itemprop=image content="https://major.io"><meta itemprop=keywords content="command line,database,innodb,memory,mysql,"><meta property="article:section" content="Blog Posts"><meta property="article:published_time" content="2010-01-29 13:12:21 +0000 UTC"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="MySQL: The total number of locks exceeds the lock table size :: Major Hayden ðŸ¤ "><meta name=twitter:description content><meta name=twitter:site content="https://major.io"><meta name=twitter:creator content="Major Hayden"><meta name=twitter:image content><style type=text/css>html{letter-spacing:unset}</style></head><body class=dark-theme><div class=container><header class=header><span class=header__inner><a href=../../../../ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>$ echo major.io</span>
<span class=logo__cursor style=visibility:hidden></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=../../../../ham-radio-faq>hamradio</a></li><li><a href=../../../../icanhazip-com-faq>icanhazip</a></li><li><a href=../../../../posts/>posts</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href=https://major.io/2010/01/29/mysql-the-total-number-of-locks-exceeds-the-lock-table-size/>MySQL: The total number of locks exceeds the lock table size</a></h2><div class=post-content><p>This problem has cropped up for me a few times, but I&rsquo;ve always forgotten to make a post about it. If you&rsquo;re working with a large InnoDB table and you&rsquo;re updating, inserting, or deleting a large volume of rows, you may stumble upon this error:</p><p>InnoDB stores its lock tables in the main buffer pool. This means that the number of locks you can have at the same time is limited by the <code>innodb_buffer_pool_size</code> variable that was set when MySQL was started. By default, MySQL leaves this at 8MB, which is pretty useless if you&rsquo;re doing anything with InnoDB on your server.</p><p>Luckily, the fix for this issue is very easy: adjust <code>innodb_buffer_pool_size</code> to a more reasonable value. However, that fix does require a restart of the MySQL daemon. There&rsquo;s simply no way to adjust this variable on the fly (with the current stable MySQL versions as of this post&rsquo;s writing).</p><p>Before you adjust the variable, make sure that your server can handle the additional memory usage. The <code>innodb_buffer_pool_size</code> variable is a server wide variable, not a per-thread variable, so it&rsquo;s shared between all of the connections to the MySQL server (like the query cache). If you set it to something like 1GB, MySQL won&rsquo;t use all of that up front. As MySQL finds more things to put in the buffer, the memory usage will gradually increase until it reaches 1GB. At that point, the oldest and least used data begins to get pruned when new data needs to be present.</p><p><strong>So, you need a workaround without a MySQL restart?</strong></p><p>If you&rsquo;re in a pinch, and you need a workaround, break up your statements into chunks. If you need to delete a million rows, try deleting 5-10% of those rows per transaction. This may allow you to sneak under the lock table size limitations and clear out some data without restarting MySQL.</p><p>To learn more about InnoDB&rsquo;s parameters, visit the <a href=http://dev.mysql.com/doc/refman/5.0/en/innodb-parameters.html>MySQL documentation</a>.</p></div></article><hr><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://major.io/tags/command-line/>command line</a></span>
<span class=tag><a href=https://major.io/tags/database/>database</a></span>
<span class=tag><a href=https://major.io/tags/innodb/>innodb</a></span>
<span class=tag><a href=https://major.io/tags/memory/>memory</a></span>
<span class=tag><a href=https://major.io/tags/mysql/>mysql</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-folder meta-icon"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg><span class=tag><a href=https://major.io/categories/blog-posts/>Blog Posts</a></span></p></div></main></div><footer class=footer><div class=footer__inner><div class=footer__content><span>&copy; 2021</span>
<span><a href=https://major.io>Major Hayden</a></span>
<span><a href=https://creativecommons.org/licenses/by-sa/2.0/ target=_blank rel=noopener>CC BY-SA 2.0</a></span><span><a href=https://major.io/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></span></div></div><div class=footer__inner><div class=footer__content><span>Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>Made with &#10084; by <a href=https://github.com/rhazdon>Djordje Atlialp</a></span></div></div></footer></div><script type=text/javascript src=../../../../bundle.min.e9f93b80e78a22e6f04cbb5f73e0f9c4ba60ff73a2a0ef85965c688f93dd1f2722a282e30e485603e4c65b1b346720e35f213435ec5556e196a97a68d097c80f.js integrity="sha512-6fk7gOeKIubwTLtfc+D5xLpg/3OioO+Fllxoj5PdHyciooLjDkhWA+TGWxs0ZyDjXyE0NexVVuGWqXpo0JfIDw=="></script></body></html>