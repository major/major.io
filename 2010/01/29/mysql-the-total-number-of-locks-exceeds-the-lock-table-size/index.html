<!doctype html><html lang=en-us><head><meta http-equiv=x-clacks-overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://major.io/favicon.ico><title>MySQL: The total number of locks exceeds the lock table size | Major Hayden's Blog ðŸ¤ </title><meta name=title content="MySQL: The total number of locks exceeds the lock table size"><meta name=description content="This problem has cropped up for me a few times, but I&rsquo;ve always forgotten to make a post about it. If you&rsquo;re working with a large InnoDB table and you&rsquo;re updating, inserting, or deleting a large volume of rows, you may stumble upon this error:
InnoDB stores its lock tables in the main buffer pool. This means that the number of locks you can have at the same time is limited by the innodb_buffer_pool_size variable that was set when MySQL was started."><meta name=keywords content="command line,database,innodb,memory,mysql,"><meta property="og:title" content="MySQL: The total number of locks exceeds the lock table size"><meta property="og:description" content="This problem has cropped up for me a few times, but I&rsquo;ve always forgotten to make a post about it. If you&rsquo;re working with a large InnoDB table and you&rsquo;re updating, inserting, or deleting a large volume of rows, you may stumble upon this error:
InnoDB stores its lock tables in the main buffer pool. This means that the number of locks you can have at the same time is limited by the innodb_buffer_pool_size variable that was set when MySQL was started."><meta property="og:type" content="article"><meta property="og:url" content="https://major.io/2010/01/29/mysql-the-total-number-of-locks-exceeds-the-lock-table-size/"><meta property="og:image" content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2010-01-29T13:12:21+00:00"><meta property="article:modified_time" content="2010-01-29T13:12:21+00:00"><meta property="og:site_name" content="Major Hayden's Blog ðŸ¤ "><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta name=twitter:title content="MySQL: The total number of locks exceeds the lock table size"><meta name=twitter:description content="This problem has cropped up for me a few times, but I&rsquo;ve always forgotten to make a post about it. If you&rsquo;re working with a large InnoDB table and you&rsquo;re updating, inserting, or deleting a large volume of rows, you may stumble upon this error:
InnoDB stores its lock tables in the main buffer pool. This means that the number of locks you can have at the same time is limited by the innodb_buffer_pool_size variable that was set when MySQL was started."><meta name=twitter:site content="@mhayden"><meta itemprop=name content="MySQL: The total number of locks exceeds the lock table size"><meta itemprop=description content="This problem has cropped up for me a few times, but I&rsquo;ve always forgotten to make a post about it. If you&rsquo;re working with a large InnoDB table and you&rsquo;re updating, inserting, or deleting a large volume of rows, you may stumble upon this error:
InnoDB stores its lock tables in the main buffer pool. This means that the number of locks you can have at the same time is limited by the innodb_buffer_pool_size variable that was set when MySQL was started."><meta itemprop=datePublished content="2010-01-29T13:12:21+00:00"><meta itemprop=dateModified content="2010-01-29T13:12:21+00:00"><meta itemprop=wordCount content="322"><meta itemprop=image content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta itemprop=keywords content="command line,database,innodb,memory,mysql,"><meta name=referrer content="no-referrer-when-downgrade"><style>body{font-family:Verdana,sans-serif;margin:auto;padding:20px;max-width:820px;text-align:left;background-color:#fff;word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:#444}h1,h2,h3,h4,h5,h6,strong,b{color:#222}a{color:#3273dc}.title{text-decoration:none;border:0}.title span{font-weight:400}nav a{margin-right:10px}textarea{width:100%;font-size:16px}input{font-size:16px}content{line-height:1.6}table{width:100%}img{max-width:100%}code{padding:2px 5px;background-color:#f2f2f2}pre code{color:#222;display:block;padding:20px;white-space:pre-wrap;font-size:14px}div.highlight code{background-color:unset;color:initial}blockquote{border-left:1px solid #999;color:#222;padding-left:20px;font-style:italic}footer{padding:25px;text-align:center}.helptext{color:#777;font-size:small}.errorlist{color:#eba613;font-size:small}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:#8b6fcb}@media(prefers-color-scheme:dark){body{background-color:#333;color:#ddd}h1,h2,h3,h4,h5,h6,strong,b{color:#eee}a{color:#8cc2dd}code{background-color:#777}pre code{color:#ddd}blockquote{color:#ccc}textarea,input{background-color:#252525;color:#ddd}.helptext{color:#aaa}}</style></head><body><header><a href=../../../../ class=title><h2>Major Hayden's Blog ðŸ¤ </h2></a><nav><a href=../../../../>Home</a>
<a href=../../../../ham-radio-faq>Ham Radio</a>
<a href=../../../../icanhazip-com-faq>icanhazip FAQ</a>
<a href=../../../../posts>Posts</a></nav><script async src=https://media.ethicalads.io/media/client/ethicalads.min.js></script><div class="adaptive raised" data-ea-publisher=major-io data-ea-type=text></div></header><main><h1>MySQL: The total number of locks exceeds the lock table size</h1><i><time datetime=2010-01-29 pubdate>2010-01-29</time></i>
<content><p>This problem has cropped up for me a few times, but I&rsquo;ve always forgotten to make a post about it. If you&rsquo;re working with a large InnoDB table and you&rsquo;re updating, inserting, or deleting a large volume of rows, you may stumble upon this error:</p><p>InnoDB stores its lock tables in the main buffer pool. This means that the number of locks you can have at the same time is limited by the <code>innodb_buffer_pool_size</code> variable that was set when MySQL was started. By default, MySQL leaves this at 8MB, which is pretty useless if you&rsquo;re doing anything with InnoDB on your server.</p><p>Luckily, the fix for this issue is very easy: adjust <code>innodb_buffer_pool_size</code> to a more reasonable value. However, that fix does require a restart of the MySQL daemon. There&rsquo;s simply no way to adjust this variable on the fly (with the current stable MySQL versions as of this post&rsquo;s writing).</p><p>Before you adjust the variable, make sure that your server can handle the additional memory usage. The <code>innodb_buffer_pool_size</code> variable is a server wide variable, not a per-thread variable, so it&rsquo;s shared between all of the connections to the MySQL server (like the query cache). If you set it to something like 1GB, MySQL won&rsquo;t use all of that up front. As MySQL finds more things to put in the buffer, the memory usage will gradually increase until it reaches 1GB. At that point, the oldest and least used data begins to get pruned when new data needs to be present.</p><p><strong>So, you need a workaround without a MySQL restart?</strong></p><p>If you&rsquo;re in a pinch, and you need a workaround, break up your statements into chunks. If you need to delete a million rows, try deleting 5-10% of those rows per transaction. This may allow you to sneak under the lock table size limitations and clear out some data without restarting MySQL.</p><p>To learn more about InnoDB&rsquo;s parameters, visit the <a href=http://dev.mysql.com/doc/refman/5.0/en/innodb-parameters.html>MySQL documentation</a>.</p></content><p><a href=https://major.io/tags/command-line/>#command line</a>
<a href=https://major.io/tags/database/>#database</a>
<a href=https://major.io/tags/innodb/>#innodb</a>
<a href=https://major.io/tags/memory/>#memory</a>
<a href=https://major.io/tags/mysql/>#mysql</a></p></main><footer><hr>CC-BY-SA 4.0 &#187;
Made with <a href=https://gohugo.io/>Hugo</a> &#187;
Theme based on <a href=https://github.com/janraasch/hugo-bearblog/>Hugo Ê•â€¢á´¥â€¢Ê” Bear</a><br></footer></body></html>