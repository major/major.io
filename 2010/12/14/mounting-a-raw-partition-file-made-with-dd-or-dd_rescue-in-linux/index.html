<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="Major Hayden"><meta name=description content="This situation might not affect everyone, but it struck me today and left me scratching my head. Consider a situation where you need to clone one drive to another with dd or when a hard drive is failing badly and you use dd_rescue to salvage whatever data you can.
Let&amp;rsquo;s say you cloned data from a drive using something like this:
# dd if=/dev/sda of=/mnt/nfs/backup/harddrive.img Once that&amp;rsquo;s finished, you should end up with your partition table as well as the grub data from the MBR in your image file."><meta name=keywords content=",command line,emergency,sysadmin"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://major.io/2010/12/14/mounting-a-raw-partition-file-made-with-dd-or-dd_rescue-in-linux/><title>Mounting a raw partition file made with dd or dd_rescue in Linux :: Major Hayden ðŸ¤  â€” Words of wisdom from a social nerd</title><link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css rel=stylesheet type=text/css><link rel=stylesheet href=../../../../main.min.5dcefbf8102eb536dd3e2de53ffebfa58599ab2435c241a0db81728a5e015f2e.css><link rel=apple-touch-icon sizes=180x180 href=../../../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../../../favicon-16x16.png><link rel=manifest href=../../../../site.webmanifest><link rel=mask-icon href=../../../../safari-pinned-tab.svg color=#252627><link rel="shortcut icon" href=../../../../favicon.ico><meta name=msapplication-TileColor content="#252627"><meta name=theme-color content="#252627"><meta itemprop=name content="Mounting a raw partition file made with dd or dd_rescue in Linux"><meta itemprop=description content="This situation might not affect everyone, but it struck me today and left me scratching my head. Consider a situation where you need to clone one drive to another with dd or when a hard drive is failing badly and you use dd_rescue to salvage whatever data you can.
Let&rsquo;s say you cloned data from a drive using something like this:
# dd if=/dev/sda of=/mnt/nfs/backup/harddrive.img Once that&rsquo;s finished, you should end up with your partition table as well as the grub data from the MBR in your image file."><meta itemprop=datePublished content="2010-12-15T01:07:24+00:00"><meta itemprop=dateModified content="2010-12-15T01:07:24+00:00"><meta itemprop=wordCount content="361"><meta itemprop=image content="https://major.io"><meta itemprop=keywords content="command line,emergency,sysadmin,"><meta property="article:section" content="Blog Posts"><meta property="article:published_time" content="2010-12-15 01:07:24 +0000 UTC"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Mounting a raw partition file made with dd or dd_rescue in Linux :: Major Hayden ðŸ¤ "><meta name=twitter:description content><meta name=twitter:site content="https://major.io"><meta name=twitter:creator content="Major Hayden"><meta name=twitter:image content><style type=text/css>html{letter-spacing:unset}</style></head><body class=dark-theme><div class=container><header class=header><span class=header__inner><a href=../../../../ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>$ echo major.io</span>
<span class=logo__cursor style=visibility:hidden></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=https://major.io/ham-radio-faq>hamradio</a></li><li><a href=https://major.io/icanhazip-com-faq>icanhazip</a></li><li><a href=https://major.io/posts/>posts</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41C32.4934 41 41 32.4934 41 22 41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href=https://major.io/2010/12/14/mounting-a-raw-partition-file-made-with-dd-or-dd_rescue-in-linux/>Mounting a raw partition file made with dd or dd_rescue in Linux</a></h2><div class=post-content><p>This situation might not affect everyone, but it struck me today and left me scratching my head. Consider a situation where you need to clone one drive to another with <a href=http://en.wikipedia.org/wiki/Dd_(Unix)>dd</a> or when a hard drive is failing badly and you use <a href=http://www.garloff.de/kurt/linux/ddrescue/>dd_rescue</a> to salvage whatever data you can.</p><p>Let&rsquo;s say you cloned data from a drive using something like this:</p><pre><code># dd if=/dev/sda of=/mnt/nfs/backup/harddrive.img
</code></pre><p>Once that&rsquo;s finished, you should end up with your partition table as well as the grub data from the MBR in your image file. If you run <code>file</code> against the image file you made, you should see something like this:</p><pre><code># file harddrive.img
harddrive.img: x86 boot sector; GRand Unified Bootloader, stage1 version 0x3, stage2
address 0x2000, stage2 segment 0x200, GRUB version 0.97; partition 1: ID=0x83,
active, starthead 1, startsector 63, 33640047 sectors, code offset 0x48
</code></pre><p>What if you want to pull some files from this image without writing it out to another disk? Mounting it like a loop file isn&rsquo;t going to work:</p><pre><code># mount harddrive /mnt/temp
mount: you must specify the filesystem type
</code></pre><p>The key is to mount the file <a href=http://www.linuxquestions.org/questions/linux-general-1/trouble-mounting-dd-image-file-644362/#post3660310>with an offset specified</a>. In the output from <code>file</code>, there is a particular portion of the output that will help you:</p><pre><code>... startsector 63 ...
</code></pre><p>This means that the filesystem itself starts on sector 63. You can also view this with <code>fdisk -l</code>:</p><pre><code># fdisk -l harddrive.img
                    Device Boot      Start         End      Blocks   Id  System
harddrive.img                *          63    33640109    16820023+  83  Linux
</code></pre><p>Since we need to scoot 63 sectors ahead, and each sector is 512 bytes long, we need to use an offset of 32,256 bytes. Fire up the mount command and you&rsquo;ll be on your way:</p><pre><code># mount -o ro,loop,offset=32256 harddrive.img /mnt/loop
# mount | grep harddrive.img
/root/harddrive.img on /mnt/loop type ext3 (ro,loop=/dev/loop1,offset=32256)
</code></pre><p>If you made this image under duress (due to a failing drive or other emergency), you might have to check and repair the filesystem first. Doing that is easy if you make a loop device:</p><pre><code># losetup --offset 32256 /dev/loop2 harddrive.img
# fsck /dev/loop2
</code></pre><p>Once that&rsquo;s complete, you can save some time and mount the loop device directly:</p><pre><code># mount /dev/loop2 /mnt/loop
</code></pre></div></article><hr><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://major.io/tags/command-line>command line</a></span><span class=tag><a href=https://major.io/tags/emergency>emergency</a></span><span class=tag><a href=https://major.io/tags/sysadmin>sysadmin</a></span></p></div></main></div><footer class=footer><div class=footer__inner><div class=footer__content><span>&copy; 2021</span>
<span><a href=https://major.io>Major Hayden</a></span>
<span><a href=https://creativecommons.org/licenses/by-sa/2.0/ target=_blank rel=noopener>CC BY-SA 2.0</a></span>
<span><a href=https://major.io/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></span></div></div><div class=footer__inner><div class=footer__content><span>Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>Made with &#10084; by <a href=https://github.com/rhazdon>rhazdon</a></span></div></div></footer></div><script type=text/javascript src=../../../../bundle.min.2d5469329143160ae2456a69c3c76dc2d0a3b212b46afe291a51bd68650ed6f8697e001dab54f1c272c77ce08092a8c55e5bb4314e0ee334aab4b927ec896638.js integrity="sha512-LVRpMpFDFgriRWppw8dtwtCjshK0av4pGlG9aGUO1vhpfgAdq1TxwnLHfOCAkqjFXlu0MU4O4zSqtLkn7IlmOA=="></script></body></html>