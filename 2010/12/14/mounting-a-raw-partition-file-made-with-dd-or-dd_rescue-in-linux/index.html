<!doctype html><html lang=en-us><head><meta http-equiv=x-clacks-overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://major.io/favicon.ico><title>Mounting a raw partition file made with dd or dd_rescue in Linux | Major Hayden's Blog ðŸ¤ </title><meta name=title content="Mounting a raw partition file made with dd or dd_rescue in Linux"><meta name=description content="This situation might not affect everyone, but it struck me today and left me scratching my head. Consider a situation where you need to clone one drive to another with dd or when a hard drive is failing badly and you use dd_rescue to salvage whatever data you can.
Let&rsquo;s say you cloned data from a drive using something like this:
# dd if=/dev/sda of=/mnt/nfs/backup/harddrive.img Once that&rsquo;s finished, you should end up with your partition table as well as the grub data from the MBR in your image file."><meta name=keywords content="command line,emergency,sysadmin,"><meta property="og:title" content="Mounting a raw partition file made with dd or dd_rescue in Linux"><meta property="og:description" content="This situation might not affect everyone, but it struck me today and left me scratching my head. Consider a situation where you need to clone one drive to another with dd or when a hard drive is failing badly and you use dd_rescue to salvage whatever data you can.
Let&rsquo;s say you cloned data from a drive using something like this:
# dd if=/dev/sda of=/mnt/nfs/backup/harddrive.img Once that&rsquo;s finished, you should end up with your partition table as well as the grub data from the MBR in your image file."><meta property="og:type" content="article"><meta property="og:url" content="https://major.io/2010/12/14/mounting-a-raw-partition-file-made-with-dd-or-dd_rescue-in-linux/"><meta property="og:image" content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2010-12-15T01:07:24+00:00"><meta property="article:modified_time" content="2010-12-15T01:07:24+00:00"><meta property="og:site_name" content="Major Hayden's Blog ðŸ¤ "><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta name=twitter:title content="Mounting a raw partition file made with dd or dd_rescue in Linux"><meta name=twitter:description content="This situation might not affect everyone, but it struck me today and left me scratching my head. Consider a situation where you need to clone one drive to another with dd or when a hard drive is failing badly and you use dd_rescue to salvage whatever data you can.
Let&rsquo;s say you cloned data from a drive using something like this:
# dd if=/dev/sda of=/mnt/nfs/backup/harddrive.img Once that&rsquo;s finished, you should end up with your partition table as well as the grub data from the MBR in your image file."><meta name=twitter:site content="@mhayden"><meta itemprop=name content="Mounting a raw partition file made with dd or dd_rescue in Linux"><meta itemprop=description content="This situation might not affect everyone, but it struck me today and left me scratching my head. Consider a situation where you need to clone one drive to another with dd or when a hard drive is failing badly and you use dd_rescue to salvage whatever data you can.
Let&rsquo;s say you cloned data from a drive using something like this:
# dd if=/dev/sda of=/mnt/nfs/backup/harddrive.img Once that&rsquo;s finished, you should end up with your partition table as well as the grub data from the MBR in your image file."><meta itemprop=datePublished content="2010-12-15T01:07:24+00:00"><meta itemprop=dateModified content="2010-12-15T01:07:24+00:00"><meta itemprop=wordCount content="361"><meta itemprop=image content="https://major.io/images/2019-05-24-cranes-skycrapers.jpg"><meta itemprop=keywords content="command line,emergency,sysadmin,"><meta name=referrer content="no-referrer-when-downgrade"><style>body{font-family:Verdana,sans-serif;margin:auto;padding:20px;max-width:820px;text-align:left;background-color:#fff;word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:#444}h1,h2,h3,h4,h5,h6,strong,b{color:#222}a{color:#3273dc}.title{text-decoration:none;border:0}.title span{font-weight:400}nav a{margin-right:10px}textarea{width:100%;font-size:16px}input{font-size:16px}content{line-height:1.6}table{width:100%}img{max-width:100%}code{padding:2px 5px;background-color:#f2f2f2}pre code{color:#222;display:block;padding:20px;white-space:pre-wrap;font-size:14px}div.highlight code{background-color:unset;color:initial}blockquote{border-left:1px solid #999;color:#222;padding-left:20px;font-style:italic}footer{padding:25px;text-align:center}.helptext{color:#777;font-size:small}.errorlist{color:#eba613;font-size:small}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:#8b6fcb}@media(prefers-color-scheme:dark){body{background-color:#333;color:#ddd}h1,h2,h3,h4,h5,h6,strong,b{color:#eee}a{color:#8cc2dd}code{background-color:#777}pre code{color:#ddd}blockquote{color:#ccc}textarea,input{background-color:#252525;color:#ddd}.helptext{color:#aaa}}</style></head><body><header><a href=../../../../ class=title><h2>Major Hayden's Blog ðŸ¤ </h2></a><nav><a href=../../../../>Home</a>
<a href=../../../../ham-radio-faq>Ham Radio</a>
<a href=../../../../icanhazip-com-faq>icanhazip FAQ</a>
<a href=../../../../posts>Posts</a></nav></header><main><h1>Mounting a raw partition file made with dd or dd_rescue in Linux</h1><i><time datetime=2010-12-15 pubdate>2010-12-15</time></i>
<content><p>This situation might not affect everyone, but it struck me today and left me scratching my head. Consider a situation where you need to clone one drive to another with <a href=http://en.wikipedia.org/wiki/Dd_(Unix)>dd</a> or when a hard drive is failing badly and you use <a href=http://www.garloff.de/kurt/linux/ddrescue/>dd_rescue</a> to salvage whatever data you can.</p><p>Let&rsquo;s say you cloned data from a drive using something like this:</p><pre><code># dd if=/dev/sda of=/mnt/nfs/backup/harddrive.img
</code></pre><p>Once that&rsquo;s finished, you should end up with your partition table as well as the grub data from the MBR in your image file. If you run <code>file</code> against the image file you made, you should see something like this:</p><pre><code># file harddrive.img
harddrive.img: x86 boot sector; GRand Unified Bootloader, stage1 version 0x3, stage2
address 0x2000, stage2 segment 0x200, GRUB version 0.97; partition 1: ID=0x83,
active, starthead 1, startsector 63, 33640047 sectors, code offset 0x48
</code></pre><p>What if you want to pull some files from this image without writing it out to another disk? Mounting it like a loop file isn&rsquo;t going to work:</p><pre><code># mount harddrive /mnt/temp
mount: you must specify the filesystem type
</code></pre><p>The key is to mount the file <a href=http://www.linuxquestions.org/questions/linux-general-1/trouble-mounting-dd-image-file-644362/#post3660310>with an offset specified</a>. In the output from <code>file</code>, there is a particular portion of the output that will help you:</p><pre><code>... startsector 63 ...
</code></pre><p>This means that the filesystem itself starts on sector 63. You can also view this with <code>fdisk -l</code>:</p><pre><code># fdisk -l harddrive.img
                    Device Boot      Start         End      Blocks   Id  System
harddrive.img                *          63    33640109    16820023+  83  Linux
</code></pre><p>Since we need to scoot 63 sectors ahead, and each sector is 512 bytes long, we need to use an offset of 32,256 bytes. Fire up the mount command and you&rsquo;ll be on your way:</p><pre><code># mount -o ro,loop,offset=32256 harddrive.img /mnt/loop
# mount | grep harddrive.img
/root/harddrive.img on /mnt/loop type ext3 (ro,loop=/dev/loop1,offset=32256)
</code></pre><p>If you made this image under duress (due to a failing drive or other emergency), you might have to check and repair the filesystem first. Doing that is easy if you make a loop device:</p><pre><code># losetup --offset 32256 /dev/loop2 harddrive.img
# fsck /dev/loop2
</code></pre><p>Once that&rsquo;s complete, you can save some time and mount the loop device directly:</p><pre><code># mount /dev/loop2 /mnt/loop
</code></pre></content><p><a href=https://major.io/tags/command-line/>#command line</a>
<a href=https://major.io/tags/emergency/>#emergency</a>
<a href=https://major.io/tags/sysadmin/>#sysadmin</a></p></main><footer><script async src=https://media.ethicalads.io/media/client/ethicalads.min.js></script><div data-ea-publisher=major-io data-ea-type=text></div><hr>CC-BY-SA 4.0 &#187;
Made with <a href=https://gohugo.io/>Hugo</a> &#187;
Theme based on <a href=https://github.com/janraasch/hugo-bearblog/>Hugo Ê•â€¢á´¥â€¢Ê” Bear</a><br></footer></body></html>